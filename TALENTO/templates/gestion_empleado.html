{% extends 'menu.html' %}
{% load static %}

{% block title %}
{% if parametro == 'new' %}
CREAR EMPLEADO
{% else %}
{{ id_empleado }} - EDITAR EMPLEADO
{% endif %}
{% endblock %}


{% block body %}
<body>
    <div class="card p-5 crear-container">
        <div class="row">
            <div class="col-md-10">
                <form id="empleado-form">
                    {% csrf_token %}
                    <input type="hidden" id="id-empleado" name="id_empleado" value="{{ id_empleado|default:'' }}">
                    <input type="hidden" id="edit-id-empleado" name="edit_id_empleado"
                        value="{{ parametro|default:'' }}">
                    <input type="hidden" id="empleado-identidad" value="{{ identidad }}">

                    <div class="user-text">
                        <input id="creado-por" name="creado_por" type="hidden" value="{{ userName }}">
                    </div>
                    <div class="row mb-1 align-items-center">

                        <div class="col-md-6 d-flex align-items-center">
                            <label for="puesto-trabajo" class="form-label label-width"><span style="color: red;">*
                                </span>Identidad: </label>
                            <input type="text" id="puesto-trabajo" name="identidad" class="form-control input-underline"
                                placeholder="0000-0000-00000">
                        </div>
                        <div class="col-md-6 d-flex align-items-center" id="cod-empleado-container">
                            <label for="cod-empleado" class="form-label label-width"><span style="color: red;">*</span>
                                Código del Empleado: </label>
                            <input type="text" id="cod-empleado" name="cod-empleado" readonly
                                style="background-color: #fff;" class="form-control input-underline" placeholder="">
                        </div>
                    </div>
                    <div class="row mb-1 align-items-center">
                        <div class="col-md-6 d-flex align-items-center">
                            <label for="nombre-empleado" class="form-label label-width"><span
                                    style="color: red;">*</span> Nombre del Empleado: </label>
                            <input type="text" id="nombre-empleado" name="nombre" class="form-control input-underline"
                                placeholder="Primer Nombre y Segundo Nombre">
                            <div id="nombre-error" style="color: red; display: none;">Por favor, ingresa solo dos
                                palabras.</div>
                        </div>

                        <div class="col-md-6 d-flex align-items-center">
                            <label for="apellido-empleado" class="form-label label-width"><span
                                    style="color: red;">*</span> Apellido del
                                Empleado: </label>
                            <input type="text" id="apellido-empleado" name="apellido-empleado"
                                class="form-control input-underline" placeholder="Primer Apellido y Segundo Apellido">
                            <div id="apellido-error" style="color: red; display: none;">Por favor, ingresa solo tres
                                palabras.</div>
                        </div>

                    </div>
                    <div class="row mb-1 align-items-center">
                        <div class="col-md-6 d-flex align-items-center">
                            <label for="telefono-empresa" class="form-label label-width">Teléfono Empresa: </label>
                            <input type="tel" id="telefono-empresa" name="telefono_empresa"
                                class="form-control input-underline" placeholder="xxxx-xxxx">
                        </div>

                        <div class="col-md-6 d-flex align-items-center">
                            <label for="email-trabajo" class="form-label label-width">Correo Empresa:</label>
                            <input type="email" id="email-trabajo" name="email_trabajo"
                                class="form-control input-underline" placeholder="xxxxxx@carbajalhn.com">
                        </div>
                    </div>
                    <div class="row mb-1 align-items-center">
                        <div class="col-md-6 d-flex align-items-center">
                            <label for="fecha-ingreso" class="form-label label-width"><span style="color: red;">*</span>
                                Fecha Ingreso: </label>
                            <input type="date" id="fecha-ingreso" class="form-control input-underline"
                                placeholder="Fecha Ingreso">
                        </div>


                        <div class="col-md-6 d-flex align-items-center ">
                            <label for="centro" class="form-label label-width"><span style="color: red;">*</span>
                                Empresa: </label>
                            <select id="centro" name="centro" class="form-control input-underline select2"
                                style="width: 100%;">
                                <option value=""></option>
                                {% for empresa in empresas %}
                                <option value="{{ empresa.id }}">{{ empresa.nombre }}</option>
                                {% endfor %}
                            </select>
                        </div>



                    </div>
                    <div class="row mb-1 align-items-center">
                        <div class="col-md-6 d-flex align-items-center">
                            <label for="departamento-empresa" class="form-label label-width"><span
                                    style="color: red;">*</span> Departamento: </label>
                            <select id="departamento-empresa" name="departamento_empresa" style="width: 100%;"
                                class="form-control input-underline select2" placeholder="Nivel certificado">
                                <option value=""></option>
                                <option value="new-departamento-empresa">Crear nuevo departamento</option>
                                {% for dep in departamentos %}
                                <option value="{{ dep.0 }}">{{ dep.1 }}</option>
                                <!-- Verifica que dep.id es correcto -->
                                {% endfor %}
                            </select>
                        </div>


                        <div class="col-md-6 d-flex align-items-center">
                            <label for="telefono-trabajo" class="form-label label-width"><span
                                    style="color: red;">*</span> Sucursal: </label>
                            <select id="sucursal" name="sucursal" class="form-control input-underline select2"
                                style="width: 100%;">
                                <option value=""></option>

                                {% for sucursal in sucursales %}
                                <option value="{{ sucursal.0 }}">{{ sucursal.6 }}</option>
                                {% endfor %}
                            </select>
                        </div>

                    </div>

                    <div class="row mb-1 align-items-center ">
                        <div class="col-md-6 d-flex align-items-center">
                            <label for="areas-empresa" class="form-label label-width"><span style="color: red;">*</span>
                                Área: </label>
                            <select id="areas-empresa" name="id_area" style="width: 100%;"
                                class="form-control input-underline select2" placeholder="Nivel certificado">
                                <option value=""></option>
                                <option value="new-areas-empresa">Crear nueva area</option>
                            </select>

                        </div>

                        <div class="col-md-6 d-flex align-items-center">
                            <label for="cargos-empresa" class="form-label label-width"><span
                                    style="color: red;">*</span> Cargo: </label>
                            <select id="cargos-empresa" name="id_cargo" style="width: 100%;"
                                class="form-control input-underline select2" placeholder="Seleccione un cargo">
                                <option value=""></option>
                                <option value="new-cargos-empresa">Crear nuevo cargo</option>


                            </select>

                        </div>

                    </div>

                    <div class="row mb-1 align-items-center ">


                        <div class="col-md-6 d-flex align-items-center">
                            <label for="rol-empleado" class="form-label label-width"><span style="color: red;">*</span>
                                Rol: </label>
                            <select id="rol-empleado" name="rol_empleado" class="form-control input-underline select2"
                                style="width: 100%;">
                                <option value=""></option>
                                <option value="new-rol-empleado">Crear nuevo rol</option>
                                {% for rol in roles %}
                                <option value="{{ rol.0 }}">{{ rol.1 }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 d-flex align-items-center" id="cod-estado-empleado">
                            <label for="estado-empleado" class="form-label label-width"><span
                                    style="color: red;">*</span> Estado: </label>
                            <select id="estado-empleado" name="estado_empleado"
                                class="form-control input-underline select2" style="width: 100%;"
                                placeholder="Estado empleado">
                                <option value=""></option>
                                <option value="new-estado-empleado">Crear nuevo estado de empleado</option>
                                {% for est in estados %}
                                <option value="{{ est.id_estado }}">{{ est.estado_empleado }}</option>
                                {% endfor %}
                            </select>
                        </div>


                    </div>
                </form>
            </div>
            <div class="col-md-2 text-center">
                <div class="text-center">
                    <div class="card-body">
                        <!-- Imagen con animación para indicar que debe subirse una foto -->
                        <img src="{% static 'app/th/images/camara.png' %}" alt="Foto del empleado"
                            class="img-fluid rounded animated-shake" id="empleado-foto"
                            style="width: 180px; height: 180px;"
                            onclick="document.getElementById('foto-input').click();">
                    </div>
                </div>
                <input type="file" id="foto-input" class="form-control-file mt-3" style="display: none;"
                    accept="image/*">
                <input type="hidden" id="foto-ruta" name="foto-ruta">
                <input type="hidden" id="foto-actual" name="foto_actual">

            </div>

        </div>
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link d-flex align-items-center" id="private-info-tab" data-bs-toggle="tab"
                    data-bs-target="#private-info-sec" type="button" role="tab" aria-controls="private-info-sec"
                    aria-selected="false">
                    <i class="material-icons me-2 text-pastel-orange">person</i> Información Personal
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link d-flex align-items-center" id="trabajo-info-tab" data-bs-toggle="tab"
                    data-bs-target="#trabajo-info-sec" type="button" role="tab" aria-controls="trabajo-info-sec"
                    aria-selected="false">
                    <i class="material-icons me-2 text-pastel-blue">assignment</i> Ficha
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link d-flex align-items-center" id="curriculo-tab" data-bs-toggle="tab"
                    data-bs-target="#curriculo-sec" type="button" role="tab" aria-controls="curriculo-sec"
                    aria-selected="true">
                    <i class="material-icons me-2 text-pastel-green">school</i> Currículum
                </button>
            </li>

            <li class="nav-item" role="presentation">
                <button class="nav-link d-flex align-items-center" id="config-rrhh-tab" data-bs-toggle="tab"
                    data-bs-target="#config-rrhh-sec" type="button" role="tab" aria-controls="config-rrhh-sec"
                    aria-selected="false">
                    <i class="material-icons me-2 text-pastel-purple">settings</i>Ajustes RRHH
                </button>
            </li>
            <li class="nav-item" role="presentation"></li>
            <button class="nav-link d-flex align-items-center" id="config-bitacora-tab" data-bs-toggle="tab"
                data-bs-target="#config-bitacora-sec" type="button" role="tab" aria-controls="config-bitacora-sec"
                aria-selected="false">
                <i class="material-icons me-2 " style="color: #1e3a8a;">book</i>Bitacora Empleado
            </button>
            </li>
        </ul>
        <div class="tab-content p-3" id="myTabContentCentros">
            <div class="tab-pane fade " id="curriculo-sec" role="tabpanel" aria-labelledby="curriculo-tab">
                {% include 'complementos/empleado_curriculum.html' %}
            </div>
            <div class="tab-pane fade" id="trabajo-info-sec" role="tabpanel" aria-labelledby="trabajo-info-tab">
                {% include 'complementos/empleado_ficha.html' %}
            </div>
            <div class="tab-pane fade show " id="private-info-sec" role="tabpanel" aria-labelledby="private-info-tab">
                {% include 'complementos/empleado_informacion.html' %}
            </div>
            <div class="tab-pane fade " id="config-rrhh-sec" role="tabpanel" aria-labelledby="config-rrhh-tab">
                {% include 'complementos/empleado_ajustes.html' %}
            </div>
            <div class="tab-pane fade " id="config-bitacora-sec" role="tabpanel" aria-labelledby="config-bitacora-tab">
                {% include 'complementos/empleado_bitacora_empleado.html' %}
            </div>

        </div>
    </div>

    <div class="float-buttons">
        <a href="#" class="back-to-top">
            <i class="material-icons text-gray">arrow_upward</i>
        </a>
    </div>

    {% include 'complementos/empleados/m_empleado_rol.html' %}
    {% include 'complementos/empleados/m_empleado_tomar_vacaciones.html' %}
    {% include 'complementos/empleados/m_empleado_vacaciones_ticket.html' %}
    {% include 'complementos/empleados/m_empleado_contrato_prorroga.html' %}
    {% include 'complementos/empleados/m_empleado_nueva_prorroga.html' %}
    {% include 'complementos/empleados/m_empleado_registrar_empleado.html' %}

    {% include 'complementos/empleados/m_empleado_modal_contratos.html' %}
    {% include 'complementos/empleados/m_empleado_enfermedad_base.html' %}
    {% include 'complementos/empleados/m_empleado_cat_enfermedad_base.html' %}
    {% include 'complementos/empleados/m_empleado_modal_curriculu.html' %}
    {% include 'complementos/empleados/m_empleados_cat_tipo_curriculum.html' %}
    {% include 'complementos/empleados/m_empleado_estado_curriculum.html' %}
    {% include 'complementos/empleados/m_empleado_asociaciones.html' %}
    {% include 'complementos/empleados/m_empleado_asociacion.html' %}
    {% include 'complementos/empleados/m_empleado_parentesco_familiar.html' %}
    {% include 'complementos/empleados/m_empleado_contactos_emergencia.html' %}
    {% include 'complementos/empleados/m_empleado_parentesco.html' %}
    {% include 'complementos/empleados/m_empleado_anadir_seguro.html' %}
    {% include 'complementos/empleados/m_empleado_empres_seguro.html' %}
    {% include 'complementos/empleados/m_empleado_poliza_seguro.html' %}
    {% include 'complementos/empleados/m_empleado_equipo.html' %}
    {% include 'complementos/empleados/m_empleado_cat_equipo.html' %}
    {% include 'complementos/empleados/m_empleado_departamento.html' %}
    {% include 'complementos/empleados/m_empleado_profesion_oficion.html' %}
    {% include 'complementos/empleados/m_empleado_barrios_colonia_municipio.html' %}
    {% include 'complementos/empleados/m_empleado_ciudad_muncipio.html' %}
    {% include 'complementos/empleados/m_empleado_municipio_departamento.html' %}
    {% include 'complementos/empleados/m_empleado_departamento_pais.html' %}
    {% include 'complementos/empleados/m_empleado_centro_educativo.html' %}
    {% include 'complementos/empleados/m_empleado_area.html' %}
    {% include 'complementos/empleados/m_empleado_cargo.html' %}
    {% include 'complementos/empleados/m_empleado_cat_retiro.html' %}
    {% include 'complementos/empleados/m_empleado_accesos.html' %}
    {% include 'complementos/empleados/m_empleado_habilidades.html' %}
    {% include 'complementos/empleados/m_empleado_usuario.html' %}
    {% include 'complementos/empleados/m_empleado_pais.html' %}
    {% include 'complementos/empleados/m_empleado_posicion.html' %}
    {% include 'complementos/empleados/m_empleado_tipo_contrato.html' %}
    {% include 'complementos/empleados/m_empleado_tipo_pago.html' %}
    {% include 'complementos/empleados/m_empleado_cuenta_contable.html' %}
    {% include 'complementos/empleados/m_empleado_estado_civil.html' %}
    {% include 'complementos/empleados/m_empleado_estado_empleado.html' %}
    {% include 'complementos/empleados/m_empleado_forma_pago.html' %}
    {% include 'complementos/empleados/m_empleado_motivo_retiro.html' %}
    {% include 'complementos/empleados/m_empleado_nivel_certificado.html' %}
    {% include 'complementos/empleados/m_empleado_tipo_cuenta.html' %}
    {% include 'complementos/empleados/m_empleado_banco.html' %}
    {% include 'complementos/empleados/m_empleado_beneficio_laboral.html' %}
    {% include 'complementos/empleados/m_empleado_beneficio_laboral_modal.html' %}
    {% include 'complementos/empleados/m_empleado_beneficio_adicional_modal.html' %}
    {% include 'complementos/empleados/m_empleado_beneficioadicional.html' %}
    {% include 'complementos/empleados/m_empleado_pais_departamento.html' %}
    {% include 'complementos/empleados/m_empleado_familiares.html' %}




</body>

{% endblock %}
{% block scripts %}

<script>

    $(document).ready(function () {
		var opcion;

        $('[data-toggle="tooltip"]').tooltip();
        $('#formCrearBarrio').on('submit', function (event) {
            event.preventDefault();

            // Obtener los valores del formulario
            let nombreBarrio = $('#nombre-barrio').val().trim().toUpperCase();
            const creadoPor = '{{userName}}';
            const idCiudad = $('#nuevo-municipio-departamento').val();

            // Validación simple
            let errorMessage = '';

            // Validar si se ha ingresado el nombre del barrio
            if (!nombreBarrio) {
                errorMessage += 'El campo "Nombre del Barrio" es obligatorio.\n';
            }

            // Validar si se ha seleccionado una ciudad
            if (!idCiudad) {
                errorMessage += 'Debe seleccionar una ciudad antes de continuar.\n';
            }

            // Validar si se ha ingresado el usuario creador
            if (!creadoPor) {
                errorMessage += 'Su sesión ha expirado. Por favor, inicie sesión nuevamente.\n';
            }

            if (errorMessage) {
                Swal.fire({
                    icon: 'error',
                    title: 'Campos Obligatorios',
                    text: errorMessage.replace(/\n/g, ' '),  // Mostrar los errores en una sola línea
                    confirmButtonText: 'Aceptar'
                });
                return;  // Detener la ejecución si hay errores
            }

            // Si no hay errores, proceder con la solicitud AJAX
            $.ajax({
                type: 'POST',
                url: '{% url "crear_barrio_colonia" %}',  // Asegúrate de que esta URL esté definida en tus URLs de Django
                data: {
                    'nombre_barrio': nombreBarrio,
                    'id_ciudad': idCiudad,
                    'ingresado_por': creadoPor,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function (response) {
                    if (response.status === 'success') {
                        // Capturar el last_id devuelto por el servidor
                        const lastId = response.last_id;

                        // Cerrar el modal
                        $('#modalCrearBarrio').modal('hide');

                        // Añadir la nueva opción al select #nuevo-barrio-ciudad
                        const newOption = new Option(nombreBarrio, lastId);
                        $('#nuevo-barrio-ciudad').prepend(newOption);
                        $('#nuevo-barrio-ciudad').val(lastId);

                        // Limpiar el formulario del modal
                        $('#nombre-barrio').val('');
                        $('#nombre_ciudad_barrio').val('');
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Ocurrió un error al crear el barrio. Inténtelo nuevamente.',
                            confirmButtonText: 'Aceptar'
                        });
                        console.error('Error en la respuesta del servidor:', response.message);
                    }
                },
                error: function (response) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Ocurrió un error al crear el barrio. Inténtelo nuevamente.',
                        confirmButtonText: 'Aceptar'
                    });
                    console.error('Error al crear el barrio o colonia', response);
                }
            });
        });

    });


    $(document).ready(function () {


        function registrarEmpleado() {
            $('#formRegistrarEmpleado').on('submit', function (e) {
                e.preventDefault();  // Prevenir el envío normal del formulario

                // Obtener el valor de la identidad del campo en el modal
                let identidadRegistro = $('#registro-empleado').val();
                let creado_por = $('#creado_por').val();  // Suponiendo que este campo existe en el formulario
                console.log("Identidad registro: " + identidadRegistro);

                // Validar que se ha ingresado una identidad
                if (!identidadRegistro) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Advertencia',
                        text: 'Por favor, ingresa una identidad válida.',
                    });
                    return;
                }

                // Enviar los datos mediante AJAX
                $.ajax({
                    url: "{% url 'insertar_identidad' %}",  // Cambia esto a la URL de tu vista en Django
                    type: 'POST',
                    data: {
                        'identidad': identidadRegistro,
                        'creado_por': creado_por,
                        'csrfmiddlewaretoken': '{{ csrf_token }}'  // Incluir el token CSRF
                    },
                    success: function (response) {
                        if (response.status === 'success') {
                            // Actualizar campos con los datos del nuevo empleado
                            $('#id-empleado').val(response.id_empleado);
                            $('#cod-empleado').val(response.codigo_empleado);

                            // Actualizar el campo de identidad fuera del modal
                            $('#puesto-trabajo').val(identidadRegistro);  

                            // Cerrar el modal
                            $('#modalRegistrarEmpleado').modal('hide');

                            // Mostrar mensaje de éxito
                            Swal.fire({
                                icon: 'success',
                                title: 'Éxito',
                                text: 'Empleado registrado con éxito.',
                                showConfirmButton: false,
                                timer: 1500
                            });

                            // Limpiar el formulario después de registrar el empleado
                            $('#formRegistrarEmpleado').trigger('reset');  // Limpia todos los campos del formulario
                        } else {
                            Swal.fire({
                                icon: 'warning',
                                title: 'Advertencia',
                                text: response.error,
                            });
                        }
                    },
                    error: function (response) {
                        let errorMessage = response.responseJSON ? response.responseJSON.error : response.responseText;

                        // Mostrar error si falla la solicitud AJAX
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: errorMessage,
                        });
                    }
                });
            });
        }

        registrarEmpleado();




        // Captura el evento del botón de cerrar
        $(document).on('click', '.close', function () {
            // Captura el ID del input de texto dentro del modal
            let formId = $(this).closest('.modal').find('input[type="text"]').attr('id');
            let inputValue = $('#' + formId).val();

            // Identifica si es departamento, área o cargo y actualiza el select correspondiente
            if (formId === 'id_departamento') {
                updateSelect('departamento-empresa', inputValue);
            } else if (formId === 'id_area_hidden') {
                updateSelect('areas-empresa', inputValue);
            } else if (formId === 'id_cargo_hidden') {
                updateSelect('cargos-empresa', inputValue);
            }
        });

        // Función para actualizar el select correspondiente
        function updateSelect(selectId, newValue) {
            // Verifica si el valor del input es válido
            if (newValue) {
                // Verifica si la opción ya existe en el select
                let optionExists = $('#' + selectId + ' option[value="' + newValue + '"]').length;

                // Si no existe, añade la nueva opción
                if (!optionExists) {
                    $('#' + selectId).append(new Option(newValue, newValue));
                }

                // Selecciona el nuevo valor en el select
                $('#' + selectId).val(newValue).trigger('change');
            }
        }

        $('#btnNuevo').click(function () {
            $('#modalProrrogasContrato').modal('hide');
        });


        $(document).on("click", ".btnDetails", function (e) {
            e.preventDefault();  // Prevenir el comportamiento por defecto

            // Obtener la fila en la que se hizo clic
            var fila = $(this).closest("tr");
            var $row = $(this).closest('tr');
            var estadoActual = $row.find('td:eq(4)').text().trim();

            // Capturar los valores de las celdas
            var pkContrato = parseInt(fila.find("td:eq(0)").text());  // Primera columna (ID contrato)
            var nombreEmpleado = fila.find("td:eq(2)").text();  // Tercera columna (Nombre del empleado)

            // Si los valores están vacíos o incorrectos, verificar la estructura de la tabla
            if (!pkContrato || !nombreEmpleado) {
                console.log("Error: No se pudieron capturar los valores correctamente.");
                return;
            }

            // Mostrar el modal
            $('#modalProrrogasContrato').modal({
                backdrop: 'static',
                keyboard: false
            }).modal('show');

            var buttons = "Blrtip";


            if ($.fn.DataTable.isDataTable('#prorrogasTable')) {
                $('#prorrogasTable').DataTable().clear().destroy();
            }

            if (!pkContrato || pkContrato === "") {
                pkContrato = 0;
            }

            // Construir la URL dinámica con el valor de pkContrato
            var urlDetalleContratos = "http://localhost/EVAC/public/api/list/detalles/x/contrato/" + pkContrato;

            var creadoPor = $('#creado-por').val();


            $("#prorrogasTable tfoot th").each(function () {
                var title = $(this).text();
                $(this).html('<input class="form-control form-control-sm" type="text" placeholder="' +
                    title + '" />');
            });

            prorrogasTable = $("#prorrogasTable").DataTable({
                beforeSend: function (xhr, type) {
                    if (!type.crossDomain) {
                        xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]')
                            .attr(
                                'content'));
                    }
                },
                ajax: {

                    url: urlDetalleContratos,
                },
                language: {
                    "processing": "Procesando...",
                    "lengthMenu": "Mostrar _MENU_ registros",
                    "zeroRecords": "No se encontraron resultados",
                    "emptyTable": "Ningún dato disponible en esta tabla",
                    "info": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                    "infoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                    "infoFiltered": "(filtrado de un total de _MAX_ registros)",
                    "search": "Buscar:",
                    "infoThousands": ",",
                    "loadingRecords": "Cargando...",
                    "paginate": {
                        "first": "Primero",
                        "last": "Último",
                        "next": "Siguiente",
                        "previous": "Anterior"
                    },
                    "aria": {
                        "sortAscending": ": Activar para ordenar la columna de manera ascendente",
                        "sortDescending": ": Activar para ordenar la columna de manera descendente"
                    },
                    "buttons": {
                        "copy": "Copiar",
                        "colvis": "Visibilidad"
                    }
                },
                order: [
                    [5, "desc"]
                ],
                dom: buttons,
                buttons: [{
                    extend: 'excel',
                    text: '<i class="fas fa-file-excel"></i>',
                    titleAttr: 'Excel',
                    className: 'btn btn-success',
                },
                {
                    extend: 'pdf',
                    text: '<i class="fas fa-file-pdf"></i>',
                    titleAttr: 'PDF',
                    className: 'btn btn-danger',
                },
                {
                    extend: 'print',
                    text: '<i class="fas fa-print"></i>',
                    titleAttr: 'Imprimir',
                    className: 'btn btn-warning',
                }
                ],
                columns: [{
                    data: "id_prorroga",
                    width: "8%"
                },
                {
                    data: "identidad"
                },
                {
                    data: "nombre_usuario"
                },
                {
                    data: "descripcion"
                },
                {
                    data: "fecha_inicio",
                    className: "text-center",
                },
                {
                    data: "fecha_final",
                    className: "text-center",
                },
                {
                    data: "cant_meses",
                    className: "text-center",
                },
                {
                    data: "tipo_prorroga",
                    className: "text-center",
                    render: function (data, type, row) {
                        var badge = "";

                        if (data == 1) {
                            badge +=
                                '<span class="badge badge-pill badge-info">Inicio Contrato</span>';
                        } else if (data == 2) {
                            badge +=
                                '<span class="badge badge-pill badge-danger">Prorroga</span>';
                        } else if (data == 3) {
                            badge +=
                                '<span class="badge badge-pill badge-success">Indefinido</span>';
                        }

                        return badge;
                    },
                },
                {
                    data: "estado",
                    className: "text-center",
                    render: function (data, type, row) {
                        var badge = "";
                        if (data == 1) {
                            badge +=
                                '<span class="badge badge-pill badge-success">Activo</span>';
                        } else if (data == 3) {
                            badge +=
                                '<span class="badge badge-pill badge-danger">Anulado</span>';
                        } else if (data == 4) {
                            badge +=
                                '<span class="badge badge-pill badge-warning">Finalizado</span>';
                        }

                        return badge;
                    },
                },
                {
                    data: "estado",
                    className: "text-center",
                    render: function (data, type, row) {
                        var badge = "";
                        if (data == 4) {
                            badge +=
                                '<span class="badge badge-pill badge-warning">Finalizado</span>';
                        } else {
                            badge +=
                                "<div class='text-center'><div class='btn-group'>" +
                                "<button title='Finalizar' class='btn  btn-warning btn-sm btnEdit btnFinalizar'>" +
                                "<i class='material-icons' style='color: #ffffff;'>unpublished</i></button>" + // Icono de "check_circle" para finalizar, color blanco
                                "<button title='Cambiar estado' class='btn btn-danger  btn-sm btnStatus'>" +
                                "<i class='material-icons' style='color: #ffffff;'>change_circle</i></button>" + // Icono de "cancel" para anular, color blanco
                                "</div></div>";

                        }

                        return badge;
                    },
                }
                ]
            });

            //new $.fn.dataTable.FixedHeader(prorrogasTable);

            /*
             * --------------------------- OPEN MODAL NUEVA PRORROGA ---------------------------
             */
            $('#btnNuevo').click(function (e) {
                e.preventDefault();

                $.ajax({
                    beforeSend: function (xhr, type) {
                        if (!type.crossDomain) {
                            xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'));
                        }
                    },
                    type: "POST",
                    url: "http://localhost/EVAC/public/api/suma/meses/x/contrato",
                    data: {
                        pkContrato: pkContrato
                    },
                    dataType: "json",
                    success: function (data) {
                        if (data.save == 1) {
                            if (data.estado == 1) {
                                if (data.tipo_prorroga == 3) {
                                    Swal.fire("",
                                        "Contrato Indefinido, NO Puedes Abrir una Prórroga!",
                                        "warning");
                                    return; // Evitar que el modal se abra
                                } else if (data.ultimoEstado == 1) {
                                    Swal.fire("",
                                        "La última Prórroga está Activa, Finalizala para poder Abrir una Nueva!",
                                        "warning");
                                    $("#modalProrrogasContrato").modal("show");
                                    return; // Evitar que el modal se abra
                                } else {
                                    $('#sumaActual').val(data.suma);
                                    if (data.suma >= 11) {
                                        Swal.fire("",
                                            "Contrato con 11 meses Alcanzado, NO Puedes Abrir Más Prórrogas!",
                                            "warning");
                                        return; // Evitar que el modal se abra
                                    } else {
                                        // Si todo está bien, abre el modal aquí
                                        $(".modal-header").css("background-color", "#17a2b8");
                                        $(".modal-header").css({
                                            "color": "white",
                                            "font-weight": "900"
                                        });
                                        $(".modal-title").text("Nueva Proroga");
                                        $("#modalContratos").modal("show");
                                    }
                                }

                            }


                        } else if (data.save == 0) {
                            Swal.fire("", "Error: " + data.error, "error");
                        }
                    }
                });

            });

            /*
             * --------------------------- FUNCTION CLOSE MODAL ---------------------------
             */
            $("#btnCancelar").click(function () {
                $("#modalContratos").modal("hide");
            });

            /*
             * --------------------------- FUNCTION FOR PRORROGA ---------------------------
             */
            $(document).on("click", ".btnFinalizar", function () {
                fila = $(this).closest("tr");

                varID = fila.find("td:eq(0)").text();
                nombreEmpleado = fila.find("td:eq(2)").text();


                $.ajax({
                    beforeSend: function (xhr, type) {
                        if (!type.crossDomain) {
                            xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]')
                                .attr(
                                    'content'));
                        }
                    },
                    type: "POST",
                    url: "http://localhost/EVAC/public/api/get/prorroga/status",
                    data: {
                        pkContrato: varID,
                        userName: creadoPor
                    },
                    dataType: "json",
                    success: function (data) {
                        if (data.save == 1) {
                            if (data.estado == 1) {

                                Swal.fire({
                                    title: "Estás seguro de Finalizar esta Prórroga?",
                                    text: "",
                                    icon: "warning",
                                    showCancelButton: true,
                                    confirmButtonColor: '#3085d6',
                                    cancelButtonColor: '#d33',
                                    confirmButtonText: 'Confirmar!'
                                }).then((result) => {
                                    if (result.isConfirmed) {

                                        $.ajax({
                                            beforeSend: function (xhr, type) {
                                                if (!type.crossDomain) {
                                                    xhr.setRequestHeader(
                                                        'X-CSRF-Token',
                                                        $(
                                                            'meta[name="csrf-token"]'
                                                        )
                                                            .attr(
                                                                'content'));
                                                }
                                            },
                                            type: "POST",
                                            url: "http://localhost/EVAC/public/api/update/status/contrato",

                                            data: {
                                                varID: varID,
                                                status_value: 4,
                                                opcion: 2,
                                                userName: creadoPor

                                            },
                                            dataType: "json",
                                            success: function (data) {
                                                if (data.save == 1) {
                                                    Swal.fire("",
                                                        "Prórroga Finalizada",
                                                        "success");
                                                    prorrogasTable.ajax
                                                        .reload(null,
                                                            false);

                                                } else if (data.save == 0) {
                                                    Swal.fire("",
                                                        "Error: " + data
                                                            .error,
                                                        "error");
                                                }
                                            }
                                        });

                                    }
                                });

                            } else if (data.estado == 3) {
                                Swal.fire("", "Prorroga Anulada, NO Puedes Finalizarla!",
                                    "warning");
                                prorrogasTable.ajax.reload(null, false);

                            } else if (data.estado == 4) {
                                Swal.fire("",
                                    "Prorroga Finalizada, NO Puedes Cambiar su Estado!",
                                    "warning");
                                prorrogasTable.ajax.reload(null, false);

                            }
                        } else if (data.save == 0) {
                            Swal.fire("", "Error: " + data.error, "error");
                        }
                    }
                });

            });

            $(document).on("click", ".btnStatus", function () {
                fila = $(this).closest("tr");

                varID = fila.find("td:eq(0)").text();
                nombreEmpleado = fila.find("td:eq(2)").text();

                $.ajax({
                    beforeSend: function (xhr, type) {
                        if (!type.crossDomain) {
                            xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]')
                                .attr(
                                    'content'));
                        }
                    },
                    type: "POST",
                    url: "http://localhost/EVAC/public/api/get/prorroga/status",

                    data: {
                        pkContrato: varID

                    },
                    dataType: "json",
                    success: function (data) {
                        if (data.save == 1) {
                            if (data.estado == 1) {

                                Swal.fire({
                                    title: "Estás seguro de Anular esta Prórroga?",
                                    text: "",
                                    icon: "warning",
                                    showCancelButton: true,
                                    confirmButtonColor: '#3085d6',
                                    cancelButtonColor: '#d33',
                                    confirmButtonText: 'Confirmar!'
                                }).then((result) => {
                                    if (result.isConfirmed) {

                                        $.ajax({
                                            beforeSend: function (xhr, type) {
                                                if (!type.crossDomain) {
                                                    xhr.setRequestHeader(
                                                        'X-CSRF-Token',
                                                        $(
                                                            'meta[name="csrf-token"]'
                                                        )
                                                            .attr(
                                                                'content'));
                                                }
                                            },
                                            type: "POST",
                                            url: "http://localhost/EVAC/public/api/update/status/contrato",

                                            data: {
                                                varID: varID,
                                                status_value: 3,
                                                opcion: 2,
                                                userName: creadoPor
                                            },
                                            dataType: "json",
                                            success: function (data) {
                                                if (data.save == 1) {
                                                    Swal.fire("",
                                                        "Prórroga Anulada",
                                                        "success");
                                                    prorrogasTable.ajax
                                                        .reload(null,
                                                            false);

                                                } else if (data.save == 0) {
                                                    Swal.fire("",
                                                        "Error: " + data
                                                            .error,
                                                        "error");
                                                }
                                            }
                                        });

                                    }
                                });

                            } else if (data.estado == 3) {

                                Swal.fire({
                                    title: "Estás seguro de Reactivar esta Prórroga?",
                                    text: "",
                                    icon: "warning",
                                    showCancelButton: true,
                                    confirmButtonColor: '#3085d6',
                                    cancelButtonColor: '#d33',
                                    confirmButtonText: 'Confirmar!'
                                }).then((result) => {
                                    if (result.isConfirmed) {

                                        $.ajax({
                                            beforeSend: function (xhr, type) {
                                                if (!type.crossDomain) {
                                                    xhr.setRequestHeader(
                                                        'X-CSRF-Token',
                                                        $(
                                                            'meta[name="csrf-token"]'
                                                        )
                                                            .attr(
                                                                'content'));
                                                }
                                            },
                                            type: "POST",
                                            url: "http://localhost/EVAC/public/api/update/status/contrato",

                                            data: {
                                                varID: varID,
                                                status_value: 1,
                                                opcion: 2,
                                                userName: creadoPor
                                            },
                                            dataType: "json",
                                            success: function (data) {
                                                if (data.save == 1) {
                                                    Swal.fire("",
                                                        "Prorroga Habilitada",
                                                        "success");
                                                    prorrogasTable.ajax
                                                        .reload(null,
                                                            false);

                                                } else if (data.save == 0) {
                                                    Swal.fire("",
                                                        "Error: " + data
                                                            .error,
                                                        "error");
                                                }
                                            }
                                        });

                                    }
                                });


                            } else if (data.estado == 4) {
                                Swal.fire("",
                                    "Prórroga Finalizada, NO Puedes Cambiar su Estado!",
                                    "warning");
                                prorrogasTable.ajax.reload(null, false);

                            }
                        } else if (data.save == 0) {
                            Swal.fire("", "Error: " + data.error, "error");
                        }
                    }
                });
            });

            /*
             * --------------------------- FORM CONTRATO ---------------------------
             */
            $("#formContratos").off("submit").on("submit", function (e) {
                e.preventDefault(); // Prevenir el envío predeterminado del formulario

                // Obtener los valores del formulario
                let inicioContrato = $("#inicioContrato").val();
                let finalContrato = $("#finalContrato").val();
                var descripcion = $("#descripcion").val();
                var sumaActual = $('#sumaActual').val();
                var departamento = $("#departamento-empresa").val();
                var area = $("#areas-empresa").val();
                var cargo = $("#cargos-empresa").val();
                var pkEmpleado = $.trim($("#id-empleado").val());
                var creadoPor = $('#creado-por').val();

                // Validación individual del campo de inicio de contrato
                // Validación individual del campo de inicio de contrato
                if (!inicioContrato) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Campo Requerido',
                        text: 'Por favor, ingrese la fecha de inicio del contrato.',
                        confirmButtonText: 'Entendido',
                        customClass: {
                            confirmButton: 'btn btn-primary'
                        },
                        buttonsStyling: false,
                        didClose: () => {
                            // Enfocar el campo después de cerrar la alerta
                            $("#inicioContrato").focus();
                        }
                    });
                    return; // Detener la ejecución si está vacío
                }

                // Validación individual del campo de final de contrato
                if (!finalContrato) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Campo Requerido',
                        text: 'Por favor, ingrese la fecha de finalización del contrato.',
                        confirmButtonText: 'Entendido',
                        customClass: {
                            confirmButton: 'btn btn-primary'
                        },
                        buttonsStyling: false,
                        didClose: () => {
                            // Enfocar el campo después de cerrar la alerta
                            $("#finalContrato").focus();
                        }
                    });
                    return; // Detener la ejecución si está vacío
                }



                // Calcular la diferencia de meses entre las fechas
                var date1 = new Date(`${inicioContrato}T00:00`);
                var date2 = new Date(`${finalContrato}T00:00`);
                var diffMonths = (date2.getFullYear() - date1.getFullYear()) * 12 + date2.getMonth() - date1.getMonth();
                var sumaMeses = parseInt(sumaActual) + parseInt(diffMonths);

                // Validaciones
                if (!inicioContrato || !finalContrato) {
                    Swal.fire("", "Debes llenar Todos los Campos!", "warning");
                    return;
                }

                if (diffMonths > 9) {
                    Swal.fire("", "NO Puedes Abrir una Prórroga por más de 9 meses!", "warning");
                    return;
                }

                if (sumaMeses > 11) {
                    Swal.fire("", "NO Puedes Tener un Contraro por más de 11 meses!", "warning");
                    return;
                }

                // Enviar los datos mediante AJAX
                $.ajax({
                    beforeSend: function (xhr, type) {
                        if (!type.crossDomain) {
                            xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'));
                        }
                    },
                    url: "http://localhost/EVAC/public/api/save/new/prorroga",
                    type: "POST",
                    datatype: "json",
                    data: {
                        pkContrato: pkContrato,
                        descripcion: descripcion,
                        inicioContrato: inicioContrato,
                        finalContrato: finalContrato,
                        hidden_cargo: cargo,
                        hidden_area: area,
                        hidden_departamento: departamento,
                        userName: creadoPor
                    },
                    success: function (data) {
                        if (data.existe == 1) {
                            Swal.fire("", "Ya existe una Prórroga con el Rango de Fechas Seleccionado!", "warning");
                        } else if (data.existe == 0) {
                            if (data.save == 1) {
                                Swal.fire("", "Prórroga Creada!", "success");
                                $("#modalContratos").modal("hide");
                                $("#modalProrrogasContrato").modal("show");
                                // Recargar solo la tabla
                                prorrogasTable.ajax.reload(null, false); // Evitar la recarga de la página
                            } else {
                                Swal.fire("", "Error!: " + data.error, "error");
                            }
                        }
                    },
                    error: function (xhr, status, error) {
                        Swal.fire("", "Error: " + error, "error");
                    }
                });
            });

        });


    });



    document.addEventListener('DOMContentLoaded', function () {
        // Lógica para mostrar modal y manejar el texto de navegación
        var path = window.location.pathname;  // Obtiene la ruta actual

        // Verifica si la ruta es exactamente "/CWS/modulos/talento/humano/empleados/gestion/new/"
        if (path === "/CWS/modulos/talento/humano/empleados/gestion/new/") {
            // Obtener el valor de 'userName' desde el input oculto
            var userName = "{{ userName }}";
            // Verificar si el usuario está vacío
            if (!userName || userName.trim() === '') {
                // Redirigir al usuario al login si no hay un usuario registrado
                window.location.href = 'http://3.230.160.184:81/CWS/';
            } else {
                // Obtener el valor del campo con id="id-empleado"
                var idEmpleado = $.trim($("#id-empleado").val());

                // Si el idEmpleado está vacío, mostrar el modal
                if (idEmpleado === "" || idEmpleado === undefined) {
                    console.log("ID de empleado: <empty string>");
                    $('#modalRegistrarEmpleado').modal('show');
                    // Desactivar el campo de identidad
                    document.getElementById("puesto-trabajo").disabled = true;

                    $(document).ready(function () {
                    });
                } else {
                    console.log("ID de empleado:", idEmpleado);  // Si tiene valor, mostrar el ID

                }
            }



        }
    });


    $("#puesto-trabajo, #TutorID").inputmask("9999-9999-99999", {
        placeholder: "0",
        clearMaskOnLostFocus: false,
    });
    $("#rtn, #TutorID").inputmask("9999-9999-999999", {
        placeholder: "0",
        clearMaskOnLostFocus: false,
    });
    $("#telefono-empresa, #TutorID").inputmask({
        mask: "9999-9999",
        placeholder: "x",
        clearMaskOnLostFocus: false
    });

    $("#telefono-personal, #TutorID").inputmask({
        mask: "9999-9999",
        placeholder: "x",
        clearMaskOnLostFocus: false
    });




    $(document).ready(function () {

        $('#tipo-cuenta, #centro-costo').on('change', function () {
            // Obtener los valores seleccionados
            let tipoCuentaNombre = $('#tipo-cuenta option:selected').text();
            let centroCostoId = $('#centro-costo').val();

            // Limpiar el select de cuenta contable si no hay selección válida en los otros selectores
            if (!centroCostoId || !tipoCuentaNombre) {
                $('#cuenta-contable').empty().append('<option value="">Selecciona una cuenta contable</option>');
                return; // Salir si no hay selección válida
            }

            // Concatenar ID del centro de costo con el nombre del tipo de cuenta
            let cuentaContableTexto = `${centroCostoId} - ${tipoCuentaNombre}`;

            // Limpiar el select de cuenta contable y agregar la nueva opción
            $('#cuenta-contable').empty().append(new Option(cuentaContableTexto, cuentaContableTexto));
        });




        $('#sucursal').change(function () {
            var sucursalId = $(this).val();  // Obtener el ID de la sucursal seleccionada

            // Verificar si se seleccionó una sucursal
            if (sucursalId) {
                $.ajax({
                    url: "{% url 'obtener_direccion_sucursal' %}",  // La URL del endpoint que llama al procedimiento almacenado
                    method: 'GET',
                    data: { 'id_sucursal': sucursalId },  // Enviar el ID de la sucursal como parámetro
                    success: function (response) {
                        // Actualizar el campo de dirección laboral con la respuesta
                        $('#direccion-laboral').val(response.direccion);
                    },
                    error: function (xhr, status, error) {
                        console.error('Error al obtener la dirección:', error);
                        alert('Hubo un error al obtener la dirección de la sucursal.');
                    }
                });
            } else {
                // Limpiar el campo de dirección si no se selecciona ninguna sucursal
                $('#direccion-laboral').val('');
            }
        });

        $(document).ready(function () {

            // Evento de click en el botón para abrir el modal
            $("#btnAbrirModalContrato").click(function (e) {
                e.preventDefault();

                var pkEmpleado = $('#id-empleado').val() || $('#edit-id-empleado').val();
                // Validar si el empleado tiene un contrato activo antes de abrir el modal
                $.ajax({
                    beforeSend: function (xhr, type) {
                        if (!type.crossDomain) {
                            xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'));
                        }
                    },
                    type: "POST",
                    url: "http://localhost/EVAC/public/api/validate/contrato/new",
                    data: { pkEmpleado: pkEmpleado },
                    dataType: "json",
                    success: function (data) {
                        if (data.existe == 1) {
                            // Si ya existe un contrato activo, mostrar alerta y no abrir el modal
                            Swal.fire("", "Ya tiene un Contrato Activo, Finaliza el Anterior o Agrega una Prórroga", "warning");
                        } else if (data.existe == 0) {
                            // Si no hay contrato activo, abrir el modal para crear un nuevo contrato
                            $("#nuevoModalContratos").modal("show");
                        } else {
                            Swal.fire("", "Error al validar el contrato", "error");
                        }
                    },
                    error: function (xhr, status, error) {
                        Swal.fire("", "Error al validar el contrato: " + error, "error");
                    }
                });
            });

            // Manejar el evento de submit del formulario dentro del modal
            $("#formCrearContratos").submit(function (e) {
                e.preventDefault();  // Evitar la recarga de la página

                // Obtener los datos del formulario
                var identidad = $.trim($("#puesto-trabajo").val());
                var nombre = $.trim($("#nombre-empleado").val());
                var apellido = $.trim($("#apellido-empleado").val());
                var departamento = $("#departamento-empresa").val();
                var area = $("#areas-empresa").val();
                var cargo = $("#cargos-empresa").val();
                var pkEmpleado = $('#id-empleado').val() || $('#edit-id-empleado').val();
                var descripcion = $("#descripcion").val();
                let tipo_contrato = $("#tipo_contrato").val();
                let inicioContratoVal = $("#inicioContratos").val();  // Obtener el valor de inicio contrato
                let finalContratoVal = $("#finalContratos").val();    // Obtener el valor de fin contrato



                // Validar campos individualmente y mostrar una alerta específica para cada campo vacío
                if (!identidad) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Advertencia',
                        text: 'El campo "DNI" no puede estar vacío.',
                    });
                    return;
                }

                if (!nombre) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Advertencia',
                        text: 'El campo "Nombre del Empleado" no puede estar vacío.',
                    });
                    return;
                }

                if (!apellido) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Advertencia',
                        text: 'El campo "Apellido del Empleado" no puede estar vacío.',
                    });
                    return;
                }

                if (!departamento) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Advertencia',
                        text: 'Por favor, selecciona un "Departamento".',
                    });
                    return;
                }

                if (!area) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Advertencia',
                        text: 'Por favor, selecciona un "Área".',
                    });
                    return;
                }

                if (!cargo) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Advertencia',
                        text: 'Por favor, selecciona un "Cargo".',
                    });
                    return;
                }

                if (!tipo_contrato) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Advertencia',
                        text: 'Por favor, selecciona un "Tipo de Contrato".',
                    });
                    return;
                }

                if (tipo_contrato == 2 && !inicioContratoVal) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Advertencia',
                        text: 'Por favor, selecciona la fecha de inicio.',
                    });
                    return;
                }

                if (tipo_contrato == 1 && (!inicioContratoVal || !finalContratoVal)) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Advertencia',
                        text: 'Por favor, selecciona las fechas de inicio y fin de contrato.',
                    });
                    return;
                }

                if (new Date(inicioContratoVal) > new Date(finalContratoVal)) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Advertencia',
                        text: 'La fecha de inicio no puede ser posterior a la fecha de finalización.',
                    });
                    return;
                }

                // Enviar los datos con AJAX
                $.ajax({
                    beforeSend: function (xhr, type) {
                        if (!type.crossDomain) {
                            xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'));
                        }
                    },
                    url: "http://localhost/EVAC/public/api/save/new/contrato",
                    type: "POST",
                    datatype: "json",
                    data: {
                        identidad: identidad,
                        pkEmpleado: pkEmpleado,
                        nombreEmpleado: nombre + ' ' + apellido,
                        descripcion: descripcion,
                        tipo_contrato: tipo_contrato,
                        inicioContrato: inicioContratoVal,
                        finalContrato: finalContratoVal,
                        userName: "{{ userName }}",
                        hidden_cargo: cargo,
                        hidden_area: area,
                        hidden_departamento: departamento
                    },
                    success: function (data) {
                        if (data.save == 1) {
                            $('#nuevoModalContratos').modal('hide');

                            // Recargar la tabla después de guardar el contrato
                            if ($.fn.DataTable.isDataTable('#allContratosTable')) {
                                $('#allContratosTable').DataTable().ajax.reload(null, false);
                            }

                            // Limpiar formulario y resetear select2
                            $('#formCrearContratos')[0].reset();
                            $('#tipo_contrato').val(null).trigger('change');

                            Swal.fire("¡Éxito!", "Contrato Creado Exitosamente.", "success");
                        } else {
                            Swal.fire("", "Error!: " + data.error, "error");
                        }
                    },
                    error: function (error) {
                        Swal.fire("", "Error: " + error, "error");
                    }
                });
            });


        });

        var fotoInput = $('#foto-input');
        var empleadoFoto = $('#empleado-foto');

        if (fotoInput.length && empleadoFoto.length) {
            fotoInput.on('change', function (event) {
                var reader = new FileReader();
                reader.onload = function () {
                    empleadoFoto.attr('src', reader.result);
                    // Detener la animación cuando se sube una imagen
                    empleadoFoto.removeClass('animated-pulse');
                }
                reader.readAsDataURL(event.target.files[0]);
            });
        } else {
            console.error('Elemento "foto-input" o "empleado-foto" no encontrado.');
        }
    });



    $(document).ready(function () {

        $('#nombre-empleado').on('keydown', function (e) {
            var nombreEmpleado = $(this).val().trim();
            var palabras = nombreEmpleado.split(/\s+/);

            if (palabras.length === 1 && e.key === ' ') {
                console.log('Primera palabra detectada: ' + palabras[0]);
            }

            if (palabras.length === 2 && e.key === ' ') {
                console.log('Segunda palabra detectada: ' + palabras[1]);

                // Evitar que se añadan más espacios después de la segunda palabra
                e.preventDefault();
            }

            if (palabras.length >= 2 && palabras.length === 3 && e.key !== 'Backspace' && e.key !== 'Delete' && e.key !== 'ArrowLeft' && e.key !== 'ArrowRight') {
                // Evitar que se escriban más letras si ya hay dos palabras completas
                e.preventDefault();
            }

            if (palabras.length > 2) {
                $('#nombre-error').show();

                // Limitar a las dos primeras palabras
                $(this).val(palabras.slice(0, 2).join(' '));
            } else {
                $('#nombre-error').hide();
            }
        });
    });

    $('#apellido-empleado').on('keydown', function (e) {
        var apellidoEmpleado = $(this).val().trim();
        var palabras = apellidoEmpleado.split(/\s+/);

        if (palabras.length === 1 && e.key === ' ') {
            console.log('Primera palabra detectada: ' + palabras[0]);
        }

        if (palabras.length === 2 && e.key === ' ') {
            console.log('Segunda palabra detectada: ' + palabras[1]);
        }

        if (palabras.length === 3 && e.key === ' ') {
            console.log('Tercera palabra detectada: ' + palabras[2]);

            // Evitar que se añadan más espacios después de la tercera palabra
            e.preventDefault();
        }

        if (palabras.length >= 3 && palabras.length === 4 && e.key !== 'Backspace' && e.key !== 'Delete' && e.key !== 'ArrowLeft' && e.key !== 'ArrowRight') {
            // Evitar que se escriban más letras si ya hay tres palabras completas
            e.preventDefault();
        }

        if (palabras.length > 3) {
            $('#apellido-error').show();

            // Limitar a las tres primeras palabras
            $(this).val(palabras.slice(0, 3).join(' '));
        } else {
            $('#apellido-error').hide();
        }
    });

    document.addEventListener('DOMContentLoaded', function () {
        var editIdEmpleado = $('#edit-id-empleado').val();  // Obtener el valor del campo oculto para edición
        var idEmpleado = $('#id-empleado').val();  // Obtener el valor del ID del empleado

        // Verificar si estamos en modo de edición
        if (idEmpleado) {
            // Si hay ID de empleado, es edición, así que mostramos el campo
            $('#cod-empleado-container').removeClass('hidden');
        }



        // Primero, realiza la solicitud AJAX
        $.ajax({
            url: "{% url 'obtener_estados_empleado_json' %}",
            method: "GET",
            success: function (data) {
                var selectElement = $('#estado-empleado');
                var estados = data.estados;
                var estadoActivoId = data.estado_activo_id;

                estados.forEach(function (est) {
                    var option = $('<option></option>')
                        .attr('value', est.id_estado)
                        .text(est.estado_empleado);

                    if (est.id_estado == estadoActivoId) {
                        option.attr('selected', 'selected');
                    }

                    selectElement.append(option);
                });

                // Después de cargar las opciones, verifica el modo de edición
                if (editIdEmpleado) {
                    $('#estado-empleado').prop('disabled', false);
                } else {
                    $('#estado-empleado').prop('disabled', true);
                }

                console.log("Estados cargados correctamente.");
            },
            error: function (xhr, status, error) {
                console.log("Error al cargar los estados: " + error);
            }
        });
    });

    // Carga los datos del empleado al formulario
    document.getElementById('foto-input').addEventListener('change', function (event) {
        var input = event.target;
        var reader = new FileReader();
        reader.onload = function () {
            var dataURL = reader.result;
            var output = document.getElementById('empleado-foto');
            output.src = dataURL;
            document.getElementById('foto-ruta').value = dataURL;
        };
        reader.readAsDataURL(input.files[0]);
    });

    document.getElementById('fileInput').addEventListener('change', function (event) {
        var files = event.target.files;
        var previewContainer = document.getElementById('preview');
        previewContainer.innerHTML = ''; // Clear previous previews

        Array.from(files).forEach(function (file) {
            var fileReader = new FileReader();

            fileReader.onload = function (e) {
                var fileElement;
                var fileType = file.type;

                if (fileType.startsWith('image/')) {
                    fileElement = `<img src="${e.target.result}" class="img-thumbnail" style="width: 50px; height: 50px;" alt="${file.name}">`;
                } else if (fileType === 'application/pdf') {
                    fileElement = `<i class="fas fa-file-pdf" style="font-size: 50px; color: red;"></i>`;
                } else if (fileType === 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet') {
                    fileElement = `<i class="fas fa-file-excel" style="font-size: 50px; color: green;"></i>`;
                } else if (fileType === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document') {
                    fileElement = `<i class="fas fa-file-word" style="font-size: 50px; color: blue;"></i>`;
                } else {
                    fileElement = `<i class="fas fa-file" style="font-size: 50px; color: gray;"></i>`;
                }

                previewContainer.innerHTML += `<div>${fileElement}<p>${file.name}</p></div>`;
            };

            fileReader.readAsDataURL(file);
        });
    });

    $(document).ready(function () {
        // Obtener el ID del empleado al inicio
        let idEmpleado = $('#id-empleado').val() || $('#edit-id-empleado').val();

        // Cargar los documentos del empleado cuando se edita
        if (idEmpleado) {
            cargarDocumentosEmpleado(idEmpleado);
        }

        function cargarDocumentosEmpleado(idEmpleado) {
            $.ajax({
                url: "{% url 'obtener_documentos_empleado' %}",
                type: 'GET',
                data: { id_empleado: idEmpleado },
                success: function (response) {
                    console.log('Respuesta completa:', response);
                    if (response.status === 'success') {
                        var documentosContainer = $('#documentos-container');
                        documentosContainer.empty();  // Limpiar el contenedor antes de añadir los documentos

                        if (response.documentos.length > 0) {
                            response.documentos.forEach(function (documento) {
                                console.log('Datos del documento:', documento);

                                // Usar el campo 'ruta' en lugar de 'nombre'
                                let nombreDocumento = documento.ruta.split('\\').pop(); // Obtener solo el nombre del archivo desde la ruta

                                var docHtml = '';

                                // Comprobar el tipo de archivo y agregar el HTML correspondiente con enlace de descarga
                                if (nombreDocumento.match(/\.(jpg|jpeg|png|gif)$/)) {
                                    docHtml = `
                                <div class="documento">
                                    <a href="/media/${documento.ruta}" download="${nombreDocumento}">
                                        <img src="/media/${documento.ruta}" alt="${nombreDocumento}" style="width: 50px; height: 50px;">
                                        <span>${nombreDocumento}</span>
                                    </a>
                                </div>
                            `;
                                } else if (nombreDocumento.match(/\.pdf$/)) {
                                    docHtml = `
                                <div class="documento">
                                    <a href="/media/${documento.ruta}" download="${nombreDocumento}">
                                        <i class="fas fa-file-pdf" style="font-size: 50px; color: red;"></i>
                                        <span>${nombreDocumento}</span>
                                    </a>
                                </div>
                            `;
                                } else if (nombreDocumento.match(/\.(xls|xlsx)$/)) {
                                    docHtml = `
                                <div class="documento">
                                    <a href="/media/${documento.ruta}" download="${nombreDocumento}">
                                        <i class="fas fa-file-excel" style="font-size: 50px; color: green;"></i>
                                        <span>${nombreDocumento}</span>
                                    </a>
                                </div>
                            `;
                                } else if (nombreDocumento.match(/\.(doc|docx)$/)) {
                                    docHtml = `
                                <div class="documento">
                                    <a href="/media/${documento.ruta}" download="${nombreDocumento}">
                                        <i class="fas fa-file-word" style="font-size: 50px; color: blue;"></i>
                                        <span>${nombreDocumento}</span>
                                    </a>
                                </div>
                            `;
                                }

                                documentosContainer.append(docHtml);
                            });
                        } else {
                            documentosContainer.html('<p class="text-muted">No hay documentos disponibles.</p>');
                        }
                    } else {
                        console.error('Error al cargar documentos:', response.error);
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Error al cargar los documentos: ' + response.error,
                        });
                    }
                },
                error: function (response) {
                    console.error('Error en la solicitud:', response.responseText);
                    Swal.fire({
                        icon: 'error',
                        title: 'Error en la solicitud',
                        text: 'Error al cargar los documentos: ' + response.responseText,
                    });
                }
            });
        }

        // Guardar los documentos cuando se hace clic en el botón "saveFiles"
        $('#saveFiles').on('click', function () {
            let idEmpleado = $('#id-empleado').val() || $('#edit-id-empleado').val();

            var formData = new FormData();

            // Asegurarse de obtener el valor de idEmpleado si se está editando
            if (!idEmpleado) {
                idEmpleado = $('#edit-id-empleado').val();
            }

            if (!idEmpleado) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'No se pudo obtener el ID del empleado.',
                });
                return;
            }

            formData.append('id_empleado', idEmpleado); // Añadir idEmpleado al formData

            var archivos = $('#fileInput')[0].files;
            for (var i = 0; i < archivos.length; i++) {
                formData.append('documentos', archivos[i]);
            }

            $.ajax({
                url: "{% url 'guardar_documentos' %}",
                type: 'POST',
                data: formData,
                contentType: false,
                processData: false,
                success: function (response) {
                    if (response.status === 'success') {
                        cargarDocumentosEmpleado(idEmpleado);  // Recargar los documentos después de guardar
                        $('#modalAccesos').modal('hide');
                        toastr.success('Documentos guardados exitosamente.');
                    } else {
                        console.error('Error al guardar documentos:', response.error);
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Error al guardar los documentos: ' + response.error,
                        });
                    }
                },
                error: function (response) {
                    console.error('Error en la solicitud:', response.responseText);
                    Swal.fire({
                        icon: 'error',
                        title: 'Error en la solicitud',
                        text: 'Error al guardar los documentos: ' + response.responseText,
                    });
                }
            });
        });
    });

    $(document).ready(function () {

        toastr.options = {
            "closeButton": true,
            "debug": false,
            "newestOnTop": true,
            "progressBar": true,
            "positionClass": "toast-top-right",
            "preventDuplicates": false,
            "onclick": null,
            "showDuration": "300",
            "hideDuration": "1000",
            "timeOut": "5000",
            "extendedTimeOut": "1000",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
        };

        let currentTabId = 'curriculo-tab';

        function handleTabChange(newTabId) {
            if (currentTabId === 'private-info-tab') {

            } else if (currentTabId === 'trabajo-info-tab') {

            } else if (currentTabId === 'curriculo-tab') {

            } else if (currentTabId === 'config-rrhh-tab') {

            } else if (currentTabId === 'config-bitacora-tab') {

            }

            currentTabId = newTabId;
        }

        // Función para manejar el cambio de pestaña
        function switchTab(activeTab, activeSection) {
            // Remover clases 'show active' de todas las secciones
            $('#curriculo-sec, #trabajo-info-sec, #private-info-sec, #config-rrhh-sec, #config-bitacora-sec').removeClass('show active');

            // Remover clase 'active' de todas las pestañas
            $('#curriculo-tab, #trabajo-info-tab, #private-info-tab, #config-rrhh-tab, #config-bitacora-tab').removeClass('active');

            // Agregar clases 'show active' a la sección seleccionada
            $('#' + activeSection).addClass('show active');

            // Agregar clase 'active' a la pestaña seleccionada
            $('#' + activeTab).addClass('active');

            // Llamar a la función de manejo adicional de pestaña
            handleTabChange(activeTab);
        }


        // Event listeners para cada pestaña
        $('#private-info-tab').on('click', function () {
            console.log('Private info tab clicked');

            switchTab('private-info-tab', 'private-info-sec');
        });

        $('#config-rrhh-tab').on('click', function () {

            switchTab('config-rrhh-tab', 'config-rrhh-sec');
        });

        $('#config-bitacora-tab').on('click', function () {
            console.log('Config Bitacora tab clicked');
            switchTab('config-bitacora-tab', 'config-bitacora-sec');
        });

        $('#curriculo-tab').on('click', function () {
            console.log('Curriculo tab clicked');

            switchTab('curriculo-tab', 'curriculo-sec');
        });

        $('#trabajo-info-tab').on('click', function () {
            // Verificar si la tabla ya está inicializada

            var allContratosTable;

            if (!$.fn.DataTable.isDataTable('#allContratosTable')) {

                // Inicializa DataTable solo si no está inicializada
                var buttons = "Blrtip";

                $("#allContratosTable tfoot th").each(function () {
                    var title = $(this).text();
                    $(this).html('<input class="form-control form-control-sm" type="text" placeholder="' + title + '" />');
                });

                var allContratosTable = $("#allContratosTable").DataTable({
                    beforeSend: function (xhr, type) {
                        if (!type.crossDomain) {
                            xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'));
                        }
                    },
                    initComplete: function () {
                        this.api()
                            .columns()
                            .every(function () {
                                var that = this;

                                $("input", this.footer()).on("keyup change clear", function () {
                                    if (that.search() !== this.value) {
                                        that.search(this.value).draw();
                                    }
                                });
                            });
                    },
                    dom: buttons,
                    buttons: [
                        {
                            extend: 'excel',
                            text: '<i class="fas fa-file-excel"></i>',
                            titleAttr: 'Excel',
                            className: 'btn btn-success',
                        },
                        {
                            extend: 'pdf',
                            text: '<i class="fas fa-file-pdf"></i>',
                            titleAttr: 'PDF',
                            className: 'btn btn-danger',
                        },
                        {
                            extend: 'print',
                            text: '<i class="fas fa-print"></i>',
                            titleAttr: 'Imprimir',
                            className: 'btn btn-null',
                        }
                    ],
                    ajax: {
                        url: "http://localhost/EVAC/public/api/list/contratos/x/empleado/0", // Valor inicial
                        dataSrc: function (json) {
                            // Validar si la respuesta de la API fue exitosa
                            if (json.success) {
                                return json.data;
                            } else {
                                console.error('Error en la respuesta de la API');
                                return [];
                            }
                        }
                    },
                    language: {
                        "processing": "Procesando...",
                        "lengthMenu": "Mostrar _MENU_ registros",
                        "zeroRecords": "No se encontraron resultados",
                        "emptyTable": "Ningún dato disponible en esta tabla",
                        "info": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                        "infoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                        "infoFiltered": "(filtrado de un total de _MAX_ registros)",
                        "search": "Buscar:",
                        "paginate": {
                            "first": "Primero",
                            "last": "Último",
                            "next": "Siguiente",
                            "previous": "Anterior"
                        },
                    },
                    order: [
                        [1, "desc"]
                    ],
                    columns: [
                        { data: "id_contrato", width: "8%" },
                        { data: "identidad" },
                        { data: "nombre_usuario" },
                        {
                            data: "contrato",
                            className: "text-center",
                            render: function (data, type, row) {
                                var badge = data === "Indefinido"
                                    ? '<span class="badge badge-pill badge-success">' + data + '</span>'
                                    : '<span class="badge badge-pill badge-warning">' + data + '</span>';
                                return badge;
                            }
                        },
                        {
                            data: "estado",
                            className: "text-center",
                            render: function (data) {
                                var badge = "";
                                if (data == 1) {
                                    badge = '<span class="badge badge-pill badge-success">Activo</span>';
                                } else if (data == 3) {
                                    badge = '<span class="badge badge-pill badge-danger">Anulado</span>';
                                } else if (data == 4) {
                                    badge = '<span class="badge badge-pill badge-warning">Finalizado</span>';
                                }
                                return badge;
                            }
                        },
                        { data: "cantMeses", className: "text-center" },
                        {
                            data: "estado",
                            className: "text-center",
                            render: function (data, type, row) {
                                var badge = "";

                                if (data == 4) {
                                    // Solo muestra el botón 'Ver Detalles'
                                    badge += "<div class='text-center' data-id='" + row.id_contrato + "'><div class='btn-group'>" +
                                        "<button title='Ver Detalles' class='btn btn-primary btn-sm btnDetails'><i class='material-icons'>checklist</i></button>" +
                                        "</div></div>";
                                } else {
                                    // Muestra todos los botones
                                    badge += "<div class='text-center' data-id='" + row.id_contrato + "'><div class='btn-group'>" +
                                        "<button title='Ver Detalles' class='btn btn-primary btn-sm btnDetails'><i class='material-icons'>checklist</i></button>" +
                                        "<button title='Finalizar' class='btn btn-warning btn-sm btnEliminar'><i class='material-icons'>unpublished</i></button>" +
                                        "<button title='Cambiar estado' class='btn btn-danger  btn-sm btnAnular'><i class='material-icons'>change_circle</i></button>" +

                                        "</div></div>";
                                }

                                return badge;
                            }
                        }
                    ],
                });

                // Función para actualizar la tabla cuando se selecciona un empleado
                function actualizarTablaContratosPorIdentidad() {
                    var identidad = $("#puesto-trabajo").val(); // Obtener el valor de identidad
                    console.log("Cambio a la pestaña de Trabajo, identidad:", identidad);

                    if (identidad) {
                        var newUrl = "http://localhost/EVAC/public/api/list/contratos/x/empleado/" + identidad;
                        allContratosTable.ajax.url(newUrl).load();
                    } else {
                        allContratosTable.ajax.url("http://localhost/EVAC/public/api/list/contratos/x/empleado/0").load();
                    }
                }

                actualizarTablaContratosPorIdentidad();

                $(document).on('click', '.btnAnular', function (e) {
                    e.preventDefault();

                    let $row = $(this).closest('tr');  // Obtener la fila de la tabla
                    let idContrato = $row.find('div[data-id]').data('id');  // Obtener el ID del contrato desde el atributo data-id
                    let estadoActual = $row.find('td:eq(4)').text().trim();  // Obtener el estado actual desde la columna 4 (índice 4)
                    let usuario = '{{ userName }}';  // Asume que tienes el usuario en el contexto

                    console.log('idContrato:', idContrato);  // Para depuración
                    console.log('usuario:', usuario);
                    console.log('estadoActual:', estadoActual);  // Verificar estado actual

                    // Definir el nuevo estado basado en el estado actual
                    let nuevoEstado;
                    if (estadoActual === 'Anulado') {
                        nuevoEstado = 1;  // Reactivar el contrato
                    } else {
                        nuevoEstado = 3;  // Anular el contrato
                    }

                    Swal.fire({
                        title: '¿Estás seguro?',
                        text: "¿Deseas cambiar el estado de este contrato?",
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Sí, cambiar',
                        cancelButtonText: 'Cancelar'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            // Si el usuario confirma, proceder con la solicitud AJAX
                            var formData = new FormData();
                            formData.append('id_contrato', idContrato);
                            formData.append('estado', nuevoEstado);  // Pasar el nuevo estado dinámicamente
                            formData.append('usuario', usuario);
                            formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');

                            $.ajax({
                                url: '{% url "actualizar_contrato" %}',
                                method: 'POST',
                                data: formData,
                                processData: false,
                                contentType: false,
                                success: function (response) {
                                    if (response.status === 'success') {
                                        Swal.fire({
                                            icon: 'success',
                                            title: 'Estado Actualizado',
                                            text: 'El estado del contrato ha sido actualizado correctamente.',
                                            timer: 2000,
                                            showConfirmButton: false
                                        });

                                        // En lugar de recargar la página, llamamos a la función para actualizar la tabla
                                        actualizarTablaContratosPorIdentidad();  // Llamar a la función que actualiza la tabla
                                    } else {
                                        Swal.fire({
                                            icon: 'error',
                                            title: 'Error',
                                            text: 'Error: ' + response.message,
                                            confirmButtonText: 'Aceptar'
                                        });
                                    }
                                },
                                error: function (xhr, status, error) {
                                    Swal.fire({
                                        icon: 'error',
                                        title: 'Error',
                                        text: 'Ocurrió un error al intentar actualizar el contrato.',
                                        confirmButtonText: 'Aceptar'
                                    });
                                    console.error('Error al actualizar el contrato:', error);
                                }
                            });
                        }
                    });
                });

                $(document).on('click', '.btnEliminar', function (e) {
                    e.preventDefault();  // Prevenir el comportamiento por defecto

                    // Obtener el ID del contrato desde el atributo 'data-id'
                    let $row = $(this).closest('tr');
                    let idContrato = $row.find('div[data-id]').data('id');  // Asegúrate de que 'data-id' existe en el div
                    let usuario = '{{ userName }}';  // Puedes obtener el usuario de la sesión o de otro lugar
                    let estadoActual = $row.find('td:eq(4)').text().trim();


                    // Confirmación de la acción de finalizar utilizando SweetAlert2
                    Swal.fire({
                        title: '¿Estás seguro?',
                        text: "Estás a punto de finalizar este contrato. Esta acción no se puede deshacer.",
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Sí, finalizar',
                        cancelButtonText: 'Cancelar'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            var formData = new FormData();  // Usa FormData para pasar los datos si estás usando archivos
                            formData.append('id_contrato', idContrato);
                            formData.append('estado', 4);  // Estado 4 para "Finalizado"
                            formData.append('usuario', usuario);
                            formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');

                            $.ajax({
                                url: '{% url "actualizar_contrato" %}',  // Asegúrate de que esta URL es correcta
                                method: 'POST',
                                data: formData,
                                processData: false,  // Evitar el procesamiento automático de los datos
                                contentType: false,  // Establecer en false para permitir que FormData maneje el tipo de contenido
                                success: function (response) {
                                    if (response.status === 'success') {


                                        // Recargar la tabla sin recargar toda la página
                                        actualizarTablaContratosPorIdentidad();   // Recarga solo los datos de la tabla
                                    } else {
                                        Swal.fire({
                                            icon: 'error',
                                            title: 'Error',
                                            text: 'Error: ' + response.message,
                                            confirmButtonText: 'Aceptar'
                                        });
                                    }
                                },
                                error: function (xhr, status, error) {
                                    Swal.fire({
                                        icon: 'error',
                                        title: 'Error',
                                        text: 'Ocurrió un error al intentar finalizar el contrato.',
                                        confirmButtonText: 'Aceptar'
                                    });
                                    console.error('Error al finalizar el contrato:', error);
                                }
                            });
                        }
                    });
                });


            }




            var opcionVacacioens;
            var id;



            // Obtener el ID del empleado desde los elementos de entrada
            var identidadEmpleado = $('#puesto-trabajo').val();
             // Obtener el ID del empleado desde los elementos de entrada
             var idEmpleadoVacaciones = $('#id-empleado').val() || $('#edit-id-empleado').val();


            // Genera la URL desde el template de Django
            var url = "{% url 'obtener_vacaciones'  %}";

            var calculosVacacionesTable;

            function initializeTableVacaciones(identidadEmpleado) {

                // Destruir la tabla existente si existe
                if ($.fn.DataTable.isDataTable('#calculosVacacionesTable')) {
                    $('#calculosVacacionesTable').DataTable().clear().destroy();
                }

                // Inicializar la tabla de cálculos de vacaciones
                calculosVacacionesTable = $('#calculosVacacionesTable').DataTable({
                    autoWidth: true,
                    scrollX: false,
                    autoWidth: false,  // Aseguramos que autoWidth esté desactivado
                    language: {
                        "processing": "Procesando...",
                        "lengthMenu": "Mostrar _MENU_ registros",
                        "zeroRecords": "No se encontraron resultados",
                        "emptyTable": "Ningún dato disponible en esta tabla",
                        "info": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                        "infoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                        "search": "Buscar:",
                        "paginate": {
                            "first": "Primero",
                            "last": "Último",
                            "next": "Siguiente",
                            "previous": "Anterior"
                        }
                    },
                    ajax: {
                        beforeSend: function (xhr, type) {
                            if (!type.crossDomain) {
                                xhr.setRequestHeader(
                                    'X-CSRF-Token',
                                    $('meta[name="csrf-token"]').attr('content')
                                );
                            }
                        },
                        url: url,  // Ajusta la URL correcta
                        type: "GET",
                        data: function (d) {
                            d.identidad = identidadEmpleado;  // Asegúrate de pasar el ID del empleado correcto
                        },
                        dataSrc: function (json) {
                            console.log('Datos recibidos de la solicitud AJAX:', json);
                            if (json.data && json.data.length > 0) {
                                let totalDias = json.data[0].total;  // Obtener el total de días disponibles
                                $('#diasDisponibles').val(totalDias);  // Asignar el valor al input
                            }
                            return json.data || [];
                        },
                        error: function (xhr, status, error) {
                            console.error('Error en la solicitud AJAX:', error);
                            console.log('Detalles del error AJAX:', xhr.responseText);
                        }
                    },
                    columns: [
                        { data: 'id_empleado', className: 'text-center', width: "10%" },
                        { data: 'fecha_inicio', className: 'text-center', width: "20%" },
                        { data: 'fecha_actual', className: 'text-center', width: "20%" },
                        { data: 'tiempo_transcurrido', className: 'text-center', width: "15%" },
                        { data: 'dias_proporcionales', className: 'text-center', width: "10%" },
                        { data: 'dias_tomados', className: 'text-center', width: "10%" },
                        { data: 'total', className: 'text-center', width: "15%" }
                    ],
                    order: [[0, "asc"]],
                    initComplete: function () {
                        setTimeout(function () {
                            calculosVacacionesTable.columns.adjust().draw();
                        }, 100);
                    }
                });
            }

            if (identidadEmpleado) {
                initializeTableVacaciones(identidadEmpleado);
            } else {
                $('#table-container').html('<p>No hay un empleado seleccionado. Por favor, seleccione un empleado para ver los cálculos de vacaciones.</p>');
            }

            var toastMixin = Swal.mixin({
                toast: true,
                icon: 'success',
                title: 'General Title',
                animation: false,
                position: 'top-right',
                showConfirmButton: false,
                timer: 2000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer)
                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                }
            });


            $('#btnNuevoVacaciones').click(function (e) {
                e.preventDefault();

                // Reiniciar el formulario
                $('#formVacaciones').trigger("reset");

                // Configurar el estilo del modal
                $(".modal-header").css("background-color", "#17a2b8");
                $(".modal-header").css({
                    "color": "white",
                    "font-weight": "900"
                });
                $(".modal-title").text("NUEVAS VACACIONES PARA EMPLEADO");

                // Mostrar el modal
                $('#modalVacaciones').modal("show");

                // Definir valores para opcionVacacioens y id
                opcionVacacioens = 1;
                id = null;
            });

            $('#formVacaciones').submit(function (e) {
                e.preventDefault();

                let empleadoVacaciones = $('#empleadoVacaciones').val();
                let inicioVacaciones = $('#inicioVacaciones').val();
                let finalVacaciones = $('#finalVacaciones').val();
                let commentVacaciones = $('#commentVacaciones').val();
                // Obtener los días disponibles
                let diasDisponibles = parseFloat($('#diasDisponibles').val());

                let fechaInicio = new Date(inicioVacaciones);
                let fechaFinal = new Date(finalVacaciones);
                let diasSolicitados = (fechaFinal - fechaInicio) / (1000 * 60 * 60 * 24) + 1; // +1 para incluir el primer día
                
                console.log("Dias solicitados: " + diasSolicitados);
                // Validar que los días solicitados no superen los días disponibles
                if (diasSolicitados > diasDisponibles) {
                    Swal.fire("", "Los días solicitados (" + diasSolicitados + ") superan los días disponibles (" + diasDisponibles + ")", "warning");
                    return; // Detener el envío del formulario
                }

                if (empleadoVacaciones == "#" || !$('#inicioVacaciones').val() || !$('#finalVacaciones').val()) {
                    Swal.fire("", "Debes seleccionar todos los campos!", "warning");
                } else {
                    try {
                        $.ajax({
                            beforeSend: function (xhr, type) {
                                if (!type.crossDomain) {
                                    xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'));
                                }
                            },
                            url: "http://localhost/EVAC/public/api/save/edit/vacaciones",  // Ajusta la URL según sea necesario
                            type: "POST",
                            datatype: "json",
                            data: {
                                id: id,  // Este es el ID de la vacación si estás editando, asegúrate de que esté definido
                                empleado: idEmpleadoVacaciones,  // ID del empleado seleccionado
                                date1: inicioVacaciones,  // Fecha de inicio de las vacaciones
                                date2: finalVacaciones,  // Fecha de finalización de las vacaciones
                                comment: commentVacaciones,  // Comentario adicional
                                opcion: opcionVacacioens,  // Define si estás creando o editando (1 para crear, 2 para editar)
                                userName: '{{userName}}',  // Usuario que realiza la acción
                            },
                            success: function (data) {
                                if (data.existe == '1') {
                                    Swal.fire("", "Ya existen vacaciones en este periodo para este Empleado!", "warning");
                                } else {
                                    if (data.save == 1) {


                                        // Ocultar el modal de vacaciones
                                        $("#modalVacaciones").modal("hide");

                                        // Recargar las tablas de vacaciones y cálculos de vacaciones
                                        if (vacacionesTable) {
                                            vacacionesTable.ajax.reload(null, false);  // Recargar los datos de la tabla de vacaciones
                                            calculosVacacionesTable.ajax.reload(null, false);
                                        }

                                    } else {
                                        Swal.fire("", "Error!: " + data.error, "error");
                                    }
                                }
                            },
                            error: function (error) {
                                Swal.fire("", "Error al guardar las vacaciones: " + error, "error");
                            }
                        });
                    } catch (error) {
                        Swal.fire("", "Error: " + error, "error");
                    }
                }
            });


            // Delegación de eventos para el botón de asignar ticket
            $('#vacacionesTable tbody').on('click', '.btnAssignTicket', function (event) {
                event.preventDefault();
                $('#modalRelacionarTicketsComunes').modal('show');
            });

            // Delegación de eventos para el botón de cerrar dentro del modal
            $('.btn_close_modal_tickets_comunes').on('click', function (event) {
                event.preventDefault();
                $('#modalRelacionarTicketsComunes').modal('hide');
            });

            $(document).on('click', '.btnAssignTicket', function () {

                fila = $(this).closest("tr");

                id = fila.find("td:eq(0)").text();

                if (!id || id === "") {
                    id = 0;
                }

                empleado = fila.find("td:eq(2)").text();

                $('#ticketsDisponiblesSection').css('visibility', 'hidden');
                $('#ticketsDisponiblesSection').css('height', '0');

                $('#ticketsAsignadosSection').css('visibility', 'visible');
                $('#ticketsAsignadosSection').css('height', 'auto');



                $("#tableTicketsComunesAsignados").DataTable().clear().destroy();

                tableTicketsComunesAsignados = $("#tableTicketsComunesAsignados").DataTable({
                    initComplete: function () {

                    },
                    ajax: {
                        url: "http://localhost/EVAC/public/api/fill/table/tickets/relacionados/vacaciones/" + id,
                        error: function (xhr, error, thrown) {
                            console.error("Error al cargar los datos del DataTable:", xhr.responseText);
                            alert("Error al cargar los tickets asignados: " + xhr.responseText);
                        }

                    },
                    language: {
                        "processing": "Procesando...",
                        "lengthMenu": "Mostrar _MENU_ registros",
                        "zeroRecords": "No se encontraron resultados",
                        "emptyTable": "Ningún dato disponible en esta tabla",
                        "info": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                        "infoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                        "infoFiltered": "(filtrado de un total de _MAX_ registros)",
                        "search": "Buscar:",
                        "infoThousands": ",",
                        "loadingRecords": "Cargando...",
                        "paginate": {
                            "first": "Primero",
                            "last": "Último",
                            "next": "Siguiente",
                            "previous": "Anterior"
                        },
                        "aria": {
                            "sortAscending": ": Activar para ordenar la columna de manera ascendente",
                            "sortDescending": ": Activar para ordenar la columna de manera descendente"
                        },
                        "buttons": {
                            "copy": "Copiar",
                            "colvis": "Visibilidad"
                        }
                    },
                    order: [
                        [5, "desc"]
                    ],
                    dom: 'Bfrtip',  // Esto permite que se muestren los botones de exportación
                    buttons: [{
                        extend: 'excel',
                        text: '<i class="fas fa-file-excel"></i>',
                        titleAttr: 'Excel',
                        className: 'btn btn-success',
                    },
                    {
                        extend: 'pdf',
                        text: '<i class="fas fa-file-pdf"></i>',
                        titleAttr: 'PDF',
                        className: 'btn btn-danger',
                    },
                    {
                        extend: 'print',
                        text: '<i class="fas fa-print"></i>',
                        titleAttr: 'Imprimir',
                        className: 'btn btn-warning',
                    }
                    ],
                    columns: [{
                        data: 'id_secuencia',
                        width: '5%'
                    },
                    {
                        data: 'asunto'
                    },
                    {
                        data: 'descripcion',
                        className: 'text-wrap'
                    },
                    {
                        data: 'fullName_creado_por',
                    },
                    {
                        data: 'fecha_hora_aceptado_rechazado',
                    },
                    {
                        defaultContent: "<div class='text-center'><div class='btn-group'><button class='btn btn-danger btn-sm btnDeleteTicket' id='btnDeleteTicket' title='Eliminar' ><i class='material-icons'>delete</i></button></div></div>",
                    },
                    ],
                    order: [
                        [1, "asc"]
                    ],
                });

                ticketsDisponibles();


                $('#hidden_indicador_id_tickets').val(id);
                $('#modalRelacionarTicketsComunesLabel').text(
                    'ASIGNAR TICKET DE VACACIONES A SOLICITUD DEL EMPLEADO ' +
                    empleado);

                $('#modalRelacionarTicketsComunes').modal('show');
            });

            function ticketsDisponibles() {
                date1 = $('#periodoInicioTicket').val();
                date2 = $('#periodoFinalTicket').val();

                $("#tableTicketsComunesDisponibles").DataTable().clear().destroy();

                tableTicketsComunesDisponibles = $("#tableTicketsComunesDisponibles").DataTable({
                    autoWidth: true,  // Permitir que DataTables ajuste el ancho automáticamente
                    scrollX: false,
                    pageLength: 100,
                    initComplete: function () {

                    },

                    ajax: {

                        url: "http://localhost/EVAC/public/api/fill/table/tickets/no/relacionados/vacaciones/" + date1 + "/" + date2,

                    },


                    language: {
                        "processing": "Procesando...",
                        "lengthMenu": "Mostrar _MENU_ registros",
                        "zeroRecords": "No se encontraron resultados",
                        "emptyTable": "Ningún dato disponible en esta tabla",
                        "info": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                        "infoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                        "infoFiltered": "(filtrado de un total de _MAX_ registros)",
                        "search": "Buscar:",
                        "infoThousands": ",",
                        "loadingRecords": "Cargando...",
                        "paginate": {
                            "first": "Primero",
                            "last": "Último",
                            "next": "Siguiente",
                            "previous": "Anterior"
                        },
                        "aria": {
                            "sortAscending": ": Activar para ordenar la columna de manera ascendente",
                            "sortDescending": ": Activar para ordenar la columna de manera descendente"
                        },
                        "buttons": {
                            "copy": "Copiar",
                            "colvis": "Visibilidad"
                        }
                    },
                    order: [
                        [5, "desc"]
                    ],
                    dom: 'Bfrtip',
                    buttons: [{
                        extend: 'excel',
                        text: '<i class="fas fa-file-excel"></i>',
                        titleAttr: 'Excel',
                        className: 'btn btn-success',
                    },
                    {
                        extend: 'pdf',
                        text: '<i class="fas fa-file-pdf"></i>',
                        titleAttr: 'PDF',
                        className: 'btn btn-danger',
                    },
                    {
                        extend: 'print',
                        text: '<i class="fas fa-print"></i>',
                        titleAttr: 'Imprimir',
                        className: 'btn btn-warning',
                    }
                    ],
                    columns: [{
                        data: 'id_secuencia',
                        width: '5%'
                    },
                    {
                        data: 'asunto'
                    },
                    {
                        data: 'descripcion',
                        className: 'text-wrap'
                    },
                    {
                        data: 'fullName_creado_por',
                    },
                    {
                        data: 'fecha_hora_aceptado_rechazado',
                    },
                    {
                        defaultContent: "<div class='text-center'><div class='btn-group'><button class='btn btn-success btn-sm btnAddTicket' id='btnAddTicket' title='Añadir' ><i class='material-icons'>add</i></button></div></div>",
                    },
                    ],
                    order: [
                        [0, "desc"]
                    ],
                });
            }

            // Ejecutar la función ticketsDisponibles cuando se seleccionen ambas fechas
            $('#periodoInicioTicket, #periodoFinalTicket').on('change', function () {
                ticketsDisponibles();
            });

            $(document).on('click', '.menu-item-head-tickets', function () {
                var id = this.id;

                if (id == 'asignadosTicketsMenu') {
                    $('#ticketsDisponiblesSection').css('visibility', 'hidden');
                    $('#ticketsDisponiblesSection').css('height', '0');

                    $('#ticketsAsignadosSection').css('visibility', 'visible');
                    $('#ticketsAsignadosSection').css('height', 'auto');
                } else if (id == 'disponiblesTicketsMenu') {
                    $('#ticketsDisponiblesSection').css('visibility', 'visible');
                    $('#ticketsDisponiblesSection').css('height', 'auto');

                    $('#ticketsAsignadosSection').css('visibility', 'hidden');
                    $('#ticketsAsignadosSection').css('height', '0');
                }
            });


            if (!$.fn.DataTable.isDataTable('#vacacionesTable')) {
                // Inicializa DataTable solo si no está inicializada
                var vacacionesTable = $("#vacacionesTable").DataTable({
                    ajax: {
                        url: "{% url 'obtener_vacaciones_por_dni' %}",  // Llama a la vista sin parámetros en la URL
                        data: function (d) {
                            // Envía el valor de la identidad en la solicitud GET
                            d.identidad = $("#puesto-trabajo").val();  // Pasar la identidad desde el campo input
                        },
                        dataSrc: function (json) {
                            // Loguear el objeto JSON completo para depuración
                            console.log("Datos recibidos del servidor:", json);

                            // Si no hay datos, devolver un array vacío
                            if (json.status === 'success' && json.data.length > 0) {
                                console.log("Datos de vacaciones:", json.data);
                                return json.data;  // Retornar los datos para la tabla
                            } else {
                                console.warn('No se encontraron datos de vacaciones para este empleado.');
                                return [];  // Retorna un array vacío si no hay datos
                            }
                        }
                    },
                    language: {
                        "processing": "Procesando...",
                        "lengthMenu": "Mostrar _MENU_ registros",
                        "zeroRecords": "No se encontraron resultados para este empleado",
                        "emptyTable": "No hay vacaciones registradas para este empleado",
                        "info": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                        "infoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                        "infoFiltered": "(filtrado de un total de _MAX_ registros)",
                        "search": "Buscar:",
                        "paginate": {
                            "first": "Primero",
                            "last": "Último",
                            "next": "Siguiente",
                            "previous": "Anterior"
                        },
                    },
                    order: [
                        [1, "desc"]
                    ],
                    columns: [
                        { data: "numero", width: "5%" },
                        { data: "dni", className: "text-center" },
                        { data: "empleado", className: "text-center" },
                        { data: "fecha_inicio", className: "text-center" },
                        { data: "fecha_final", className: "text-center" },
                        { data: "dias_vacaciones", className: "text-center" },
                        { data: "comentario", className: "text-center" },
                        { data: "ticket", className: "text-center" },
                        { data: "estado", className: "text-center" },
                        {
                            defaultContent: "<div class='text-center'><div class='btn-group'>" +
                                "<button class='btn btn-primary btn-sm btnEditar' title='Editar'><i class='material-icons'>edit</i></button>" +
                                "<button class='btn btn-info btn-sm btnAssignTicket' title='Asignar Ticket'><i class='material-icons'>confirmation_number</i></button>" +
                                "<button class='btn btn-danger btn-sm btnBorrar' title='Cambiar Estado'><i class='material-icons'>change_circle</i></button>" +
                                "</div></div>",
                        }
                    ],
                });

                // Escuchar el cambio de identidad
                $("#empleado-identidad").on('change', function () {
                    vacacionesTable.ajax.reload();  // Recargar la tabla
                });

                $(document).on('click', '.btnAddTicket', function () {
                    var fila = $(this).closest("tr");
                    var id = $('#hidden_indicador_id_tickets').val();
                    var ticket = fila.find("td:eq(0)").text();

                    try {
                        $.ajax({
                            beforeSend: function (xhr, type) {
                                if (!type.crossDomain) {
                                    xhr.setRequestHeader(
                                        'X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'));
                                }
                            },
                            url: "http://localhost/EVAC/public/api/relacionar/vacaciones/ticket",
                            type: "POST",
                            datatype: "json",
                            async: false,
                            data: {
                                id: id,
                                ticket: ticket,
                                userName: '{{userName}}'
                            },
                            success: function (data) {
                                if (data.save == 1) {
                                    if (data.existe == 0) {
                                        toastMixin.fire({
                                            animation: true,
                                            title: 'Ticket Asignado!'
                                        });
                                    } else {
                                        Swal.fire("", "Ya hay un ticket de Vacaciones Asignado!", "warning");
                                    }

                                    tableTicketsComunesAsignados.ajax.reload(null, false);
                                    tableTicketsComunesDisponibles.ajax.reload(null, false);
                                    if (vacacionesTable) {
                                        vacacionesTable.ajax.reload(null, false);
                                    }
                                } else {
                                    Swal.fire("", "Error L: " + data.error, "error");
                                }
                            },
                        });
                    } catch (error) {
                        Swal.fire("", "Error A: " + error, "error");
                    }
                });

                $(document).on('click', '.btnDeleteTicket', function () {
                    fila = $(this).closest("tr");

                    id = fila.find("td:eq(0)").text();

                    try {
                        $.ajax({
                            beforeSend: function (xhr, type) {
                                if (!type.crossDomain) {
                                    xhr.setRequestHeader(
                                        'X-CSRF-Token', $(
                                            'meta[name="csrf-token"]'
                                        ).attr(
                                            'content'));
                                }
                            },
                            url: "http://localhost/EVAC/public/api/eliminar/vacaciones/ticket",
                            type: "POST",
                            datatype: "json",
                            async: false,
                            data: {
                                id: id,
                                userName: '{{userName}}'
                            },
                            success: function (data) {
                                if (data.save == 1) {

                                    toastMixin.fire({
                                        animation: true,
                                        title: 'Ticket Retirado!'
                                    });

                                    tableTicketsComunesAsignados.ajax.reload(null, false);
                                    tableTicketsComunesDisponibles.ajax.reload(null, false);
                                    vacacionesTable.ajax.reload(null, false);
                                    calculosVacacionesTable.ajax.reload(null, false);

                                } else {

                                    Swal.fire("", "Error L: " + data.error,
                                        "error");

                                }
                            },
                        });
                    } catch (error) {
                        Swal.fire("", "Error A: " + error, "error")
                    }
                });

                $(document).on('click', '.btnEditar', function (e) {
                    e.preventDefault();
                    $(".modal-header").css("background-color", "#007bff");
                    $(".modal-header").css({
                        "color": "white",
                        "font-weight": "900"
                    });
                    $(".modal-title").text("EDITAR VACACIONES PARA EMPLEADO");
                    $('#modalVacaciones').modal("show");

                    fila = $(this).closest("tr");

                    opcion = 2;
                    id = parseInt(fila.find("td:eq(0)").text());
                    empleadoName = fila.find("td:eq(2)").text();

                    $('#inicioVacaciones').val(fila.find("td:eq(3)").text());
                    $('#finalVacaciones').val(fila.find("td:eq(4)").text());

                    $('#empleadoVacaciones option').each(function () {
                        if ($.trim($(this).text()) === $.trim(empleadoName)) {
                            $(this).prop('selected', true);
                            $('#empleadoVacaciones').trigger('chosen:updated');
                            return false;
                        }
                    });
                });

                $(document).on('click', '.btnBorrar', function (e) {
                    e.preventDefault();
                    fila = $(this).closest('tr');

                    id = fila.find("td:eq(0)").text();
                    empleado = fila.find("td:eq(1)").text();
                    estado = fila.find("td:eq(7)").text();

                    if (estado == 'Activo') {
                        value = 3;
                        alert = 'ANULAR';
                        message = 'Vacaciones Anuladas!';
                    } else {
                        value = 2;
                        alert = 'HABILITAR';
                        message = 'Vacaciones Habilitadas!';
                    }


                    Swal.fire({
                        title: "Estás Seguro de " + alert + " estas Vacaciones?",
                        text: "Al confirmar debes esperar el mensaje de finalización para poder continuar!",
                        icon: "warning",
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Confirmar!',
                        didOpen: () => {
                            Swal.getConfirmButton().addEventListener('click', function () {
                                this.disabled = true;
                            });
                        }
                    }).then((result) => {
                        if (result.isConfirmed) {

                            try {
                                $.ajax({
                                    beforeSend: function (xhr, type) {
                                        if (!type.crossDomain) {
                                            xhr.setRequestHeader('X-CSRF-Token', $(
                                                'meta[name="csrf-token"]')
                                                .attr(
                                                    'content'));
                                        }
                                    },
                                    url: "http://localhost/EVAC/public/api/update/status/vacaciones",
                                    type: "POST",
                                    datatype: "json",
                                    async: false,
                                    data: {
                                        id: id,
                                        value: value,
                                        userName: '{{userName}}',
                                    },
                                    success: function (data) {
                                        if (data.save == 1) {

                                            Swal.fire("", message, "success");
                                            vacacionesTable.ajax.reload(null,
                                                false);
                                            calculosVacacionesTable.ajax.reload(null, false);

                                        } else {

                                            Swal.fire("", "Error L: " + data.error,
                                                "error");

                                        }
                                    },
                                });
                            } catch (error) {
                                Swal.fire("", "Error A: " + error, "error")
                            }

                        }
                    });


                });

            }


            switchTab('trabajo-info-tab', 'trabajo-info-sec');
        });



        var modalHabilidadesTable = $('#modal-habilidades-table').DataTable();

        function openModal(buttonClass, modalTarget) {
            $(buttonClass).on('click', function () {
                console.log(buttonClass + ' clicked');
                var buttonTitle = $(this).data('title');
                $(modalTarget).find('.modal-title').text(buttonTitle);
                $(modalTarget).modal('show');
            });
        }
        openModal('.btn-add-accesos', '#modalAccesos');
        openModal('.btn-add-equipo', '#modalEquipo');
        openModal('.btn-add-curriculum', '#modalNuevoCurriculo');
        openModal('.btn-add-habilidades', '#modalHabilidades');
        openModal('.btn-add-contactos', '#contactosEmergenciasModal');
        openModal('.btn-add-laborales', '#modalCrearBeneficioLaboralEmpleado');
        openModal('.btn-add-adicional', '#modalCrearBeneficioAdicionalEmpleado');
        openModal('.btn-add-enfermedades-base', '#modalCrearEnfermedadesBase');
        openModal('.btn-add-familiares', '#modalFamiliares');
        openModal('.btn-add-asociaciones', '#modalAsociaciones');
        openModal('.btn-add-empresa', '#modalCrearEmpresa');
        openModal('.btn-add-sucursal', '#modalCrearSucursal');
        openModal('.btn-add-departamento', '#modalCrearDepartamentoEmpresa');
        openModal('.btn-add-area', '#modalCrearAreaEmpresa');
        openModal('.btn-add-cargo', '#modalCrearCargoAreaEmpresa');
        openModal('.btn-add-rol', '#modalCrearRolEmpleado');

        $('.btn-secondary, .close').on('click', function () {
            $(this).closest('.modal').modal('hide');
        });

        // Añadir nueva habilidad al modal
        $('#add-nueva-habilidad').on('click', function () {
            var nuevaHabilidad = $('#nueva-habilidad-input').val().trim();
            var habilidadId = $('#habilidad-id-input').val(); // Obtener el ID de la habilidad si está en modo edición

            if (nuevaHabilidad) {
                if (habilidadId) {
                    // Lógica para actualizar la habilidad existente
                    var row = modalHabilidadesTable.row('[data-id="' + habilidadId + '"]');
                    row.data([
                        nuevaHabilidad,
                        `<td class="text-right">
                            <button type="button" class="btn btn-sm btn-success btn-add-habilidad" style="font-size: 16px; margin-right: 5px;"><i class="material-icons" style="font-size: 16px;">add</i></button>
                            <button type="button" class="btn btn-sm btn-warning btn-edit-habilidad" style="font-size: 16px; margin-left: 5px;"><i class="material-icons" style="font-size: 16px;">edit</i></button>
                        </td>`
                    ]).draw();
                    $('#habilidad-id-input').val(''); // Limpiar el campo oculto
                } else {
                    // Lógica para añadir una nueva habilidad
                    var newItem = `<tr>
                                        <td>${nuevaHabilidad}</td>
                                        <td class="text-right">
                                            <button type="button" class="btn btn-sm btn-success btn-add-habilidad" style="font-size: 16px; margin-right: 5px;"><i class="material-icons" style="font-size: 16px;">add</i></button>
                                            <button type="button" class="btn btn-sm btn-warning btn-edit-habilidad" style="font-size: 16px; margin-left: 5px;"><i class="material-icons" style="font-size: 16px;">edit</i></button>
                                        </td>
                                    </tr>`;
                    modalHabilidadesTable.row.add($(newItem)).draw();
                }

                $('#nueva-habilidad-input').val('');
                $('#habilidad-id-input').val(''); // Limpiar el campo oculto
                toastr.success('Habilidad añadida/actualizada correctamente');
            } else {
                toastr.error('Por favor, ingrese una habilidad.');
            }
        });


        $(document).on('click', '.btn-add-habilidad', function () {
            var habilidadRow = $(this).closest('tr');
            var habilidadText = habilidadRow.find('td').eq(0).text();
            var habilidadId = habilidadRow.data('id');
            var idEmpleado = $('#id-empleado').val();


            console.log(idEmpleado, habilidadId, creadoPor);

            var existingHabilidad = $('#habilidades-container').find('.pill[data-id="' + habilidadId + '"]');
            if (existingHabilidad.length === 0) {
                $.ajax({
                    type: 'POST',
                    url: '{% url "agregar_habilidad_empleado" %}',
                    data: {
                        'id_empleado': idEmpleado,
                        'id_habilidad': habilidadId,
                        'creado_por': '{{userName}}',
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function (response) {
                        if (response.status === 'success') {
                            var newHabilidadItem = `<div class="pill" data-id="${habilidadId}">
                                                <span>${habilidadText}</span>
                                                <span class="close">&times;</span>
                                            </div>`;
                            $('#habilidades-container').append(newHabilidadItem);
                            $('#no-habilidades-msg').hide();
                            toastr.success('Habilidad añadida a la lista principal');
                        } else {
                            toastr.error('Error al agregar la habilidad: ' + response.error);
                        }
                    },
                    error: function (response) {
                        toastr.error('Error en la solicitud: ' + response.responseText);
                    }
                });
            } else {
                toastr.error('Esta habilidad ya está en la lista principal.');
            }
        });


        // Eliminar habilidad de la lista principal
        $(document).on('click', '.pill .close', function () {
            var habilidadPill = $(this).closest('.pill');
            habilidadPill.remove();
            if ($('#habilidades-container .pill').length === 0) {
                $('#no-habilidades-msg').show();
            }
            toastr.success('Habilidad eliminada de la lista principal');
        });

        // Editar habilidad en el modal
        $(document).on('click', '.btn-edit-habilidad', function () {
            var habilidadRow = $(this).closest('tr');
            var habilidadId = habilidadRow.data('id'); // Obtener el ID de la habilidad
            var habilidadText = habilidadRow.find('td').eq(0).text();
            var descripcionText = habilidadRow.find('td').eq(1).text(); // Obtener la descripción de la habilidad (asumiendo que está en la segunda columna)
            $('#habilidad-id-input').val(habilidadId); // Establecer el ID en el campo oculto
            $('#nueva-habilidad-input').val(habilidadText); // Establecer el nombre de la habilidad en el campo de entrada
            $('#descripcion-habilidad-input').val(descripcionText); // Establecer la descripción de la habilidad en el campo de entrada
            $('button[type="submit"]').text('Editar');
        });

        $('.select2').select2({
            width: '100%'
        });

        var modalHabilidadesTable;

        $('#modalHabilidades').on('shown.bs.modal', function () {
            function initializeTableHabilidades() {
                // Destruir la tabla existente si existe
                if ($.fn.DataTable.isDataTable('#modal-habilidades-table')) {
                    $('#modal-habilidades-table').DataTable().clear().destroy();
                }

                // Inicializar la tabla de habilidades
                var modalHabilidadesTable = $('#modal-habilidades-table').DataTable({
                    autoWidth: true,  // Permitir que DataTables ajuste el ancho automáticamente
                    scrollX: false,
                    pageLength: 50,
                    dom: 'Bfrtip',
                    language: {
                        "processing": "Procesando...",
                        "lengthMenu": "Mostrar _MENU_ registros",
                        "zeroRecords": "No se encontraron resultados",
                        "emptyTable": "Ningún dato disponible en esta tabla",
                        "info": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                        "infoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                        "infoFiltered": "(filtrado de un total de _MAX_ registros)",
                        "search": "Buscar:",
                        "infoThousands": ",",
                        "loadingRecords": "Cargando...",
                        "paginate": {
                            "first": "Primero",
                            "last": "Último",
                            "next": "Siguiente",
                            "previous": "Anterior"
                        },
                        "aria": {
                            "sortAscending": ": Activar para ordenar la columna de manera ascendente",
                            "sortDescending": ": Activar para ordenar la columna de manera descendente"
                        },
                        "buttons": {
                            "copy": "Copiar",
                            "colvis": "Visibilidad"
                        }
                    },
                    columns: [
                        { "title": "Habilidad" },      // Columna para Habilidad
                        { "title": "Descripción" },    // Nueva columna para Descripción
                        {
                            "title": "Acciones",
                            "className": "text-right",
                            "render": function (data, type, row) {
                                return '<button class="btn btn-outline-primary btn-sm mr-1"><i class="fas fa-edit"></i></button>' +
                                    '<button class="btn btn-outline-danger btn-sm"><i class="fas fa-trash-alt"></i></button>';
                            }
                        }
                    ],
                    order: [[0, "asc"]],
                    buttons: [{
                        extend: 'excel',
                        text: '<i class="fas fa-file-excel"></i>',
                        titleAttr: 'Excel',
                        className: 'btn btn-success',
                    },
                    {
                        extend: 'pdf',
                        text: '<i class="fas fa-file-pdf"></i>',
                        titleAttr: 'PDF',
                        className: 'btn btn-danger',
                    },
                    {
                        extend: 'print',
                        text: '<i class="fas fa-print"></i>',
                        titleAttr: 'Imprimir',
                        className: 'btn btn-primary',
                        orientation: 'landscape'
                    }]
                });
            }
        });

    });

    document.getElementById('foto-input').addEventListener('change', function (event) {
        var input = event.target;
        var reader = new FileReader();
        reader.onload = function () {
            var dataURL = reader.result;
            var output = document.getElementById('empleado-foto');
            output.src = dataURL;
            document.getElementById('foto-ruta').value = dataURL; // Esto guarda la imagen como base64, puedes ajustar esto según tus necesidades
        };
        reader.readAsDataURL(input.files[0]);
    });

    /*--------------------------------------------------------Tabla agregar seguros--------------------------------------------------------------------*/

    $(document).ready(function () {


        // Abrir modal al hacer clic en el botón "Añadir Seguro"
        $('.btn-add-seguros').on('click', function () {
            $('#form-seguro')[0].reset();
            $('#nuevoSeguroModal').modal('show');
        });

        // Abrir modal al hacer clic en el botón "Editar"
        $('#seguros-table').on('click', '.btn-primary', function () {
            // Aquí puedes llenar el formulario del modal con los datos del seguro seleccionado
            var data = table.row($(this).parents('tr')).data();
            $('#nombre-seguro').val(data[0]);

            $('#nuevoSeguroModal').modal('show');
        });

        // Abrir modal para añadir seguro
        $('#seguros-table').on('click', '.btn-add-seguros', function () {
            $('#form-seguro')[0].reset();
            $('#nuevoSeguroModal').modal('show');
        });
    });

    /*----------------------------------------------------------------------MODAL FAMILIARES ----------------------------------------------------------*/
    var tableFamiliares;

    $(document).ready(function () {
        $('#foto-input').change(function () {
            var input = this;
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    $('#empleado-foto').attr('src', e.target.result);
                }
                reader.readAsDataURL(input.files[0]);
            }
        });

        // Inicializar la tabla solo cuando la pestaña se muestra
        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            if ($(e.target).attr('href') == '#familiares-tab') {
                if (!$.fn.dataTable.isDataTable('#familiares-table-unique')) {
                    tableFamiliares = $('#familiares-table-unique').DataTable({
                        "paging": false,
                        "searching": false,
                        "info": false,
                        "columnDefs": [
                            { "orderable": false, "targets": 3 }
                        ]
                    });
                } else {
                    tableFamiliares.columns.adjust().draw();
                }
            }
        });

        // Asegurarse de que la tabla se inicialice si la pestaña ya está visible
        if ($('#familiares-tab').is(':visible') && !$.fn.dataTable.isDataTable('#familiares-table-unique')) {
            tableFamiliares = $('#familiares-table-unique').DataTable({
                "paging": false,
                "searching": false,
                "info": false,
                "columnDefs": [
                    { "orderable": false, "targets": 3 }
                ]
            });
        }

        $('#modalFamiliares').on('hidden.bs.modal', function () {
            $('#nombre-familiar').val('');
            $('#telefono-familiar').val('');
            $('#parentesco').val('');
        });


    });


    /*--------------------------------------------------------Contactos de emergencia empleado--------------------------------------------------------------------*/
    var tableContactos;


    var selectedArea = null;  // Variable global para recordar el área seleccionada
    var selectedCargo = null;  // Variable global para recordar el cargo seleccionado

    function filtrarSubgrupos() {
        var pk_grupo = $('#departamento-empresa').val();
        console.log("Valor de pk_grupo:", pk_grupo);  // Verificar si se está obteniendo el valor correcto

        // Validar si el valor es "new-departamento-empresa"
        if (pk_grupo === 'new-departamento-empresa') {
            // Abrir el modal para crear un nuevo departamento
            $('#modal-crear-departamento').modal('show');
            return;  // No continuar con la llamada AJAX
        }

        // Si pk_grupo es un valor válido (un número entero), continuar con la consulta AJAX
        if (pk_grupo) {
            var url = "{% url 'filtrar_subgrupos_por_grupo' %}";
            console.log("URL de AJAX:", url);  // Verificar si la URL se genera correctamente

            $.ajax({
                url: url,
                data: { 'pk_grupo': pk_grupo },
                dataType: 'json',
                success: function (data) {
                    var subgrupos = data.subgrupos;
                    console.log("Subgrupos recibidos:", subgrupos);  // Depurar los subgrupos recibidos
                    $('#areas-empresa').empty();  // Limpiar el select de subgrupos

                    // Agregar la opción por defecto
                    $('#areas-empresa').append(new Option("Seleccione un área", ""));
                    // Agregar opción para crear una nueva área
                    $('#areas-empresa').append(new Option("Crear nueva área", "new-areas-empresa"));
                    // Llenar el select con los subgrupos
                    subgrupos.forEach(function (subgrupo) {
                        // Asegúrate de que solo trabajas con los campos necesarios: PKsubgrupo, sub_grupo, y estado
                        $('#areas-empresa').append(new Option(subgrupo.sub_grupo, subgrupo.PKsubgrupo));
                    });

                    // Si existe un área previamente seleccionada, seleccionarla después de cargar las opciones
                    if (selectedArea) {
                        console.log("Seleccionando área:", selectedArea);  // Depurar el área seleccionada

                        // Limpiar espacios y comparar en minúsculas
                        let areaSeleccionada = selectedArea.trim().toLowerCase();
                        let encontrado = false;

                        // Iterar sobre las opciones del select
                        $('#areas-empresa option').each(function () {
                            let areaTexto = $(this).text().trim().toLowerCase();
                            if (areaTexto === areaSeleccionada) {
                                $(this).prop('selected', true);
                                encontrado = true;
                            }
                        });

                        if (!encontrado) {
                            console.warn("El área seleccionada no coincide. Verifica el valor.");
                        } else {
                            console.log("Área seleccionada correctamente:", selectedArea);
                        }

                        selectedArea = null;  // Limpiar la variable después de seleccionar
                        $('#areas-empresa').trigger('change');
                    }

                    // Evento para abrir el modal si se selecciona "Crear nueva área"
                    $('#areas-empresa').on('change', function () {
                        var selectedValue = $(this).val();
                        if (selectedValue === "new-areas-empresa") {
                            $('#modal-crear-area').modal('show');  // Mostrar el modal
                        }
                    });
                },
                error: function (xhr, status, error) {
                    console.error("Error al cargar subgrupos:", xhr.responseText, status, error);  // Proporcionar más detalles del error
                }
            });
        } else {
            // Si no hay grupo seleccionado, limpiar el select de áreas
            $('#areas-empresa').empty();
            $('#areas-empresa').append(new Option("Seleccione un área", ""));
        }
    }

    // Ejecutar la función cuando el select de "departamento-empresa" cambie
    $('#departamento-empresa').on('change', filtrarSubgrupos);

    // Establecer el área seleccionada antes de cargar los subgrupos
    function seleccionarArea(area) {
        selectedArea = area;  // Guardar el área seleccionada
        console.log("Área seleccionada guardada:", selectedArea);  // Depuración
        $('#areas-empresa').trigger('change');  // Volver a cargar los subgrupos
    }


    $('#areas-empresa').on('change', function () {
        var id_area = $(this).val();  // Obtener el valor del área seleccionada

        // Verificar si el usuario ha seleccionado la opción "Crear nueva área"
        if (id_area === 'new-areas-empresa') {
            $('#modalCrearArea').modal('show');  // Mostrar el modal para crear una nueva área
            $('#areas-empresa').val(null).trigger('change');  // Restablecer el valor del select
            return;  // No continuar con la llamada AJAX
        }

        if (id_area) {
            $.ajax({
                url: "{% url 'obtener_cargos_por_area' %}",  // URL de la vista en Django
                type: "POST",
                data: JSON.stringify({ 'id_area': id_area }),  // Enviar el id_area como JSON
                contentType: "application/json",
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'  // Incluir el token CSRF en la solicitud
                },
                success: function (response) {
                    var cargos = response.cargos;
                    $('#cargos-empresa').empty();  // Limpiar el select de cargos

                    // Agregar opción por defecto
                    $('#cargos-empresa').append(new Option("Seleccione un cargo", ""));

                    // Agregar opción para crear un nuevo cargo
                    $('#cargos-empresa').append(new Option("Crear nuevo cargo", "new-cargos-empresa"));

                    // Llenar el select de cargos con los resultados
                    cargos.forEach(function (cargo) {
                        $('#cargos-empresa').append(new Option(cargo.nombre, cargo.id));
                    });

                    // Si hay un cargo previamente seleccionado, seleccionarlo
                    if (selectedCargo) {
                        console.log("Seleccionando cargo:", selectedCargo);  // Depurar el cargo
                        $('#cargos-empresa').val(selectedCargo).trigger('change');
                        selectedCargo = null;  // Limpiar la variable después de seleccionar
                    }

                    // Evento select2:select para abrir el modal al seleccionar "Crear nuevo cargo"
                    $('#cargos-empresa').on('select2:select', function (e) {
                        var selectedValue = e.params.data.id;
                        if (selectedValue === 'new-cargos-empresa') {
                            $('#modalCrearCargo').modal('show'); // Mostrar el modal
                            $('#cargos-empresa').val(null).trigger('change'); // Restablecer el valor del select
                        }
                    });
                },
                error: function (xhr, status, error) {
                    console.error("Error al obtener cargos:", error);
                }
            });
        } else {
            // Si no se selecciona un área, limpiar el select de cargos
            $('#cargos-empresa').empty();
            $('#cargos-empresa').append(new Option("Seleccione un cargo", ""));
        }
    });

    var buttons = "Bfrtlip";
    // Inicializar la tabla solo cuando la pestaña se muestra
    $('#departamento_pais').select2();


    var editIdEmpleado = $('#edit-id-empleado').val();
    if (editIdEmpleado && editIdEmpleado !== "new") {
        var url = "{% url 'obtener_datos_empleado' id_empleado=0 %}".replace('0', editIdEmpleado); // Construye la URL correctamente
        console.log('URL generada:', url);
        // Mostrar el mensaje de "Cargando Datos"
        Swal.fire({
            title: '',
            html: '<b>Cargando Datos</b>',
            didOpen: () => {
                Swal.showLoading();
            },
            allowOutsideClick: false, // Evita que el usuario cierre el modal haciendo clic fuera de él
            showConfirmButton: false // Oculta el botón de confirmación
        });


        $.ajax({

            url: url,
            type: 'GET',
            success: function (response) {
                // Cerrar el mensaje de "Cargando Datos"
                Swal.close();
                console.log('Datos recibidos:', response);
                if (response.status === 'success') {
                    var data = response.data;
                    $('#puesto-trabajo').val(data.identidad);
                    $('#nombre-empleado').val(data.nombre_completo);
                    $('#apellido-empleado').val(data.apellido_completo);
                    if (data.imagen) {
                        console.log('Imagen en base64:', data.imagen); // Para verificar el campo de la imagen
                        $('#empleado-foto').attr('src', 'data:image/jpeg;base64,' + data.imagen);
                        $('#foto-actual').val('data:image/jpeg;base64,' + data.imagen);
                    }

                    $('#email-trabajo').val(data.correo_empresarial);
                    $('#fecha-ingreso').val(data.fecha_ingreso);
                    $('#cod-empleado').val(data.codigo_empleado);
                    $('#cuenta_bancaria').val(data.cuenta_bancaria);
                    $('#nuevo-banco').val(data.id_banco).trigger('change');

                    $('#id_departamento').val(data.nombre_grupo);
                    $('#id_area_hidden').val(data.nombre_subgrupo);
                    $('#id_cargo_hidden').val(data.nombre_cargo);
                    console.log('id departamento '+ data.nombre_grupo);
                    $('#departamento-empresa option').each(function () {
                        if ($(this).text() === data.nombre_grupo) {
                            $(this).prop('selected', true);
                        }
                    });


                    $('#departamento-empresa').trigger('change');  // Esto cargará las áreas basadas en el departamento seleccionado

                    // **Seleccionar el área después de cargar las áreas**
                    seleccionarArea(data.nombre_subgrupo);

                    selectedCargo = data.id_cargo;

                    // Una vez cargadas las áreas, selecciona el cargo también
                    $('#areas-empresa').trigger('change');;

                    $('#estado-empleado').val(data.estado).trigger('change');
                    /* $('#puesto-empresa').val(data.id_posicion).trigger('change'); */
                    $('#rol-empleado').val(data.rol_empleado).trigger('change');

                    $('#direccion-contacto').val(data.direccion);
                    $('#correo-contacto').val(data.correo);
                    $('#tipo-vehiculo').val(data.tipo_vehiculo_privada).trigger('change');
                    $('#placa-vehiculo').val(data.placa_vehiculo_privada);
                    $('#distancia-km').val(data.distancia_km);
                    $('#nacionalidad').val(data.nacionalidad).trigger('change');
                    $('#pasaporte').val(data.pasaporte);
                    $('#sexo').val(data.id_sexo).trigger('change');
                    $('#fecha-nac').val(data.fecha_nacimiento);
                    $('#nuevo-pais-nac').val(data.pais_nacimiento).trigger('change');
                    $('#estado-civil').val(data.estado_civil).trigger('change');
                    $('#numero-hijos').val(data.numero_hijos);
                    $('#nivel-certificado').val(data.id_nivel_certificado).trigger('change');
                    $('#nuevo-campo-estudio').val(data.campo_estudio).trigger('change');
                    $('#direccion-laboral').val(data.dirrecion_laboral);
                    $('#centro').val(data.id_empresa).trigger('change');
                    $('#sucursal').val(data.id_sucursal).trigger('change');
                    $('#telefono-empresa').val(data.telefono_empresarial);
                    $('#gerente').val(data.id_gerente).trigger('change');
                    $('#jefe-inmediato').val(data.id_jefe_inmediato).trigger('change');
                    $('#jefe-superior').val(data.id_jefe_superior).trigger('change');
                    $('#tipo-contrato').val(data.id_tipo_contrato).trigger('change');
                    $('#observaciones-generales').val(data.observaciones_generales);
                    $('#nuevo-categoria-retiros').val(data.id_categoria_retiro).trigger('change');
                    $('#nuevo-motivo-retiro').val(data.id_motivo_retiro).trigger('change');
                    $('#fecha-retiro').val(data.fecha_retiro);
                    $('#observaciones-retiro').val(data.observaciones_retiro);
                    $('#forma-pago').val(data.id_forma_pago).trigger('change');
                    $('#seguros').val(data.aplica_seguro);
                    $('#salario').val(data.salario);
                    $('#competencias-puesto').val(data.competencias_puesto);
                    $('#historico-acciones').val(data.historico_acciones);
                    $('#constancias').val(data.constancias);
                    $('#evaluaciones').val(data.evaluaciones);
                    $('#inicio-contrato').val(data.inicio_contrato);
                    $('#fin-contrato').val(data.fin_contrato);
                    $('#tipo-cuenta').val(data.tipo_cuenta).trigger('change');
                    $('#tipo-cuenta, #centro-costo').on('change', function () {
                        // Obtener los valores seleccionados
                        let tipoCuentaNombre = $('#tipo-cuenta option:selected').text();
                        let centroCostoId = $('#centro-costo').val();

                        // Limpiar el select de cuenta contable si no hay selección válida en los otros selectores
                        if (!centroCostoId || !tipoCuentaNombre) {
                            $('#cuenta-contable').empty().append('<option value="">Selecciona una cuenta contable</option>');
                            return; // Salir si no hay selección válida
                        }

                        // Concatenar ID del centro de costo con el nombre del tipo de cuenta
                        let cuentaContableTexto = `${centroCostoId} - ${tipoCuentaNombre}`;

                        // Limpiar el select de cuenta contable y agregar la nueva opción
                        $('#cuenta-contable').empty().append(new Option(cuentaContableTexto, cuentaContableTexto));
                    });
                    $('#centro-costo').val(data.id_centro_costo).trigger('change');
                    if ($('#cuenta-contable').find(`option[value="${data.id_cuenta_contable}"]`).length > 0) {
                        $('#cuenta-contable').val(data.id_cuenta_contable).trigger('change');
                    } else {
                        console.log('No se encontró la cuenta contable en el select.');
                    }

                    $('#punto-referencia').val(data.punto_referencia).trigger('change');
                    $('#rtn').val(data.rtn);
                    $('#telefono-personal').val(data.telefono).trigger('change');
                    $('#ciudad-nac').val(data.nombre_ciudad).trigger('change');
                    $('#tipo-sangre').val(data.tipo_sangre).trigger('change');
                    $('#profesion-empleado').val(data.profesion).trigger('change');
                    $('#residencia').val(data.id_residencia).trigger('change');
                    $('#usuario').val(data.PKUsuario).trigger('change');
                    $('#usuario_biometrico').val(data.Userid).trigger('change');

                    // Forzar a que se seleccione el departamento una vez que esté cargado
                    $('#departamento_pais').val(data.id_departamento).trigger('change');
                    $('#nuevo-municipio-departamento').val(data.id_municipio).trigger('change');
                    $('#nuevo-barrio-ciudad').val(data.id_barrio).trigger('change');





                    // Quitar la animación ya que se ha cargado la identidad
                    $('#puesto-trabajo').removeClass('glow');
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Error al obtener los datos del empleado: ' + response.error,
                    });
                }
            },
            error: function (response) {
                // Manejo del error en la solicitud AJAX
                console.error('Error de la solicitud AJAX:', response);
                Swal.fire({
                    icon: 'error',
                    title: 'Error en la solicitud',
                    text: 'Error en la solicitud: ' + (response.responseText || 'Error desconocido'),
                });
            }
        });
    }



    $('#contactosEmergenciasModal').on('hidden.bs.modal', function () {
        $('#nombre-contacto').val('');
        $('#telefono-contacto').val('');
        $('#nuevo-parentesco-contacto').val('');
    });


    /*--------------------------------------------------ASOCIACIONES----------------------------------------------*/




    //obtener equipo
    $(document).ready(function () {
        let creadoPorElem = $('#creado-por');
        let creadoPor = creadoPorElem.length ? creadoPorElem.val() : null;
        console.log('Creado por al inicio:', creadoPor);
        var equipoAsignadoTable;

        function initializeTableEquipo(idEmpleado) {

            // Destruir la tabla existente si existe
            if ($.fn.DataTable.isDataTable('#equipo-asignado-table')) {
                $('#equipo-asignado-table').DataTable().clear().destroy();
            }

            // Inicializar la tabla de equipos asignados
            equipoAsignadoTable = $('#equipo-asignado-table').DataTable({
                autoWidth: true,  // Permitir que DataTables ajuste el ancho automáticamente
                scrollX: false,
                pageLength: 50,
                dom: 'Bfrtip',
                autoWidth: false,  // Asegurar que autoWidth esté desactivado
                language: {
                    "processing": "Procesando...",
                    "lengthMenu": "Mostrar _MENU_ registros",
                    "zeroRecords": "No se encontraron resultados",
                    "emptyTable": "Ningún dato disponible en esta tabla",
                    "info": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                    "infoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                    "infoFiltered": "(filtrado de un total de _MAX_ registros)",
                    "search": "Buscar:",
                    "infoThousands": ",",
                    "loadingRecords": "Cargando...",
                    "paginate": {
                        "first": "Primero",
                        "last": "Último",
                        "next": "Siguiente",
                        "previous": "Anterior"
                    },
                    "aria": {
                        "sortAscending": ": Activar para ordenar la columna de manera ascendente",
                        "sortDescending": ": Activar para ordenar la columna de manera descendente"
                    },
                    "buttons": {
                        "copy": "Copiar",
                        "colvis": "Visibilidad"
                    }
                },
                ajax: {
                    beforeSend: function (xhr, type) {
                        if (!type.crossDomain) {
                            xhr.setRequestHeader(
                                'X-CSRF-Token',
                                $('meta[name="csrf-token"]').attr('content')
                            );
                        }
                    },
                    url: "{% url 'obtener_equipo_empleado' %}",
                    type: "GET",
                    data: function (d) {
                        d.id_empleado = idEmpleado;  // Asegúrate de pasar el ID correcto aquí
                    },
                    dataSrc: function (json) {
                        console.log('Datos recibidos de la solicitud AJAX:', json);
                        return json.data || [];
                    },
                    error: function (xhr, status, error) {
                        console.error('Error en la solicitud AJAX:', error);
                        console.log('Detalles del error AJAX:', xhr.responseText);
                    }
                },
                colReorder: {
                    realtime: false,
                },
                buttons: [{
                    extend: 'excel',
                    text: '<i class="fas fa-file-excel"></i>',
                    titleAttr: 'Excel',
                    className: 'btn btn-success',
                },
                {
                    extend: 'pdf',
                    text: '<i class="fas fa-file-pdf"></i>',
                    titleAttr: 'PDF',
                    className: 'btn btn-danger',
                },
                {
                    extend: 'print',
                    text: '<i class="fas fa-print"></i>',
                    titleAttr: 'Imprimir',
                    className: 'btn btn-primary',
                    orientation: 'landscape'
                }],
                columns: [
                    { "data": "id_equipo_asignado", "width": "15%" },  // Ancho definido
                    { "data": "nombre_equipo_asignado", "width": "50%" }
                ],
                order: [[0, "asc"]],
                initComplete: function () {
                    setTimeout(function () {
                        equipoAsignadoTable.columns.adjust().draw();
                    }, 100);
                }
            });
        }


        // Opcional: Aplicar CSS para asegurar el ancho completo
        $('#equipo-asignado-table').css('width', '100%');

        let idEmpleado = $('#id-empleado').val() || $('#edit-id-empleado').val();

        if (idEmpleado) {
            initializeTableEquipo(idEmpleado);
        } else {
            $('#table-container').html('<p>No hay un empleado seleccionado. Por favor, seleccione un empleado para ver los equipos asignados.</p>');
        }

        $('#formCrearEquipo').on('submit', function (event) {
            event.preventDefault();

            let idEmpleado = $('#id-empleado').val() || $('#edit-id-empleado').val();
            let nuevoEquipo = $('#descripcion-nombre_equipos').val().toUpperCase();
            let creadoPor = '{{userName}}';  // Asegúrate de que este campo esté disponible

            // Variable para acumular los errores
            let errorMessage = '';

            // Verificar cada campo y agregar un mensaje de error si está vacío
            if (!idEmpleado) {
                errorMessage += 'El campo de empleado es obligatorio, por favor ingrese un DNI válido.\n';
            }
            if (!nuevoEquipo) {
                errorMessage += 'El campo de nombre del equipo está vacío.\n';
            }
            if (!creadoPor) {
                errorMessage += 'Su sesión ha sido cerrada. Inicie sesión nuevamente para continuar.\n';
            }

            // Si hay errores, mostramos los mensajes acumulados y detenemos el envío
            if (errorMessage) {
                console.error('Campos vacíos:', {
                    id_empleado: idEmpleado,
                    nombre_equipo: nuevoEquipo,
                    creado_por: creadoPor
                });

                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: errorMessage.replace(/\n/g, ' '),  // Mostrar los errores en una sola línea
                });
                return;  // Detener el envío del formulario
            }

            // Si no hay errores, proceder con la solicitud AJAX
            let csrfToken = $('input[name="csrfmiddlewaretoken"]').val();

            $.ajax({
                url: "{% url 'crear_Equipo' %}",
                type: 'POST',
                data: {
                    id_empleado: idEmpleado,
                    nombre_equipo: nuevoEquipo,
                    creado_por: creadoPor,
                    csrfmiddlewaretoken: csrfToken
                },
                success: function (response) {
                    if (response.status === 'success') {
                        $('#modalEquipo').modal('hide');
                        if ($.fn.DataTable.isDataTable('#equipo-asignado-table')) {
                            equipoAsignadoTable.ajax.reload(null, false);
                        } else {
                            initializeTableEquipo(idEmpleado);
                        }

                        // Limpiar el formulario después de un envío exitoso
                        $('#formCrearEquipo')[0].reset();  // Limpiar el formulario
                        $('#descripcion-nombre_equipos').val('').trigger('change');  // Limpiar el select2
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Error al crear equipo: ' + response.error,
                        });
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error en la solicitud AJAX:', error);
                }
            });
        });
    });

    //contactos de emercias
    $(document).ready(function () {
        let creadoPorElem = $('#creado-por');
        let creadoPor = creadoPorElem.length ? creadoPorElem.val() : null;
        var buttons = "Bfrtlip";
        var contactosemergenciatable;

        function initializeTableContactos(idEmpleado) {

            // Destruir la tabla existente si existe
            if ($.fn.DataTable.isDataTable('#contactos-emergencia-table')) {
                $('#contactos-emergencia-table').DataTable().clear().destroy();
            }

            // Inicializar la tabla de contactos de emergencia
            contactosemergenciatable = $('#contactos-emergencia-table').DataTable({
                autoWidth: true,  // Permitir que DataTables ajuste el ancho automáticamente
                scrollX: false,
                pageLength: 50,
                dom: 'Bfrtip',
                language: {
                    "processing": "Procesando...",
                    "lengthMenu": "Mostrar _MENU_ registros",
                    "zeroRecords": "No se encontraron resultados",
                    "emptyTable": "Ningún dato disponible en esta tabla",
                    "info": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                    "infoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                    "infoFiltered": "(filtrado de un total de _MAX_ registros)",
                    "search": "Buscar:",
                    "infoThousands": ",",
                    "loadingRecords": "Cargando...",
                    "paginate": {
                        "first": "Primero",
                        "last": "Último",
                        "next": "Siguiente",
                        "previous": "Anterior"
                    },
                    "aria": {
                        "sortAscending": ": Activar para ordenar la columna de manera ascendente",
                        "sortDescending": ": Activar para ordenar la columna de manera descendente"
                    },
                    "buttons": {
                        "copy": "Copiar",
                        "colvis": "Visibilidad"
                    }
                },
                ajax: {
                    beforeSend: function (xhr, type) {
                        if (!type.crossDomain) {
                            xhr.setRequestHeader(
                                'X-CSRF-Token',
                                $('meta[name="csrf-token"]').attr('content')
                            );
                        }
                    },
                    url: "{% url 'obtener_contactos_emergencia' %}",
                    type: "GET",
                    data: function (d) {
                        d.id_empleado = idEmpleado;
                        console.log('Datos enviados en la solicitud AJAX:', d);
                    },
                    dataSrc: function (json) {
                        console.log('Datos recibidos de la solicitud AJAX:', json);
                        return json.data;
                    }
                },
                colReorder: {
                    realtime: false,
                },
                buttons: [{
                    extend: 'excel',
                    text: '<i class="fas fa-file-excel"></i>',
                    titleAttr: 'Excel',
                    className: 'btn btn-success',
                },
                {
                    extend: 'pdf',
                    text: '<i class="fas fa-file-pdf"></i>',
                    titleAttr: 'PDF',
                    className: 'btn btn-danger',
                },
                {
                    extend: 'print',
                    text: '<i class="fas fa-print"></i>',
                    titleAttr: 'Imprimir',
                    className: 'btn btn-primary',
                    orientation: 'landscape'
                }],
                columns: [
                    { "data": "id_contacto" },
                    { "data": "nombre_contacto" },
                    { "data": "telefono_contacto" },
                    { "data": "parentesco" }

                ],
                order: [[0, "asc"]]
            });
        }

        $('#contactos-emergencia-table').css('width', '100%');
        let idEmpleado = $('#id-empleado').val() || $('#edit-id-empleado').val();

        if (idEmpleado) {
            initializeTableContactos(idEmpleado);
        } else {
            $('#table-container').html('<p>No hay un empleado seleccionado. Por favor, seleccione un empleado para ver los contactos de emergencia.</p>');
        }

        $('#formCrearContactoEmergencia').on('submit', function (event) {
            event.preventDefault();

            let idEmpleado = $('#id-empleado').val() || $('#edit-id-empleado').val(); // Usar el ID de edición si existe
            let nuevoNombre = $('#nombre_contacto').val().toUpperCase();
            let nuevoParentesco = $('#nuevo_parentesco_contacto').val().toUpperCase();
            let nuevoTelefono = $('#telefono_contacto').val().toUpperCase();
            let creadoPor = '{{userName}}';  // Este campo estaba faltando en tu código



            // Validación de campos vacíos
            let errorMessage = '';

            if (!idEmpleado) {
                errorMessage += 'El campo de empleado es obligatorio, por favor ingrese un DNI válido.\n';
            }
            if (!creadoPor) {
                errorMessage += 'Su sesión ha expirado. Por favor, inicie sesión nuevamente para continuar.\n';
            }
            if (!nuevoNombre) {
                errorMessage += 'El campo de nombre de contacto está vacío.\n';
            }
            if (!nuevoTelefono) {
                errorMessage += 'El campo de teléfono de contacto está vacío.\n';
            }
            if (!nuevoParentesco) {
                errorMessage += 'El campo de parentesco está vacío.\n';
            }

            // Si hay errores, mostramos el mensaje y detenemos el envío
            if (errorMessage) {
                console.error('Campos vacíos:', {
                    id_empleado: idEmpleado,
                    nombre_contacto: nuevoNombre,
                    telefono_contacto: nuevoTelefono,
                    parentesco_contacto: nuevoParentesco,
                    creado_por: creadoPor
                });

                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: errorMessage.replace(/\n/g, ' '),  // Unimos los mensajes de error en una línea
                });
                return;  // Detener el envío del formulario
            }

            // Si no hay errores, proceder con la solicitud AJAX
            let csrfToken = $('input[name="csrfmiddlewaretoken"]').val();

            // Agregar console.log para verificar datos enviados
            console.log('Datos enviados:', {
                id_empleado: idEmpleado,
                nombre_contacto: nuevoNombre,
                telefono_contacto: nuevoTelefono,
                nuevo_parentesco_contacto: nuevoParentesco,
                creado_por: creadoPor,
                csrfmiddlewaretoken: csrfToken
            });

            $.ajax({
                url: "{% url 'insertar_contacto_emergencia' %}",
                type: 'POST',
                data: {
                    id_empleado: idEmpleado,
                    nombre_contacto: nuevoNombre,
                    telefono_contacto: nuevoTelefono,
                    parentesco_contacto: nuevoParentesco,
                    creado_por: creadoPor,
                    csrfmiddlewaretoken: csrfToken
                },
                success: function (data) {
                    console.log('Respuesta del servidor:', data);

                    $('#contactosEmergenciasModal').modal('hide');
                    if ($.fn.DataTable.isDataTable('#contactos-emergencia-table')) {
                        contactosemergenciatable.ajax.reload(null, false);  // Recargar la tabla
                    } else {
                        initializeTableContactos(idEmpleado);  // Inicializar la tabla si no estaba inicializada
                    }
                    // Limpiar el formulario y los campos select2
                    $('#formCrearContactoEmergencia')[0].reset();
                    $('#nuevo_parentesco_contacto').val('').trigger('change');
                },
                error: function (xhr, status, error) {
                    console.error('Error en la solicitud AJAX:', error);
                    console.log('Status:', status);
                    console.log('XHR:', xhr);
                }
            });
        });
    });


    $(document).ready(function () {


        let creadoPorElem = $('#creado-por');

        var familiaresTable;

        function initializeTableFamiliares(idEmpleado) {
            // Destruir la tabla existente si existe
            if ($.fn.DataTable.isDataTable('#familiares-table-unique')) {
                $('#familiares-table-unique').DataTable().clear().destroy();
            }

            // Inicializar la tabla de contactos familiares
            familiaresTable = $('#familiares-table-unique').DataTable({
                autoWidth: true,  
                scrollX: false,
                pageLength: 50,
                language: {
                    "processing": "Procesando...",
                    "lengthMenu": "Mostrar _MENU_ registros",
                    "zeroRecords": "No se encontraron resultados",
                    "emptyTable": "Ningún dato disponible en esta tabla",
                    "info": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                    "infoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                    "infoFiltered": "(filtrado de un total de _MAX_ registros)",
                    "search": "Buscar:",
                    "infoThousands": ",",
                    "loadingRecords": "Cargando...",
                    "paginate": {
                        "first": "Primero",
                        "last": "Último",
                        "next": "Siguiente",
                        "previous": "Anterior"
                    },
                    "aria": {
                        "sortAscending": ": Activar para ordenar la columna de manera ascendente",
                        "sortDescending": ": Activar para ordenar la columna de manera descendente"
                    },
                    "buttons": {
                        "copy": "Copiar",
                        "colvis": "Visibilidad"
                    }
                },
                initComplete: function () {
                    console.log('DataTable inicializado');
                },
                ajax: {
                    beforeSend: function (xhr, type) {
                        if (!type.crossDomain) {
                            xhr.setRequestHeader(
                                'X-CSRF-Token',
                                $('meta[name="csrf-token"]').attr('content')
                            );
                        }
                    },
                    url: "{% url 'obtener_contactos_familiar' %}",
                    type: "GET",
                    data: function (d) {
                        d.id_empleado = idEmpleado;
                    },
                    dataSrc: function (json) {
                        return json.data;
                    }
                },
                dom: 'Bfrtip',  // Define el orden de los elementos: Botones, Filtro, Tabla, Información, Paginación
                colReorder: {
                    realtime: false,
                },
                buttons: [{
                    extend: 'excel',
                    text: '<i class="fas fa-file-excel"></i>',
                    titleAttr: 'Excel',
                    className: 'btn btn-success',
                },
                {
                    extend: 'pdf',
                    text: '<i class="fas fa-file-pdf"></i>',
                    titleAttr: 'PDF',
                    className: 'btn btn-danger',
                },
                {
                    extend: 'print',
                    text: '<i class="fas fa-print"></i>',
                    titleAttr: 'Imprimir',
                    className: 'btn btn-primary',
                    orientation: 'landscape'
                }],
                columns: [
                    { "data": "id_familiar" },
                    { "data": "nombre_familiar" },
                    { "data": "telefono_familiar" },
                    { "data": "parentesco" },
                    { "data": "residencia" },
                    { "data": "fecha_hora_creado" },
                    { "data": "creado_por" },
                    { "data": "fecha_hora_modificado" },
                    { "data": "modificado_por" },
                    {
                        "data": null,
                        "render": function (data, type, row) {
                            return `
                               <div class="text-center">
                                    <div class="btn-group">
                                    
                            <button class="btn btn-warning btn-sm btn-edit-familiar-depend" data-id="${row.id_familiar}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger btn-sm btn-delete-familiar-depend" data-id="${row.id_familiar}">
                                <i class="fas fa-trash"></i>
                            </button>
                            </div>
                            </div>
                        `;
                        },
                        "orderable": false,
                        "width": '15%'
                    }
                ],
                order: [[0, "asc"]]
            });
        }

        $('#familiares-table-unique').css('width', '100%');
        let idEmpleado = $('#id-empleado').val() || $('#edit-id-empleado').val();

        if (idEmpleado) {
            initializeTableFamiliares(idEmpleado);
        } else {
            $('#table-container').html('<p>No hay un empleado seleccionado. Por favor, seleccione un empleado para ver los contactos familiares.</p>');
        }
	
        $('#btn-familiar-dependendiete').on('click', function () {
            $('#formCrearContactoFamiliar').trigger('reset');
            $('#id-familiar').val('');
        });	
    
        $(document).on('click', '.btn-delete-familiar-depend', function (e) {
            e.preventDefault();  
            var fila = $(this).closest('tr');
            familiar_id = fila.find("td:eq(0)").text();
            familiar_name = fila.find("td:eq(1)").text();
          
            estadoQuestionText = `Estas seguro de Deshabilitar este turno: ${familiar_name}?`;
            estadoSuccessText = 'Deshabilitado!';

            Swal.fire({
                title: estadoQuestionText,
                text: "",
                icon: "warning",
                showCancelButton: true,
                confirmButtonText: "Cancelar",
                cancelButtonText: "Confirmar",
                reverseButtons: true,
                customClass: {
                    confirmButton: 'btn btn-success ms-3',
                    cancelButton: 'btn btn-danger '
                },
                buttonsStyling: false
            }).then((result) => {
                if (result.isConfirmed) {
                    //
                } else {
                    $.ajax({
                        url: "{% url 'desactivar_familiar' %}",
                        type: 'POST',
                        data: {
                            id_familiar: familiar_id,
                            csrfmiddlewaretoken: "{{ csrf_token }}"
                        },
                        success: function (data) {
                            if (data.save == 1) {
                                Swal.fire("", estadoSuccessText, "success");

                                familiaresTable.ajax.reload(null, false);
                            } else {
                                Swal.fire("", "Error!", "error");
                                console.log(data.error);
                            }
                        }
                    });
                }
            });
        });


      $(document).on('click', '.btn-edit-familiar-depend', function (e) {
            e.preventDefault();  // Evita que la página se recargue

            var familiarRow = $(this).closest('tr'); 
            var rowData = familiaresTable.row(familiarRow).data();  

            $('#id-familiar').val(rowData.id_familiar);  // ID del beneficio laboral
            $('#nombre-familiar').val(rowData.nombre_familiar);  
            $('#telefono-familiar').val(rowData.telefono_familiar);  
            $('#nuevo-parentesco-familiar').val(rowData.id_parentesco).trigger('change');  
            $('#lugar-residencia').val(rowData.residencia).trigger('change');  
            opcionFamiliar = 2; 
            $('#modalFamiliares').modal('show');
        });
        $('#formCrearContactoFamiliar').on('submit', function (event) {
            event.preventDefault();

            // Capturar valores de los inputs
            let idFamiliar = $('#id-familiar').val();
            let idEmpleado = $('#id-empleado').val() || $('#edit-id-empleado').val();
            let nombreFamiliar = $('#nombre-familiar').val().trim().toUpperCase();
            let parentesco = $('#nuevo-parentesco-familiar').val();
            let telefono = $('#telefono-familiar').val().trim();
            let lugarResidencia = $('#lugar-residencia').val().trim().toUpperCase();
             opcionFamiliar = idFamiliar ? 2 : 1;

            // Validaciones de campos obligatorios
            let errores = [];
            if (!idEmpleado) errores.push('El campo de empleado es obligatorio.');
            if (!nombreFamiliar) errores.push('El nombre del familiar es obligatorio.');
            if (!telefono) errores.push('El teléfono del familiar es obligatorio.');
            if (!parentesco) errores.push('El parentesco del familiar es obligatorio.');

            // Mostrar errores si existen
            if (errores.length > 0) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    html: errores.join('<br>'), // Mostrar los mensajes de error como una lista
                });
                return;
            }

            // Preparar datos para el envío
            let csrfToken = $('input[name="csrfmiddlewaretoken"]').val();

            // Enviar datos por AJAX
            $.ajax({
                url: "{% url 'insertar_contacto_familiar' %}",
                type: 'POST',
                data: {
                    id_familiar: idFamiliar,
                    id_empleado: idEmpleado,
                    nombre_familiar: nombreFamiliar,
                    telefono_familiar: telefono,
                    parentesco: parentesco,
                    lugar_residencia: lugarResidencia,
                    opcion: opcionFamiliar,
                    csrfmiddlewaretoken: csrfToken
                },
                beforeSend: function () {
                    Swal.fire({
                        title: 'Procesando...',
                        text: 'Por favor, espere.',
                        allowOutsideClick: false,
                        showConfirmButton: false,
                        willOpen: () => {
                            Swal.showLoading();
                        }
                    });
                },
                success: function (data) {
                    Swal.close(); // Cerrar mensaje de carga
                    if (data.status === 'success') {
                        Swal.fire({
                            icon: 'success',
                            title: 'Éxito',
                            text: opcionFamiliar === 1 ? 'Familiar creado correctamente.' : 'Familiar actualizado correctamente.',
                        });

                        // Ocultar modal y resetear formulario
                        $('#modalFamiliares').modal('hide');
                        $('#formCrearContactoFamiliar')[0].reset();

                        // Recargar tabla de familiares
                        if ($.fn.DataTable.isDataTable('#familiares-table-unique')) {
                            familiaresTable.ajax.reload(null, false);
                        } else {
                            initializeTableFamiliares(idEmpleado);
                        }

                        // Reiniciar el select de parentesco (si es un select2)
                        $('#nuevo-parentesco-familiar').val(null).trigger('change');
                    } else {
                        Swal.fire({
                            icon: 'warning',
                            title: 'Advertencia',
                            text: data.message || 'No se pudo completar la operación.',
                        });
                    }
                },
                error: function (xhr, status, error) {
                    Swal.close(); // Cerrar mensaje de carga
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Ocurrió un error en el servidor. Por favor, inténtelo nuevamente.',
                    });
                    console.error('Error en la solicitud AJAX:', error);
                }
            });
        });
    
    });

    $(document).ready(function () {
        let tableEnfermedades;

        function initializeTableEnfermedadesBase(idEmpleado) {

            // Destruir la tabla existente si existe
            if ($.fn.DataTable.isDataTable('#enfermedades-base-table')) {
                $('#enfermedades-base-table').DataTable().clear().destroy();
            }

            // Inicializar la tabla de enfermedades base
            tableEnfermedades = $('#enfermedades-base-table').DataTable({
                autoWidth: true,  // Permitir que DataTables ajuste el ancho automáticamente
                scrollX: false,
                pageLength: 50,
                dom: 'Bfrtip',
                autoWidth: false,
                language: {
                    "processing": "Procesando...",
                    "lengthMenu": "Mostrar _MENU_ registros",
                    "zeroRecords": "No se encontraron resultados",
                    "emptyTable": "Ningún dato disponible en esta tabla",
                    "info": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                    "infoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                    "infoFiltered": "(filtrado de un total de _MAX_ registros)",
                    "search": "Buscar:",
                    "infoThousands": ",",
                    "loadingRecords": "Cargando...",
                    "paginate": {
                        "first": "Primero",
                        "last": "Último",
                        "next": "Siguiente",
                        "previous": "Anterior"
                    },
                    "aria": {
                        "sortAscending": ": Activar para ordenar la columna de manera ascendente",
                        "sortDescending": ": Activar para ordenar la columna de manera descendente"
                    },
                    "buttons": {
                        "copy": "Copiar",
                        "colvis": "Visibilidad"
                    }
                },
                ajax: {
                    beforeSend: function (xhr, type) {
                        if (!type.crossDomain) {
                            xhr.setRequestHeader(
                                'X-CSRF-Token',
                                $('meta[name="csrf-token"]').attr('content')
                            );
                        }
                    },
                    url: "{% url 'obtener_empleado_enfermedades_base' %}", // Cambiar a la URL adecuada
                    type: "GET",
                    data: function (d) {
                        d.id_empleado = idEmpleado;
                        console.log('Datos enviados en la solicitud AJAX:', d);
                    },
                    dataSrc: function (json) {
                        console.log('Datos recibidos de la solicitud AJAX:', json);
                        return json.data;
                    }
                },
                colReorder: {
                    realtime: false,
                },
                buttons: [{
                    extend: 'excel',
                    text: '<i class="fas fa-file-excel"></i>',
                    titleAttr: 'Excel',
                    className: 'btn btn-success',
                },

                {
                    extend: 'print',
                    text: '<i class="fas fa-print"></i>',
                    titleAttr: 'Imprimir',
                    className: 'btn btn-primary',
                    orientation: 'landscape'
                }],
                columns: [
                    { "data": "id_enfermedad" },
                    { "data": "nombre_enfermedad" }
                ],
                order: [[0, "asc"]],
                initComplete: function () {
                    tableEnfermedades.columns.adjust().draw();  // Forzar el ajuste de columnas
                }
            });
        }

        // Aplicar el ancho completo
        $('#enfermedades-base-table').css('width', '100%');

        let idEmpleado = $('#id-empleado').val() || $('#edit-id-empleado').val();

        if (idEmpleado) {
            // Inicializa la tabla de enfermedades base si hay un empleado seleccionado
            initializeTableEnfermedadesBase(idEmpleado);
        } else {
            $('#enfermedades-container').html('<p>No hay un empleado seleccionado. Por favor, seleccione un empleado para ver las enfermedades base.</p>');
        }

        // Manejar el formulario de creación de una nueva enfermedad base
        // Manejar el formulario de creación de una nueva enfermedad base
        $('#formCrearEnfermedadesBase').on('submit', function (event) {
            event.preventDefault();

            let idEmpleado = $('#id-empleado').val() || $('#edit-id-empleado').val();
            let idEnfermedadCatalogo = $('#enfermedad-base').val();
            let creadoPor = '{{userName}}';

            console.log('Valores capturados:', {
                idEmpleado: idEmpleado,
                idEnfermedadCatalogo: idEnfermedadCatalogo,
                creadoPor: creadoPor,
            });

            // Acumulador de errores
            let errorMessage = '';

            // Verificar campo por campo
            if (!idEmpleado) {
                errorMessage += 'El campo de empleado es obligatorio, por favor ingrese un DNI válido.\n';
            }
            if (!idEnfermedadCatalogo) {
                errorMessage += 'El campo "Enfermedad Base" está vacío.\n';
            }
            if (!creadoPor) {
                errorMessage += 'Su sesión ha expirado. Por favor, inicie sesión nuevamente para continuar.\n';
            }

            // Si hay algún error, mostrar mensaje con los campos faltantes
            if (errorMessage) {
                console.error('Errores de validación:', errorMessage);

                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: errorMessage.replace(/\n/g, ' '),  // Mostrar los errores en una sola línea
                });
                return;  // Detener el envío del formulario
            }

            // Si no hay errores, proceder con la solicitud AJAX
            let csrfToken = $('input[name="csrfmiddlewaretoken"]').val();

            console.log('CSRF Token:', csrfToken);

            $.ajax({
                url: "{% url 'insertar_empleado_enfermedades_base' %}", // Cambiar a la URL adecuada
                type: 'POST',
                data: {
                    id_empleado: idEmpleado,
                    enfermedad_base: idEnfermedadCatalogo,
                    creado_por: creadoPor,
                    csrfmiddlewaretoken: csrfToken
                },
                success: function (data) {
                    console.log('Respuesta del servidor al crear enfermedad base:', data);

                    $('#modalCrearEnfermedadesBase').modal('hide');
                    if (tableEnfermedades) {
                        console.log('Recargando la tabla de enfermedades base');
                        tableEnfermedades.ajax.reload();  // Recargar la tabla si ya está inicializada
                    } else {
                        console.log('Inicializando la tabla de enfermedades base');
                        initializeTableEnfermedadesBase(idEmpleado);  // Inicializar la tabla si no estaba inicializada
                    }
                    // Limpiar el formulario y el select2
                    $('#formCrearEnfermedadesBase')[0].reset();
                    $('#enfermedad-base').val('').trigger('change');
                },
                error: function (xhr, status, error) {
                    console.error('Error en la solicitud AJAX:', error);
                }
            });
        });

    });






    $(document).ready(function () {
        let table1;

        function initializeTableSeguros(idEmpleado) {

            // Destruir la tabla existente si existe
            if ($.fn.DataTable.isDataTable('#seguros-table')) {
                $('#seguros-table').DataTable().clear().destroy();
            }

            // Inicializar la tabla de seguros
            table1 = $('#seguros-table').DataTable({
                autoWidth: true,  // Permitir que DataTables ajuste el ancho automáticamente
                scrollX: false,
                pageLength: 50,
                dom: 'Bfrtip',
                autoWidth: false,
                language: {
                    "processing": "Procesando...",
                    "lengthMenu": "Mostrar _MENU_ registros",
                    "zeroRecords": "No se encontraron resultados",
                    "emptyTable": "Ningún dato disponible en esta tabla",
                    "info": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                    "infoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                    "infoFiltered": "(filtrado de un total de _MAX_ registros)",
                    "search": "Buscar:",
                    "infoThousands": ",",
                    "loadingRecords": "Cargando...",
                    "paginate": {
                        "first": "Primero",
                        "last": "Último",
                        "next": "Siguiente",
                        "previous": "Anterior"
                    },
                    "aria": {
                        "sortAscending": ": Activar para ordenar la columna de manera ascendente",
                        "sortDescending": ": Activar para ordenar la columna de manera descendente"
                    },
                    "buttons": {
                        "copy": "Copiar",
                        "colvis": "Visibilidad"
                    }
                },
                ajax: {
                    beforeSend: function (xhr, type) {
                        if (!type.crossDomain) {
                            xhr.setRequestHeader(
                                'X-CSRF-Token',
                                $('meta[name="csrf-token"]').attr('content')
                            );
                        }
                    },
                    url: "{% url 'obtener_seguros' %}",
                    type: "GET",
                    data: function (d) {
                        d.id_empleado = idEmpleado;
                        console.log('Datos enviados en la solicitud AJAX:', d);
                    },
                    dataSrc: function (json) {
                        console.log('Datos recibidos de la solicitud AJAX:', json);
                        return json.data;
                    }
                },
                colReorder: {
                    realtime: false,
                },
                buttons: [{
                    extend: 'excel',
                    text: '<i class="fas fa-file-excel"></i>',
                    titleAttr: 'Excel',
                    className: 'btn btn-success',
                },
                {
                    extend: 'pdf',
                    text: '<i class="fas fa-file-pdf"></i>',
                    titleAttr: 'PDF',
                    className: 'btn btn-danger',
                },
                {
                    extend: 'print',
                    text: '<i class="fas fa-print"></i>',
                    titleAttr: 'Imprimir',
                    className: 'btn btn-primary',
                    orientation: 'landscape'
                }],
                columns: [  // Definición de las columnas de la tabla
                    { "data": "id_seguro" },  // ID del seguro
                    { "data": "nombre_seguro" },  // Nombre del seguro
                    { "data": "poliza" },  // Póliza del seguro
                    { "data": "valor_mensual" },  // Valor mensual del seguro
                    { "data": "fecha_inicio" },  // Fecha de inicio del seguro
                    { "data": "fecha_fin" },  // Fecha final del seguro
                    {  // Columna para el botón de editar
                        "data": null,
                        "render": function (data, type, row) {
                            return `
                         <button class="btn btn-warning btn-sm btn-edit" data-id="${row.id_seguro}"
                    data-id_empresa="${row.id_empresa}" data-id_poliza="${row.id_poliza}">
                    <i class="fas fa-edit"></i>
                </button>
                    `;
                        },
                        "orderable": false,  // Evitar que esta columna sea ordenable
                        "width": '10%'  // Ajusta el ancho de la columna
                    }
                ],
                order: [[0, "asc"]],  // Orden inicial por la primera columna
                initComplete: function () {
                    table1.columns.adjust().draw();  // Ajustar las columnas al cargar la tabla
                }
            });
        }

        // Opcional: Aplicar CSS para asegurar el ancho completo
        $('#seguros-table').css('width', '100%');

        let idEmpleado = $('#id-empleado').val() || $('#edit-id-empleado').val();

        if (idEmpleado) {
            // Siempre inicializa la tabla cuando hay un empleado seleccionado
            initializeTableSeguros(idEmpleado);
        } else {
            $('#seguros-container').html('<p>No hay un empleado seleccionado. Por favor, seleccione un empleado para ver los seguros.</p>');
        }

        $('#form-seguro').on('submit', function (event) {
            event.preventDefault();

            let idSeguro = $('#id-seguro').val();  // ID de seguro si se está editando
            let idEmpleado = $('#id-empleado').val() || $('#edit-id-empleado').val();
            let nuevoNombre = $('#nombre-seguro').val().toUpperCase();
            let poliza = $('#poliza').val();
            let valorMensual = $('#valor_mensual').val();
            let fechaInicio = $('#fecha-inicio-seguro').val();
            let fechaFinal = $('#fecha-fin-seguro').val();
            let modificadoPor = $('#creado-por').val();

            // Validaciones
            let errorMessage = '';

            if (!idEmpleado) errorMessage += 'El campo de empleado es obligatorio.\n';
            if (!nuevoNombre) errorMessage += 'El campo de nombre de la empresa de seguro está vacío.\n';
            if (!poliza) errorMessage += 'El campo de póliza está vacío.\n';
            if (!valorMensual) errorMessage += 'El campo de valor mensual está vacío.\n';
            if (!fechaInicio) errorMessage += 'El campo de fecha de inicio está vacío.\n';
            if (!modificadoPor) errorMessage += 'Su sesión ha sido cerrada.\n';

            if (errorMessage) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: errorMessage.replace(/\n/g, ' '),
                });
                return;
            }

            // Solicitud AJAX
            let csrfToken = $('input[name="csrfmiddlewaretoken"]').val();

            $.ajax({
                url: "{% url 'insertar_seguros' %}",
                type: 'POST',
                data: {
                    id_seguro: idSeguro,  // Se usa para saber si es actualización o inserción
                    id_empleado: idEmpleado,
                    nombre_seguro: nuevoNombre,
                    poliza: poliza,
                    valor_mensual: valorMensual,
                    fecha_inicio: fechaInicio,
                    fecha_fin: fechaFinal,
                    creado_por: modificadoPor,
                    csrfmiddlewaretoken: csrfToken
                },
                success: function (data) {
                    $('#nuevoSeguroModal').modal('hide');

                    if (table1) {
                        table1.ajax.reload();  // Recargar la tabla si está inicializada
                    } else {
                        initializeTableSeguros(idEmpleado);  // Inicializar la tabla si no existe
                    }

                    // Limpiar el formulario
                    $('#form-seguro')[0].reset();  // Limpiar campos de texto y selects

                    // Limpiar los campos de tipo select
                    $('#id-seguro').val(null).trigger('change');  // Limpiar select de seguro
                    $('#nombre-seguro').val(null).trigger('change');  // Limpiar select de nombre de seguro
                    $('#id-empleado').val(null).trigger('change');  // Limpiar select de empleado
                },
                error: function (xhr, status, error) {
                    console.error('Error en la solicitud AJAX:', error);
                }
            });
        });


        $(document).on('click', '.btn-edit', function (e) {
            e.preventDefault();  // Evita que la página se recargue

            var seguroRow = $(this).closest('tr');  // Obtiene la fila más cercana
            var rowData = table1.row(seguroRow).data();  // Obtiene los datos de la fila desde DataTables

            // Cargar los datos en el modal usando los valores de rowData
            $('#id-seguro').val(rowData.id_seguro);  // Cargar el ID del seguro
            $('#nombre-seguro').val(rowData.id_empresa).trigger('change');  // Cargar el ID de la empresa de seguros
            $('#poliza').val(rowData.id_poliza).trigger('change');  // Cargar el ID de la póliza
            $('#valor_mensual').val(rowData.valor_mensual);  // Valor mensual
            $('#fecha-inicio-seguro').val(rowData.fecha_inicio);  // Fecha de inicio
            $('#fecha-fin-seguro').val(rowData.fecha_fin);  // Fecha de fin

            // Abrir el modal
            $('#nuevoSeguroModal').modal('show');
        });

    });


    $(document).ready(function () {
        let tableBeneficiosLaborales;

        function initializeTableBeneficiosLaborales(idEmpleado) {

            // Destruir la tabla existente si existe
            if ($.fn.DataTable.isDataTable('#beneficios-laborales-table')) {
                $('#beneficios-laborales-table').DataTable().clear().destroy();
            }

            // Inicializar la tabla de seguros
            tableBeneficiosLaborales = $('#beneficios-laborales-table').DataTable({
                autoWidth: true, 
                scrollX: false,
                pageLength: 50,
                dom: 'Bfrtip',
                autoWidth: false,
                language: {
                    "processing": "Procesando...",
                    "lengthMenu": "Mostrar _MENU_ registros",
                    "zeroRecords": "No se encontraron resultados",
                    "emptyTable": "Ningún dato disponible en esta tabla",
                    "info": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                    "infoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                    "infoFiltered": "(filtrado de un total de _MAX_ registros)",
                    "search": "Buscar:",
                    "infoThousands": ",",
                    "loadingRecords": "Cargando...",
                    "paginate": {
                        "first": "Primero",
                        "last": "Último",
                        "next": "Siguiente",
                        "previous": "Anterior"
                    },
                    "aria": {
                        "sortAscending": ": Activar para ordenar la columna de manera ascendente",
                        "sortDescending": ": Activar para ordenar la columna de manera descendente"
                    },
                    "buttons": {
                        "copy": "Copiar",
                        "colvis": "Visibilidad"
                    }
                },
                ajax: {
                    beforeSend: function (xhr, type) {
                        if (!type.crossDomain) {
                            xhr.setRequestHeader(
                                'X-CSRF-Token',
                                $('meta[name="csrf-token"]').attr('content')
                            );
                        }
                    },
                    url: "{% url 'obtener_beneficio_laboral' %}",
                    type: "GET",
                    data: function (d) {
                        d.id_empleado = idEmpleado;
                        console.log('Datos enviados en la solicitud AJAX:', d);
                    },
                    dataSrc: function (json) {
                        console.log('Datos recibidos de la solicitud AJAX:', json);
                        return json.data;
                    }
                },
                colReorder: {
                    realtime: false,
                },
                buttons: [{
                    extend: 'excel',
                    text: '<i class="fas fa-file-excel"></i>',
                    titleAttr: 'Excel',
                    className: 'btn btn-success',
                },
                {
                    extend: 'pdf',
                    text: '<i class="fas fa-file-pdf"></i>',
                    titleAttr: 'PDF',
                    className: 'btn btn-danger',
                },
                {
                    extend: 'print',
                    text: '<i class="fas fa-print"></i>',
                    titleAttr: 'Imprimir',
                    className: 'btn btn-primary',
                    orientation: 'landscape'
                }],
                columns: [
                    { "data": "id_beneficio_laboral" },
                    { "data": "nombre_beneficio_cat" },
                    { "data": "descripcion" },
                    { "data": "valor_beneficio" },
                    {
                        "data": null,
                        "render": function (data, type, row) {
                            return `
                <button class="btn btn-warning btn-sm btn-edit-laboral" data-id="${row.id_beneficio_laboral}">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-danger btn-sm btn-delete-laboral" data-id="${row.id_beneficio_laboral}">
                    <i class="fas fa-trash"></i>
                </button>
            `;
                        },
                        "orderable": false,
                        "width": '15%'  // Ajustar el ancho de la columna para incluir ambos botones
                    }
                ],
                order: [[0, "asc"]],
                initComplete: function () {
                    tableBeneficiosLaborales.columns.adjust().draw();  // Ajustar las columnas al cargar la tabla
                }


            });


        }
        // Opcional: Aplicar CSS para asegurar el ancho completo
        $('#beneficios-laborales-table').css('width', '100%');


        let idEmpleado = $('#id-empleado').val() || $('#edit-id-empleado').val();

        if (idEmpleado) {
            // Siempre inicializa la tabla cuando hay un empleado seleccionado
            initializeTableBeneficiosLaborales(idEmpleado);
        } else {
            $('#laborales-container').html('<p>No hay un empleado seleccionado. Por favor, seleccione un empleado para ver los seguros.</p>');
        }

        $('#formCrearBeneficioLaboralEmpleado').on('submit', function (event) {
            event.preventDefault();

            // Obtener los valores de los campos
            let idBeneficioLaboral = $('#id-laborales').val();  // ID del beneficio laboral (para actualización)
            let idEmpleado = $('#id-empleado').val() || $('#edit-id-empleado').val();
            let idLaboral = $('#nuevo-beneficios-laborales').val();
            let valorBeneficio = $('#valor-beneficio-laboral').val();
            let creadoPor = $('#creado_por').val();

            console.log('Valores capturados:', {
                id_beneficio_laboral: idBeneficioLaboral,
                id_empleado: idEmpleado,
                id_laboral: idLaboral,
                valor_beneficio: valorBeneficio,
                creado_por: creadoPor,
            });

            // Validación de campos vacíos
            let errorMessage = '';

            if (!idEmpleado) {
                errorMessage += 'El campo de empleado es obligatorio, por favor ingrese un DNI válido.\n';
            }
            if (!idLaboral) {
                errorMessage += 'El campo de beneficios laborales está vacío.\n';
            }
            if (!valorBeneficio) {
                errorMessage += 'El campo de valor del beneficio está vacío.\n';
            }
            if (!creadoPor) {
                errorMessage += 'Su sesión ha sido cerrada. Inicie sesión nuevamente para continuar.\n';
            }

            // Si hay errores, mostrar el mensaje y detener el envío
            if (errorMessage) {
                console.error('Campos vacíos:', {
                    id_beneficio_laboral: idBeneficioLaboral,
                    id_empleado: idEmpleado,
                    id_laboral: idLaboral,
                    valor_beneficio: valorBeneficio,
                    creado_por: creadoPor,
                });

                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: errorMessage.replace(/\n/g, ' '),  // Mostrar los errores en una sola línea
                });
                return;  // Detener el envío del formulario
            }

            // Si no hay errores, proceder con la solicitud AJAX
            let csrfToken = $('input[name="csrfmiddlewaretoken"]').val();

            console.log('Datos que se enviarán:', {
                id_beneficio_laboral: idBeneficioLaboral,
                id_empleado: idEmpleado,
                id_laboral: idLaboral,
                valor_beneficio: valorBeneficio,
                creado_por: creadoPor,
                csrfmiddlewaretoken: csrfToken
            });

            $.ajax({
                url: "{% url 'insertar_beneficios_laborales' %}",  // Asegúrate de que esta URL sea la correcta
                type: 'POST',
                data: {
                    id_beneficio_laboral: idBeneficioLaboral,  // Incluye el ID para actualizar
                    id_empleado: idEmpleado,
                    id_laboral: idLaboral,
                    valor_beneficio: valorBeneficio,
                    creado_por: creadoPor,
                    csrfmiddlewaretoken: csrfToken
                },
                success: function (data) {
                    if (data.status === 'success') {
                        console.log('Beneficio laboral creado/actualizado con éxito:', data);

                        $('#modalCrearBeneficioLaboralEmpleado').modal('hide');

                        if (tableBeneficiosLaborales) {
                            tableBeneficiosLaborales.ajax.reload();  // Recargar la tabla si ya está inicializada
                        } else {
                            initializeTableBeneficiosLaborales(idEmpleado);  // Inicializar la tabla si no estaba inicializada
                        }

                        // Resetear el formulario
                        $('#formCrearBeneficioLaboralEmpleado')[0].reset();
                        $('#nuevo-beneficios-laborales').val('').trigger('change');
                    } else {
                        console.error('Error en la respuesta del servidor:', data.error);
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'No se pudo crear/actualizar el beneficio laboral. Por favor, inténtelo nuevamente.',
                        });
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error en la solicitud AJAX:', error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Hubo un problema al realizar la solicitud.',
                    });
                }
            });
        });

        $(document).on('click', '.btn-edit-laboral', function (e) {
            e.preventDefault();  // Evita que la página se recargue

            var beneficioRow = $(this).closest('tr');  // Obtiene la fila más cercana
            var rowData = tableBeneficiosLaborales.row(beneficioRow).data();  // Obtiene los datos de la fila desde DataTables

            // Cargar los datos en el modal usando los valores de rowData
            $('#id-laborales').val(rowData.id_beneficio_laboral);  // ID del beneficio laboral
            $('#nuevo-beneficios-laborales').val(rowData.id_laboral).trigger('change');  // ID laboral
            $('#valor-beneficio-laboral').val(rowData.valor_beneficio);  // Valor del beneficio

            // Cambiar el texto del botón a 'Editar'
            $('#btnGuardarBeneficioLaboral').text('Editar');

            // Abrir el modal
            $('#modalCrearBeneficioLaboralEmpleado').modal('show');
        });

        // Resetear el modal al cerrar
        $('#modalCrearBeneficioLaboralEmpleado').on('hidden.bs.modal', function () {
            // Limpiar los campos del modal
            $('#formCrearBeneficioLaboralEmpleado')[0].reset();
            $('#id-laborales').val('');

            // Restaurar el texto del botón a 'Guardar'
            $('#btnGuardarBeneficioLaboral').text('Guardar');
        });

        $(document).on('click', '.btn-delete-laboral', function (e) {
            e.preventDefault();

            let idBeneficioLaboral = $(this).data('id');

            // Confirmar la eliminación con SweetAlert
            Swal.fire({
                title: '¿Estás seguro?',
                text: "Esta acción no se puede deshacer.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Sí, eliminar',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Realizar la solicitud AJAX para eliminar
                    $.ajax({
                        url: "{% url 'eliminar_beneficio_laboral' %}",  // Asegúrate de que esta URL sea la correcta
                        type: 'POST',
                        data: {
                            id_beneficio_laboral: idBeneficioLaboral,
                            csrfmiddlewaretoken: $('input[name="csrfmiddlewaretoken"]').val()
                        },
                        success: function (data) {
                            if (data.status === 'success') {
                                Swal.fire('Eliminado', 'El beneficio laboral ha sido eliminado.', 'success');

                                // Recargar la tabla
                                tableBeneficiosLaborales.ajax.reload();
                            } else {
                                Swal.fire('Error', 'No se pudo eliminar el beneficio laboral.', 'error');
                            }
                        },
                        error: function (xhr, status, error) {
                            Swal.fire('Error', 'Hubo un problema al realizar la solicitud.', 'error');
                        }
                    });
                }
            });
        });

        $('.limpiar').on('click', function () {
            // Limpiar el formulario
            $('#formCrearBeneficioLaboralEmpleado')[0].reset();

            // Restablecer el valor del select
            $('#nuevo-beneficios-laborales').val('').trigger('change');
        });



    });

    $(document).ready(function () {
        let tableBeneficiosAdicional;

        function initializeTableBeneficiosAdicional(idEmpleado) {  // Corregir el nombre de la función

            // Destruir la tabla existente si existe
            if ($.fn.DataTable.isDataTable('#beneficios-adicionales-table')) {
                $('#beneficios-adicionales-table').DataTable().clear().destroy();
            }

            // Inicializar la tabla de beneficios adicionales
            tableBeneficiosAdicional = $('#beneficios-adicionales-table').DataTable({
                autoWidth: true,
                scrollX: false,
                pageLength: 50,
                dom: 'Bfrtip',
                language: {
                    // Configuración del idioma
                    "processing": "Procesando...",
                    "lengthMenu": "Mostrar _MENU_ registros",
                    "zeroRecords": "No se encontraron resultados",
                    "emptyTable": "Ningún dato disponible en esta tabla",
                    "info": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                    "infoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                    "infoFiltered": "(filtrado de un total de _MAX_ registros)",
                    "search": "Buscar:",
                    "paginate": {
                        "first": "Primero",
                        "last": "Último",
                        "next": "Siguiente",
                        "previous": "Anterior"
                    },
                },
                ajax: {
                    beforeSend: function (xhr, type) {
                        if (!type.crossDomain) {
                            xhr.setRequestHeader(
                                'X-CSRF-Token',
                                $('meta[name="csrf-token"]').attr('content')
                            );
                        }
                    },
                    url: "{% url 'obtener_beneficio_adicional' %}",
                    type: "GET",
                    data: function (d) {
                        d.id_empleado = idEmpleado;
                        console.log('Datos enviados en la solicitud AJAX:', d);
                    },
                    dataSrc: function (json) {
                        console.log('Datos recibidos de la solicitud AJAX:', json);
                        return json.data;
                    }
                },
                colReorder: {
                    realtime: false,
                },
                buttons: [
                    {
                        extend: 'excel',
                        text: '<i class="fas fa-file-excel"></i>',
                        titleAttr: 'Excel',
                        className: 'btn btn-success',
                    },
                    {
                        extend: 'pdf',
                        text: '<i class="fas fa-file-pdf"></i>',
                        titleAttr: 'PDF',
                        className: 'btn btn-danger',
                    },
                    {
                        extend: 'print',
                        text: '<i class="fas fa-print"></i>',
                        titleAttr: 'Imprimir',
                        className: 'btn btn-primary',
                        orientation: 'landscape'
                    }
                ],
                columns: [
                    { "data": "id_beneficio_adicionales" },
                    { "data": "nombre_beneficio_cat" },
                    { "data": "descripcion" },
                    { "data": "valor_beneficio" },
                    {
                        "data": null,
                        "render": function (data, type, row) {
                            return `
                            <button class="btn btn-warning btn-sm btn-edit-adicional" data-id="${row.id_beneficio_adicionales}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger btn-sm btn-delete-adicional" data-id="${row.id_beneficio_adicionales}">
                                <i class="fas fa-trash"></i>
                            </button>
                        `;
                        },
                        "orderable": false,
                        "width": '15%'
                    }
                ],
                order: [[0, "asc"]],
                initComplete: function () {
                    tableBeneficiosAdicional.columns.adjust().draw();  // Ajustar las columnas al cargar la tabla
                }
            });
        }

        // Aplicar CSS para asegurar el ancho completo
        $('#beneficios-adicionales-table').css('width', '100%');

        let idEmpleado = $('#id-empleado').val() || $('#edit-id-empleado').val();

        if (idEmpleado) {
            // Siempre inicializa la tabla cuando hay un empleado seleccionado
            initializeTableBeneficiosAdicional(idEmpleado);  // Corregir llamada a la función
        } else {
            $('#laborales-container').html('<p>No hay un empleado seleccionado. Por favor, seleccione un empleado para ver los beneficios adicionales.</p>');
        }
        $('#formCrearBeneficioAdicionalEmpleado').on('submit', function (event) {
            event.preventDefault();

            // Obtener los valores de los campos
            let idBeneficioAdicional = $('#id-beneficio-adicional').val();  // Para actualización
            let idEmpleado = $('#id-empleado').val() || $('#edit-id-empleado').val();
            let valorBeneficio = $('#valor-beeneficio-adicional').val();  // Corregido 'valor-beeneficio-adicional'
            let idBeneficio = $('#nuevo-beneficio-adicional').val();
            let creadoPor = $('#creado_por').val();

            console.log('Valores capturados:', {
                id_beneficio_adicional: idBeneficioAdicional,
                id_empleado: idEmpleado,
                valor_beneficio: valorBeneficio,
                id_beneficio: idBeneficio,
                creado_por: creadoPor,
            });

            // Validación de campos vacíos
            let errorMessage = '';

            if (!idEmpleado) {
                errorMessage += 'El campo de empleado es obligatorio, por favor ingrese un DNI válido.\n';
            }
            if (!valorBeneficio) {
                errorMessage += 'El campo de valor del beneficio adicional está vacío.\n';
            }
            if (!idBeneficio) {
                errorMessage += 'El campo de beneficio adicional está vacío.\n';
            }
            if (!creadoPor) {
                errorMessage += 'Su sesión ha sido cerrada. Inicie sesión nuevamente para continuar.\n';
            }

            // Si hay errores, mostrar el mensaje y detener el envío
            if (errorMessage) {
                console.error('Campos vacíos:', {
                    id_beneficio_adicional: idBeneficioAdicional,
                    id_empleado: idEmpleado,
                    valor_beneficio: valorBeneficio,
                    id_beneficio: idBeneficio,
                    creado_por: creadoPor,
                });

                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: errorMessage.replace(/\n/g, ' '),  // Mostrar los errores en una sola línea
                });
                return;  // Detener el envío del formulario
            }

            // Si no hay errores, proceder con la solicitud AJAX
            let csrfToken = $('input[name="csrfmiddlewaretoken"]').val();

            console.log('Datos que se enviarán:', {
                id_beneficio_adicional: idBeneficioAdicional,
                id_empleado: idEmpleado,
                valor_beneficio: valorBeneficio,
                id_beneficio: idBeneficio,
                creado_por: creadoPor,
                csrfmiddlewaretoken: csrfToken
            });

            $.ajax({
                url: "{% url 'insertar_beneficio_adicional' %}",  // Asegúrate de que esta URL sea la correcta
                type: 'POST',
                data: {
                    id_beneficio_adicionales: idBeneficioAdicional,  // ID para actualizar
                    id_empleado: idEmpleado,
                    valor_beneficio: valorBeneficio,
                    id_beneficio: idBeneficio,
                    creado_por: creadoPor,
                    csrfmiddlewaretoken: csrfToken
                },
                success: function (data) {
                    if (data.status === 'success') {
                        console.log('Beneficio adicional creado/actualizado con éxito:', data);

                        $('#modalCrearBeneficioAdicionalEmpleado').modal('hide');

                        if (tableBeneficiosAdicional) {
                            tableBeneficiosAdicional.ajax.reload();  // Recargar la tabla si ya está inicializada
                        } else {
                            initializeTableBeneficiosAdicionales(idEmpleado);  // Inicializar la tabla si no estaba inicializada
                        }

                        // Limpiar el formulario y el select2 después de un envío exitoso
                        $('#formCrearBeneficioAdicionalEmpleado')[0].reset();  // Limpiar el formulario
                        $('#nuevo-beneficio-adicional').val('').trigger('change');  // Limpiar el select2

                    } else {
                        console.error('Error en la respuesta del servidor:', data.error);
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'No se pudo crear/actualizar el beneficio adicional. Por favor, inténtelo nuevamente.',
                        });
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error en la solicitud AJAX:', error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Hubo un problema al realizar la solicitud.',
                    });
                }
            });


        });

        // Editar beneficio adicional
        $(document).on('click', '.btn-edit-adicional', function (e) {
            e.preventDefault();

            var adicionalRow = $(this).closest('tr');  // Obtener la fila más cercana
            var rowData = tableBeneficiosAdicional.row(adicionalRow).data();  // Obtener datos de la fila

            if (!rowData) {
                console.error('No se encontraron datos para la fila seleccionada.');
                return;
            }

            // Cargar los datos en el modal
            $('#id-beneficio-adicional').val(rowData.id_beneficio_adicionales);  // ID del beneficio adicional
            $('#nuevo-beneficio-adicional').val(rowData.id_beneficio).trigger('change');  // ID del beneficio en el select
            $('#valor-beeneficio-adicional').val(rowData.valor_beneficio);  // Valor del beneficio

            // Cambiar el texto del botón a 'Editar'
            $('#btnGuardarBeneficioAdicional').text('Editar');

            // Abrir el modal
            $('#modalCrearBeneficioAdicionalEmpleado').modal('show');
        });

        // Resetear el modal al cerrar
        $('#modalCrearBeneficioAdicionalEmpleado').on('hidden.bs.modal', function () {
            // Limpiar los campos del modal
            $('#formCrearBeneficioAdicionalEmpleado')[0].reset();
            $('#id-beneficio-adicional').val('');

            // Restaurar el texto del botón a 'Guardar'
            $('#btnGuardarBeneficioAdicional').text('Guardar');
        });


        // Resetear el modal al cerrar
        $('#modalCrearBeneficioLaboralEmpleado').on('hidden.bs.modal', function () {
            // Limpiar los campos del modal
            $('#formCrearBeneficioLaboralEmpleado')[0].reset();
            $('#id-laborales').val('');

            // Restaurar el texto del botón a 'Guardar'
            $('#btnGuardarBeneficioLaboral').text('Guardar');
        });
        // Eliminar beneficio adicional
        $(document).on('click', '.btn-delete-adicional', function (e) {
            e.preventDefault();

            let idBeneficioAdicional = $(this).data('id');

            Swal.fire({
                title: '¿Estás seguro?',
                text: "Esta acción no se puede deshacer.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Sí, eliminar',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Realizar la solicitud AJAX para eliminar
                    $.ajax({
                        url: "{% url 'eliminar_beneficio_adicional' %}",  // Asegúrate de que esta URL sea la correcta
                        type: 'POST',
                        data: {
                            id_beneficio_adicionales: idBeneficioAdicional,
                            csrfmiddlewaretoken: $('input[name="csrfmiddlewaretoken"]').val()
                        },
                        success: function (data) {
                            if (data.status === 'success') {
                                Swal.fire('Eliminado', 'El beneficio adicional ha sido eliminado.', 'success');

                                // Recargar la tabla
                                tableBeneficiosAdicional.ajax.reload();
                            } else {
                                Swal.fire('Error', 'No se pudo eliminar el beneficio adicional.', 'error');
                            }
                        },
                        error: function (xhr, status, error) {
                            Swal.fire('Error', 'Hubo un problema al realizar la solicitud.', 'error');
                        }
                    });
                }
            });
        });

        $('.limpiar').on('click', function () {
            $('#formCrearBeneficioAdicionalEmpleado')[0].reset();  // Limpiar el formulario
            $('#nuevo-beneficio-adicional').val('').trigger('change');  // Limpiar el select2
        });
    });


    $('#rol-empleado').on('select2:select', function (e) {
        var selectedValue = e.params.data.id;
        console.log("Valor seleccionado:", selectedValue); // Verificar el valor seleccionado
        if (selectedValue === 'new-rol-empleado') {
            $('#modalCrearRol').modal('show'); // Mostrar el modal para crear un nuevo rol
            $('#rol-empleado').val(null).trigger('change'); // Restablecer el valor del select
        }
    });

    $('#formCrearRol').on('submit', function (event) {
        event.preventDefault(); // Evitar el envío normal del formulario

        // Obtener los valores del formulario
        let nombreRol = $('#nombre-rol').val().trim().toUpperCase();
        let descripcionRol = $('#descripcion-rol').val().trim().toUpperCase();

        // Validar los campos antes de proceder
        if (nombreRol === '') {
            Swal.fire({
                icon: 'warning',
                title: 'Campo obligatorio',
                text: 'El nombre del rol es obligatorio.',
                confirmButtonText: 'Aceptar'
            });
            return;
        }

        if (descripcionRol === '') {
            Swal.fire({
                icon: 'warning',
                title: 'Campo obligatorio',
                text: 'La descripción del rol es obligatoria.',
                confirmButtonText: 'Aceptar'
            });
            return;
        }



        // Si todas las validaciones pasan, enviar la solicitud AJAX
        $.ajax({
            type: 'POST',
            url: '{% url "crear_rol_empleado" %}',  // Asegúrate de que esta URL esté definida en tus URLs de Django
            data: {
                'nombre-rol': nombreRol,
                'descripcion-rol': descripcionRol,
                'csrfmiddlewaretoken': '{{ csrf_token }}' // Token CSRF para seguridad
            },
            success: function (response) {
                if (response.status === 'success') {
                    // Cerrar el modal
                    $('#modalCrearRol').modal('hide');

                    // Añadir el nuevo rol al select como la primera opción
                    const newOption = new Option(nombreRol, response.id, true, true); // Mostrar el nombre, pero usar el ID como valor
                    $('#rol-empleado').prepend(newOption);
                    $('#rol-empleado').val(response.id).trigger('change'); // Seleccionar la nueva opción

                    // Limpiar el formulario del modal
                    $('#nombre-rol').val('');
                    $('#descripcion-rol').val('');
                } else {
                    console.error('Error en la respuesta del servidor:', response.error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Error al crear el rol. Por favor, inténtelo nuevamente.',
                        confirmButtonText: 'Aceptar'
                    });
                }
            },
            error: function (response) {
                console.error('Error al enviar la solicitud:', response); // Verificar el error
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Error al enviar la solicitud. Por favor, inténtelo nuevamente.',
                    confirmButtonText: 'Aceptar'
                });
            }
        });
    });


    $(document).ready(function () {
        let creadoPorElem = $('#creado-por');
        let creadoPor = creadoPorElem.length ? creadoPorElem.val() : null;
        var tableCurriculum1;
        function initializeTableCurriculum(idEmpleado) {

            // Destruir la tabla existente si existe
            if ($.fn.DataTable.isDataTable('#curriculum-table')) {
                $('#curriculum-table').DataTable().clear().destroy();
            }

            // Inicializar la tabla de currículum
            tableCurriculum1 = $('#curriculum-table').DataTable({
                autoWidth: true,  // Permitir que DataTables ajuste el ancho automáticamente
                scrollX: false,
                pageLength: 50,
                dom: 'Bfrtip',
                language: {
                    "processing": "Procesando...",
                    "lengthMenu": "Mostrar _MENU_ registros",
                    "zeroRecords": "No se encontraron resultados",
                    "emptyTable": "Ningún dato disponible en esta tabla",
                    "info": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                    "infoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                    "infoFiltered": "(filtrado de un total de _MAX_ registros)",
                    "search": "Buscar:",
                    "infoThousands": ",",
                    "loadingRecords": "Cargando...",
                    "paginate": {
                        "first": "Primero",
                        "last": "Último",
                        "next": "Siguiente",
                        "previous": "Anterior"
                    },
                    "aria": {
                        "sortAscending": ": Activar para ordenar la columna de manera ascendente",
                        "sortDescending": ": Activar para ordenar la columna de manera descendente"
                    },
                    "buttons": {
                        "copy": "Copiar",
                        "colvis": "Visibilidad"
                    }
                },
                ajax: {
                    beforeSend: function (xhr, type) {
                        if (!type.crossDomain) {
                            xhr.setRequestHeader(
                                'X-CSRF-Token',
                                $('meta[name="csrf-token"]').attr('content')
                            );
                        }
                    },
                    url: "{% url 'obtener_curriculums_por_empleado' %}",
                    type: "GET",
                    data: function (d) {
                        d.id_empleado = idEmpleado;  // Asegúrate de pasar el ID correcto aquí
                        console.log('Datos enviados en la solicitud AJAX:', d);
                    },
                    dataSrc: function (json) {
                        console.log('Datos recibidos de la solicitud AJAX:', json);
                        return json.curriculums || [];
                    },
                    error: function (xhr, error, thrown) {
                        console.error('Error en la solicitud AJAX:', error);
                        console.log('Detalles del error AJAX:', xhr.responseText);
                    }
                },
                colReorder: {
                    realtime: false,
                },
                buttons: [{
                    extend: 'excel',
                    text: '<i class="fas fa-file-excel"></i>',
                    titleAttr: 'Excel',
                    className: 'btn btn-success',
                },
                {
                    extend: 'pdf',
                    text: '<i class="fas fa-file-pdf"></i>',
                    titleAttr: 'PDF',
                    className: 'btn btn-danger',
                },
                {
                    extend: 'print',
                    text: '<i class="fas fa-print"></i>',
                    titleAttr: 'Imprimir',
                    className: 'btn btn-primary',
                    orientation: 'landscape'
                }],
                columns: [
                    { "data": "titulo", "width": "20%" },  // Ancho definido
                    { "data": "tipo_curriculum", "width": "15%" },
                    { "data": "descripcion", "width": "30%" },
                    { "data": "fecha_inicio", "width": "15%" },
                    { "data": "fecha_final", "width": "15%" }
                ],
                order: [[0, "asc"]]
            });
        }

        let idEmpleado = $('#id-empleado').val() || $('#edit-id-empleado').val();

        if (idEmpleado) {
            initializeTableCurriculum(idEmpleado);
        } else {
            $('#curriculum-container').html('<p>No hay un empleado seleccionado. Por favor, seleccione un empleado para ver los currículums.</p>');
        }

        $('#formCrearCurriculum').on('submit', function (event) {
            event.preventDefault();

            let idEmpleado = $('#id-empleado').val() || $('#edit-id-empleado').val();
            let titulo = $('#titulo-curriculum').val().toUpperCase();
            let tipoCurriculum = $('#nuevo-tipo-curriculum').val();
            let fechaInicio = $('#fecha-inicio-curriculum').val();
            let fechaFinal = $('#fecha-fin-curriculum').val();
            let descripcion = $('#descripcion-curriculum').val();
            let estadoCurriculum = $('#nuevo-estado-curriculum').val();

            // Variable para acumular los errores
            let errorMessage = '';

            // Verificar cada campo y agregar un mensaje de error si está vacío
            if (!idEmpleado) {
                errorMessage += 'El campo de empleado es obligatorio, por favor ingrese un DNI válido.\n';
            }
            if (!titulo) {
                errorMessage += 'El campo de título del currículum está vacío.\n';
            }
            if (!tipoCurriculum) {
                errorMessage += 'El campo de tipo de currículum está vacío.\n';
            }
            if (!fechaInicio) {
                errorMessage += 'El campo de fecha de inicio está vacío.\n';
            }
            if (!estadoCurriculum) {
                errorMessage += 'El campo de estado del currículum está vacío.\n';
            }
            if (!creadoPor) {
                errorMessage += 'Su sesión ha sido cerrada. Inicie sesión nuevamente para continuar.\n';
            }

            // Si hay errores, mostramos los mensajes acumulados y detenemos el envío
            if (errorMessage) {
                console.error('Campos vacíos:', {
                    id_empleado: idEmpleado,
                    titulo: titulo,
                    tipo_curriculum: tipoCurriculum,
                    fecha_inicio: fechaInicio,
                    fecha_final: fechaFinal,
                    descripcion: descripcion,
                    creado_por: creadoPor,
                    estado_curriculum: estadoCurriculum
                });

                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: errorMessage.replace(/\n/g, ' '),  // Mostrar los errores en una sola línea
                });
                return;  // Detener el envío del formulario
            }

            // Si no hay errores, proceder con la solicitud AJAX
            let csrfToken = $('input[name="csrfmiddlewaretoken"]').val();


            $.ajax({
                url: "{% url 'guardar_curriculum_empleado' %}",
                type: 'POST',
                data: {
                    id_empleado: idEmpleado,
                    titulo: titulo,
                    tipo_curriculum: tipoCurriculum,
                    fecha_inicio: fechaInicio,
                    fecha_final: fechaFinal ? fechaFinal : null,  // Enviar null si está vacío
                    descripcion: descripcion ? descripcion : null,  // Enviar null si está vacío
                    creado_por: creadoPor,
                    estado_curriculum: estadoCurriculum,
                    csrfmiddlewaretoken: csrfToken
                },
                success: function (data) {
                    $('#modalNuevoCurriculo').modal('hide');
                    if ($.fn.DataTable.isDataTable('#curriculum-table')) {
                        tableCurriculum1.ajax.reload(null, false);
                    } else {
                        initializeTableCurriculum(idEmpleado);
                    }

                    // Limpiar el formulario y los select2 después de un envío exitoso
                    $('#formCrearCurriculum')[0].reset();  // Limpiar el formulario
                    $('#nuevo-tipo-curriculum').val('').trigger('change');  // Limpiar el campo select2 de tipo de currículum
                    $('#nuevo-estado-curriculum').val('').trigger('change');  // Limpiar el campo select2 de estado de currículum
                },
                error: function (xhr, status, error) {
                    console.error('Error en la solicitud AJAX:', error);
                }
            });
        });
    });

    /* $(document).on('click', '.btn-editar-asociacion', function () {
        var asociacionRow = $(this).closest('tr'); // Obtiene la fila más cercana
 
        // Extrae los datos de la fila
        var idAsociacion = asociacionRow.find('td').eq(0).text(); // Asumiendo que el ID de la asociación está en la primera columna
        var descripcionAsociacion = $(this).data('id-asociacion'); // Obtiene el ID de la asociación desde el atributo data
 
        // Asignar valores al formulario en el modal
        $('#nuevo-descripcion-asociacion').val(descripcionAsociacion).trigger('change'); // Establece el ID de la asociación en el select
 
        // Mostrar el modal
        $('#modalAsociaciones').modal('show');
    });
 */

    //crear asociones
    $(document).ready(function () {
        var buttons = "Bfrtlip";
        let creadoPorElem = $('#creado-por');
        let creadoPor = creadoPorElem.length ? creadoPorElem.val() : null;
        var tableAsociaciones;

        function initializeTableAsociaciones(idEmpleado) {

            // Destruir la tabla existente si existe
            if ($.fn.DataTable.isDataTable('#asociaciones-table')) {
                $('#asociaciones-table').DataTable().clear().destroy();
            }

            // Inicializar la tabla de asociaciones
            tableAsociaciones = $('#asociaciones-table').DataTable({
                autoWidth: true,  // Permitir que DataTables ajuste el ancho automáticamente
                scrollX: false,
                pageLength: 50,
                dom: 'Bfrtip',
                language: {
                    "processing": "Procesando...",
                    "lengthMenu": "Mostrar _MENU_ registros",
                    "zeroRecords": "No se encontraron resultados",
                    "emptyTable": "Ningún dato disponible en esta tabla",
                    "info": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                    "infoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                    "infoFiltered": "(filtrado de un total de _MAX_ registros)",
                    "search": "Buscar:",
                    "infoThousands": ",",
                    "loadingRecords": "Cargando...",
                    "paginate": {
                        "first": "Primero",
                        "last": "Último",
                        "next": "Siguiente",
                        "previous": "Anterior"
                    },
                    "aria": {
                        "sortAscending": ": Activar para ordenar la columna de manera ascendente",
                        "sortDescending": ": Activar para ordenar la columna de manera descendente"
                    },
                    "buttons": {
                        "copy": "Copiar",
                        "colvis": "Visibilidad"
                    }
                },
                ajax: {
                    beforeSend: function (xhr, type) {
                        if (!type.crossDomain) {
                            xhr.setRequestHeader(
                                'X-CSRF-Token',
                                $('meta[name="csrf-token"]').attr('content')
                            );
                        }
                    },
                    url: "{% url 'obtener_asociaciones' %}", // La URL se configura aquí
                    type: "GET",
                    data: function (d) {
                        d.id_empleado = idEmpleado;  // Pasar id_empleado como parámetro GET
                    },
                    dataSrc: function (json) {

                        // Verificar si hubo un error en la respuesta
                        if (json.status && json.status === 'error') {
                            console.error('Error al obtener las asociaciones:', json.message);
                            Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: json.message || 'Error al obtener las asociaciones.',
                            });
                            return [];  // Devolver una tabla vacía en caso de error
                        }

                        return json.data || [];
                    },
                    error: function (xhr, status, error) {
                        console.error('Error en la solicitud AJAX:', error);
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Ocurrió un error al cargar las asociaciones.',
                        });
                    }
                },
                colReorder: {
                    realtime: false,
                },
                buttons: [{
                    extend: 'excel',
                    text: '<i class="fas fa-file-excel"></i>',
                    titleAttr: 'Excel',
                    className: 'btn btn-success',
                },
                {
                    extend: 'pdf',
                    text: '<i class="fas fa-file-pdf"></i>',
                    titleAttr: 'PDF',
                    className: 'btn btn-danger',
                },
                {
                    extend: 'print',
                    text: '<i class="fas fa-print"></i>',
                    titleAttr: 'Imprimir',
                    className: 'btn btn-primary',
                    orientation: 'landscape'
                }],
                columns: [
                    { "data": "id_asociacion" },
                    { "data": "nombre_asociacion" }
                ],
                order: [[0, "asc"]]
            });
        }

        $('#asociaciones-table').css('width', '100%');
        let idEmpleado = $('#id-empleado').val() || $('#edit-id-empleado').val();
        if (idEmpleado) {
            initializeTableAsociaciones(idEmpleado);
        } else {
            $('#table-container').html('<p>No hay un empleado seleccionado. Por favor, seleccione un empleado para ver las asociaciones.</p>');
        }

        $('#formCrearAsociaciones').on('submit', function (event) {
            event.preventDefault();

            let idEmpleado = $('#id-empleado').val() || $('#edit-id-empleado').val();
            let descripcionAsociacion = $('#nuevo-descripcion-asociacion').val().toUpperCase();
            let creadoPor = '{{userName}}';  // Asegurarse de capturar este campo

            // Validación de campos vacíos
            let errorMessage = '';

            if (!idEmpleado) {
                errorMessage += 'El campo de empleado es obligatorio, por favor ingrese un DNI válido.\n';
            }
            if (!creadoPor) {
                errorMessage += 'Su sesión ha expirado. Por favor, inicie sesión nuevamente para continuar.\n';
            }
            if (!descripcionAsociacion) {
                errorMessage += 'El campo de descripción de la asociación está vacío.\n';
            }

            // Si hay errores, mostramos el mensaje y detenemos el envío
            if (errorMessage) {
                console.error('Campos vacíos:', {
                    id_empleado: idEmpleado,
                    descripcion_asociacion: descripcionAsociacion,
                    creado_por: creadoPor
                });

                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: errorMessage.replace(/\n/g, ' '),  // Mostrar todos los errores en una línea
                });
                return;  // Detener el envío del formulario
            }

            // Si no hay errores, proceder con la solicitud AJAX
            let csrfToken = $('input[name="csrfmiddlewaretoken"]').val();

            $.ajax({
                url: "{% url 'insertar_asociaciones_empleados' %}",
                type: 'POST',
                data: {
                    id_empleado: idEmpleado,
                    descripcion_asociacion: descripcionAsociacion,
                    creado_por: creadoPor,
                    csrfmiddlewaretoken: csrfToken
                },
                success: function (data) {
                    console.log('Respuesta del servidor al crear asociación:', data);

                    $('#modalAsociaciones').modal('hide');
                    if ($.fn.DataTable.isDataTable('#asociaciones-table')) {
                        tableAsociaciones.ajax.reload();  // Recargar la tabla si está inicializada
                    } else {
                        initializeTableAsociaciones(idEmpleado);  // Inicializar la tabla si no lo estaba
                    }

                    // Limpiar el formulario después de enviar los datos
                    $('#formCrearAsociaciones')[0].reset();
                    $('#nuevo-descripcion-asociacion').val('').trigger('change');  // Limpiar el campo select2 si aplica
                },
                error: function (xhr, status, error) {
                    console.error('Error en la solicitud AJAX:', error);
                }
            });
        });


        // Función para asignar el equipo al empleado
        function asignarEquipoAEmpleado(idEmpleado, idEquipo, csrfToken) {
            $.ajax({
                url: "{% url 'crear_Equipo' %}",
                type: 'POST',
                data: {
                    id_empleado: idEmpleado,
                    id_equipo: idEquipo,  // Usar el ID del equipo recién creado
                    csrfmiddlewaretoken: csrfToken
                },
                success: function (response) {
                    if (response.status === 'success') {
                        $('#modalEquipo').modal('hide');
                        if ($.fn.DataTable.isDataTable('#equipo-asignado-table')) {
                            $('#equipo-asignado-table').DataTable().ajax.reload(null, false);
                        } else {
                            initializeTableEquipo(idEmpleado);
                        }
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Error al asignar equipo: ' + response.error,
                        });
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error en la solicitud AJAX:', error);
                }
            });
        }


        $('#formCrearAsociacion').on('submit', function (event) {
            event.preventDefault(); // Evitar el envío normal del formulario

            // Obtener los valores de los campos del formulario
            let descripcionAsociacion = $('#nombre-asociacion').val().trim(); // Limpiar espacios en blanco

            // Validar que el campo no esté vacío
            if (!descripcionAsociacion) {
                Swal.fire({
                    icon: 'error',
                    title: 'Campo requerido',
                    text: 'El campo "Nombre de la Asociación" es obligatorio.',
                    confirmButtonText: 'Aceptar'
                });
                return; // Detener el envío si el campo está vacío
            }

            // Convertir el nombre de la asociación a mayúsculas
            descripcionAsociacion = descripcionAsociacion.toUpperCase();

            // Si el campo es válido, proceder con la solicitud AJAX
            $.ajax({
                type: 'POST',
                url: '{% url "insertar_asociacion" %}',  // URL de la vista Django que maneja la solicitud
                data: {
                    'nombre_asociacion': descripcionAsociacion,
                    'creado_por': '{{userName}}',
                    'csrfmiddlewaretoken': '{{ csrf_token }}' // Token CSRF para seguridad
                },
                success: function (response) {
                    if (response.status === 'success') {
                        // Cerrar el modal si la respuesta es exitosa
                        $('#modalCrearAsociacion').modal('hide');
                        $('#modalAsociaciones').modal('show');

                        // Añadir la nueva asociación al select como la primera opción
                        const newOption = new Option(descripcionAsociacion, response.id, true, true); // Mostrar el nombre, pero usar el ID como valor
                        $('#nuevo-descripcion-asociacion').prepend(newOption);
                        $('#nuevo-descripcion-asociacion').val(response.id).trigger('change'); // Seleccionar la nueva opción

                        // Verificación adicional para asegurarse de que el ID es numérico
                        console.log('ID que se está enviando:', $('#nuevo-descripcion-asociacion').val());

                        // Limpiar el formulario
                        $('#nombre-asociacion').val('');

                    } else {
                        console.error('Error en la respuesta del servidor:', response.error);
                        alert('Error al crear la asociación. Por favor, inténtelo nuevamente.');
                    }
                },
                error: function (response) {
                    console.error('Error al enviar la solicitud:', response); // Verificar el error
                    alert('Error al enviar la solicitud. Por favor, inténtelo nuevamente.');
                }
            });
        });

        $('#formCrearCatalogoEnfermedadesBase').on('submit', function (event) {
            event.preventDefault(); // Evitar el envío normal del formulario

            // Obtener los valores del formulario
            let nombreEnfermedad = $('#nombre_enfermedad_base').val().trim().toUpperCase(); // Limpiar y convertir a mayúsculas
            let descripcionEnfermedad = $('#descripcion_enfermedad_base').val().trim().toUpperCase(); // Limpiar y convertir a mayúsculas
            const creadoPor = '{{userName}}';

            let isValid = true;

            // Validación de campos vacíos
            if (!nombreEnfermedad) {
                Swal.fire({
                    icon: 'error',
                    title: 'Campo requerido',
                    text: 'El campo "Nombre de la Enfermedad" es obligatorio.',
                    confirmButtonText: 'Aceptar'
                });
                isValid = false;
            }

            // Detener si algún campo es inválido
            if (!isValid) {
                return;
            }

            // Enviar la solicitud AJAX si todo es válido
            $.ajax({
                type: 'POST',
                url: '{% url "insertar_enfermedad_base" %}',  // Asegúrate de que esta URL esté definida en tus URLs de Django
                data: {
                    'nombre_enfermedad': nombreEnfermedad,
                    'descripcion': descripcionEnfermedad,
                    'creado_por': creadoPor, // Incluir el campo creado_por
                    'csrfmiddlewaretoken': '{{ csrf_token }}' // Token CSRF para seguridad
                },
                success: function (response) {
                    if (response.status === 'success') {
                        // Cerrar el modal actual y abrir otro si es necesario
                        $('#modalCrearCatalogoEnfermedadesBase').modal('hide');
                        $('#modalCrearEnfermedadesBase').modal('show');

                        // Añadir la nueva enfermedad al select como la primera opción
                        const newOption = new Option(nombreEnfermedad, response.id, true, true); // Mostrar el nombre, pero usar el ID como valor
                        $('#enfermedad-base').prepend(newOption);
                        $('#enfermedad-base').val(response.id).trigger('change'); // Seleccionar la nueva opción

                        // Verificación adicional para asegurarse de que el ID es numérico
                        console.log('ID que se está enviando:', $('#enfermedad-base').val());

                        // Limpiar el formulario del modal
                        $('#nombre_enfermedad_base').val('');
                        $('#descripcion_enfermedad_base').val('');

                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Error al crear la enfermedad. ' + response.error,
                            confirmButtonText: 'Aceptar'
                        });
                    }
                },
                error: function (response) {
                    console.error('Error al enviar la solicitud:', response); // Verificar el error
                    Swal.fire({
                        icon: 'error',
                        title: 'Error en la solicitud',
                        text: 'No se pudo crear la enfermedad. Revise su conexión e intente de nuevo.',
                        confirmButtonText: 'Aceptar'
                    });
                }
            });
        });


        // Variable para guardar el select que activó la acción
        let triggeredBy = '';

        $('#nombre-seguro').on('select2:select', function () {
            triggeredBy = 'nombre-seguro';
        });

        $('#nuevo-nombre-empresa-poliza').on('select2:select', function () {
            triggeredBy = 'nuevo-nombre-empresa-poliza';
        });

        $('#formCrearEmpresaSeguro').on('submit', function (event) {
            event.preventDefault();

            // Obtener los valores del formulario
            let nombreEmpresaSeguro = $('#nombre-empresa-seguros').val().trim().toUpperCase();
            let descripcionEmpresaSeguro = $('#descripcion-empresa-seguros').val().trim().toUpperCase();

            // Validación de los campos
            if (nombreEmpresaSeguro === '') {
                Swal.fire({
                    icon: 'warning',
                    title: 'Campo obligatorio',
                    text: 'El nombre de la empresa de seguros es obligatorio.',
                    confirmButtonText: 'Aceptar'
                });
                return;  // Detener la ejecución si el campo está vacío
            }

            // Si las validaciones son correctas, proceder con la solicitud AJAX
            $.ajax({
                type: 'POST',
                url: '{% url "insertar_empresa_seguros" %}',  // Asegúrate de que esta URL esté definida en tus URLs de Django
                data: {
                    'empresa': nombreEmpresaSeguro,
                    'descripcion': descripcionEmpresaSeguro,
                    'creado_por': '{{userName}}',
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                beforeSend: function () {
                    console.log('Iniciando solicitud AJAX para insertar empresa de seguros...');  // Log antes de enviar la solicitud
                },
                success: function (response) {
                    console.log('Respuesta del servidor:', response);  // Log de la respuesta del servidor

                    if (response.status === 'success') {


                        // Cerrar el modal de creación de empresa de seguros
                        $('#modalCrearEmpresaSeguro').modal('hide');

                        // Determinar cuál modal mostrar basado en el select que activó el evento
                        if (triggeredBy === 'nombre-seguro') {
                            $('#nuevoSeguroModal').modal('show');  // Mostrar el modal para nuevo seguro
                        } else if (triggeredBy === 'nuevo-nombre-empresa-poliza') {
                            $('#modalCrearPolizaSeguro').modal('show');  // Mostrar el modal para crear nueva poliza
                        }

                        // Añadir la nueva empresa de seguros al select #nombre-seguro
                        const newOption = new Option(nombreEmpresaSeguro, response.id, true, true); // Mostrar el nombre y usar el ID como valor
                        $('#nombre-seguro').prepend(newOption);
                        $('#nombre-seguro').val(response.id).trigger('change');  // Seleccionar la nueva opción y disparar el cambio

                        // Limpiar el formulario del modal y el select2
                        $('#formCrearEmpresaSeguro')[0].reset();  // Limpiar el formulario
                        $('#nombre-empresa-seguros').val('').trigger('change');  // Limpiar el campo select2
                        $('#descripcion-empresa-seguros').val('').trigger('change');  // Limpiar el campo select2

                        // Restablecer la variable triggeredBy
                        triggeredBy = '';
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Hubo un problema al crear la empresa de seguros. ' + response.message,
                            confirmButtonText: 'Aceptar'
                        });
                    }
                },
                error: function (response) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error en la solicitud',
                        text: 'Error al enviar la solicitud. Por favor, inténtelo nuevamente.',
                        confirmButtonText: 'Aceptar'
                    });
                    console.error('Error al crear la empresa de seguros:', response);  // Log en caso de error en la solicitud
                },
                complete: function () {
                    console.log('Solicitud AJAX completada.');  // Log al finalizar la solicitud
                }
            });
        });


        $('#formCrearParentesco').on('submit', function (event) {
            event.preventDefault(); // Prevenir el envío normal del formulario

            // Obtener los valores del formulario
            let descripcionParentesco = $('#nombre-parentesco').val().trim().toUpperCase(); // Limpiar y convertir a mayúsculas
            const creadoPor = '{{userName}}'; // Usuario que está creando el parentesco

            // Validar que el campo no esté vacío
            if (!descripcionParentesco) {
                Swal.fire({
                    icon: 'error',
                    title: 'Campo requerido',
                    text: 'El campo "Nombre del Parentesco" es obligatorio.',
                    confirmButtonText: 'Aceptar'
                });
                return; // Detener el envío si el campo está vacío
            }

            // Si el campo es válido, proceder con la solicitud AJAX
            $.ajax({
                type: 'POST',
                url: '{% url "insertar_parentesco" %}',  // URL de la vista Django que maneja la solicitud
                data: {
                    'parentesco': descripcionParentesco,
                    'creado_por': creadoPor,
                    'csrfmiddlewaretoken': '{{ csrf_token }}' // Token CSRF para seguridad
                },
                success: function (response) {
                    console.log('Respuesta del servidor:', response);
                    if (response.success === true) {  // Verifica el campo "success" en la respuesta
                        // Cerrar el modal
                        $('#modalCrearPrentesco').modal('hide');
                        $('#modalFamiliares').modal('show');

                        // Añadir el nuevo parentesco al select "nuevo-parentesco-contacto"
                        const newOptionContact = new Option(descripcionParentesco, response.id_parentesco); // Usar el ID como valor
                        $('#nuevo-parentesco-contacto').prepend(newOptionContact);
                        $('#nuevo-parentesco-contacto').val(response.id_parentesco).trigger('change'); // Seleccionar la nueva opción

                        // Añadir el nuevo parentesco al select "nuevo-parentesco-familiar"
                        const newOptionFamiliar = new Option(descripcionParentesco, response.id_parentesco); // Usar el ID como valor
                        $('#nuevo-parentesco-familiar').prepend(newOptionFamiliar);
                        $('#nuevo-parentesco-familiar').val(response.id_parentesco).trigger('change'); // Seleccionar la nueva opción

                        // Limpiar el formulario del modal
                        $('#nombre-parentesco').val('');
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Error al crear el parentesco. Por favor, inténtelo nuevamente.',
                            confirmButtonText: 'Aceptar'
                        });
                        console.error('Error en la respuesta del servidor:', response.message);
                    }
                },
                error: function (response) {
                    console.error('Error al crear el parentesco', response);
                    Swal.fire({
                        icon: 'error',
                        title: 'Error en la solicitud',
                        text: 'No se pudo crear el parentesco. Revise su conexión e intente de nuevo.',
                        confirmButtonText: 'Aceptar'
                    });
                }
            });
        });

        $('#modalCrearPolizaSeguro').on('hidden.bs.modal', function () {
            // Abrir el modal nuevoSeguroModal cuando se cierre el modalCrearEmpresaSeguro
            $('#nuevoSeguroModal').modal('show');
        });
        $('#formCrearPolizaSeguro').on('submit', function (event) {
            event.preventDefault();

            // Obtener los valores del formulario
            let nombrePolizaSeguros = $('#nombre-poliza-seguros').val().toUpperCase();
            let descripcionPolizaSeguros = $('#descripcion-poliza-seguros').val().toUpperCase();
            let empresaPolizaSeguros = $('#nombre-seguro').val();  // El ID de la empresa seleccionada
            const creadoPor = '{{userName}}';

            // Variable para acumular los errores
            let errorMessage = '';

            // Verificar cada campo y agregar un mensaje de error si está vacío
            if (!nombrePolizaSeguros) {
                errorMessage += 'El campo de nombre de la póliza es obligatorio.\n';
            }

            if (!empresaPolizaSeguros) {
                errorMessage += 'Debe seleccionar una empresa de seguros.\n';
            }
            if (!creadoPor) {
                errorMessage += 'Su sesión ha sido cerrada. Inicie sesión nuevamente para continuar.\n';
            }

            // Si hay errores, mostramos los mensajes acumulados y detenemos el envío
            if (errorMessage) {
                console.error('Campos vacíos:', {
                    nombre_poliza: nombrePolizaSeguros,
                    descripcion_poliza: descripcionPolizaSeguros,
                    id_empresa: empresaPolizaSeguros,
                    creado_por: creadoPor
                });

                Swal.fire({
                    icon: 'error',
                    title: 'Error en el formulario',
                    text: errorMessage.replace(/\n/g, ' '),  // Mostrar los errores en una sola línea
                });

                return;  // Detener el envío del formulario
            }

            $.ajax({
                type: 'POST',
                url: '{% url "insertar_poliza_seguro" %}',  // Asegúrate de que esta URL esté definida correctamente en tus URLs de Django
                data: {
                    'nombre_poliza_seguros': nombrePolizaSeguros,
                    'descripcion_poliza_seguros': descripcionPolizaSeguros,
                    'id_empresa_seguros': empresaPolizaSeguros,
                    'creado_por': creadoPor,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'  // Token CSRF para seguridad
                },
                success: function (response) {
                    console.log('Respuesta del servidor:', response);
                    if (response.success === true) {  // Verifica el campo "success" en la respuesta
                        // Cerrar el modal de creación de póliza
                        $('#modalCrearPolizaSeguro').modal('hide');
                        $('#nuevoSeguroModal').modal('show');

                        // Añadir la nueva póliza al select "poliza"
                        const newOption = new Option(nombrePolizaSeguros, response.id, true, true);  // Mostrar el nombre, pero usar el ID como valor
                        $('#poliza').prepend(newOption);
                        $('#poliza').val(response.id).trigger('change');  // Seleccionar la nueva opción y disparar el cambio

                        // Limpiar el formulario del modal
                        $('#nombre-poliza-seguros').val('');
                        $('#descripcion-poliza-seguros').val('');
                        $('#nuevo-nombre-empresa-poliza').val('').trigger('change');  // Limpiar el campo select2 si aplica
                    } else {
                        console.error('Error en la respuesta del servidor:', response.message);
                    }
                },
                error: function (response) {
                    console.error('Error al crear la póliza de seguro:', response);
                }
            });
        });

    });


    //crear Departamentos
    $(document).ready(function () {



        /* $('#residencia').on('change', function () {
            let idPais = $(this).val();  // Obtener el ID del país seleccionado
            let departamentoSelect = $('#departamento_pais');  // Select donde se mostrarán los departamentos
 
            console.log('País seleccionado:', idPais); // Debug: Verifica qué país ha sido seleccionado
 
            // Limpiar el select de departamentos
            departamentoSelect.html('<option value="">Seleccione un departamento</option><option value="new-departamento-pais">Crear nuevo Departamento</option>');
 
            if (idPais) {
                $.ajax({
                    url: "{% url 'obtener_departamentos_por_pais' %}", // Asegúrate de que esta URL coincida con la definida en urls.py
                    type: 'POST',
                    data: JSON.stringify({ 'id_pais': idPais }),
                    contentType: 'application/json',
                    headers: {
                        'X-CSRFToken': $('input[name="csrfmiddlewaretoken"]').val()
                    },
                    beforeSend: function () {
                        console.log('Iniciando solicitud AJAX para obtener departamentos...'); // Debug: Indica que la solicitud AJAX está a punto de enviarse
                    },
                    success: function (data) {
                        console.log('Datos recibidos:', data); // Debug: Muestra los datos recibidos desde el servidor
 
                        if (data.status === 'success') {
                            $.each(data.departamentos, function (index, departamento) {  // Asegúrate de que 'departamentos' sea la clave correcta
                                departamentoSelect.append($('<option>', {
                                    value: departamento.id_departamento,
                                    text: departamento.nombre_departamento
                                }));
                            });
                            console.log('Departamentos actualizados correctamente.'); // Debug: Confirma que los departamentos han sido actualizados en el select
                        } else {
                            console.error('Error en la respuesta del servidor:', data.error); // Debug: Muestra el error devuelto por el servidor si el estado no es 'success'
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error('Error durante la solicitud AJAX:', xhr.status, status, error); // Debug: Muestra detalles de cualquier error que ocurra durante la solicitud
                    },
                    complete: function () {
                        console.log('Solicitud AJAX completada.'); // Debug: Indica que la solicitud AJAX ha terminado (ya sea con éxito o con error)
                    }
                });
            } else {
                console.log('No se ha seleccionado ningún país.'); // Debug: Indica que no se seleccionó un país válido
            }
        });
 
 */


        $('#formCrearUsuarios').on('submit', function (event) {
            event.preventDefault();
            const nombre = document.getElementById('nombre').value;
            const usuario = document.getElementById('nuevo-usuario').value;
            const contrasena = document.getElementById('contrasena').value;

            $.ajax({
                url: "{% url 'guardar_usuario' %}",
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    nombre: nombre,
                    usuario: usuario,
                    contrasena: contrasena
                }),
                success: function (response) {
                    if (response.status === 'success') {

                        $('#modalCrearUsuario').modal('hide');

                        // Añadir la nueva área al select como la primera opción 
                        const newOption = new Option(nombre, nombre);
                        $('#usuario').prepend(newOption);
                        $('#usuario').val(nombre); // Seleccionar la nueva opción 

                        // Limpiar el formulario del modal 
                        $('#nombre').val('');
                        $('#nuevo-usuario').val('');
                        $('#contrasena').val('');
                    } else {
                        console.error('Error:', response.error); // Mostrar el error en la consola del navegador
                        alert("Error al crear el usuario: " + response.error);
                    }
                },
                error: function (response) {
                    console.error('Error en la solicitud:', response.responseText); // Mostrar el error en la consola del navegador
                    alert("Error en la solicitud: " + response.responseText);
                }
            });
        });

        $('#departamento_pais').on('change', function () {
            var selectedValue = $(this).val();
            console.log('Select changed:', selectedValue); // Verificar el valor seleccionado
            if (selectedValue === 'new-departamento-pais') {
                console.log('Opening modal for new departamento pais'); // Verificar la condición
                $('#modalCrearDepartamentoPais').modal('show'); // Mostrar el modal
                $(this).val(''); // Restablecer el valor del select
            }
        });


        $('#ccurriculo').on('change', function () {
            var selectedValue = $(this).val();
            if (selectedValue === 'new-curriculo') { // Cambiado a 'new-cargo'
                $('#modalNuevoCurriculo').modal('show'); // Mostrar el modal
                $(this).val(''); // Restablecer el valor del select
            }
        });

        $('#formCrearCargos').on('submit', function (event) {
            event.preventDefault();

            // Obtener los valores del formulario
            let nombreCargo = $('#nuevo-cargo').val().trim();
            const creadoPor = '{{userName}}';
            const idArea = $('#areas-empresa').val();
            const respuestaGrado = $('#nuevo_nombre_grado').val();
            let isValid = true;
            let grado = '';

            // Validación de grado según el valor
            if (respuestaGrado === '1') {
                grado = 'A';
            } else if (respuestaGrado === '2') {
                grado = 'B';
            } else if (respuestaGrado === '3') {
                grado = 'C';
            } else if (respuestaGrado === '4') {
                grado = 'D';
            }

            // Validaciones
            if (!nombreCargo) {
                Swal.fire({
                    icon: 'error',
                    title: 'Campo requerido',
                    text: 'El campo "Nombre del Cargo" es obligatorio.',
                    confirmButtonText: 'Aceptar'
                });
                isValid = false;
            }

            if (!creadoPor) {
                Swal.fire({
                    icon: 'error',
                    title: 'Sesión caducada',
                    text: 'Su sesión ha caducado. Por favor, vuelva a iniciar sesión.',
                    confirmButtonText: 'Aceptar'
                });
                isValid = false;
            }

            if (!idArea) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Área requerida',
                    text: 'Debe seleccionar un área.',
                    confirmButtonText: 'Aceptar'
                });
                isValid = false;
            }

            if (!grado) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Grado requerido',
                    text: 'Debe seleccionar un grado válido.',
                    confirmButtonText: 'Aceptar'
                });
                isValid = false;
            }

            // Si hay algún campo inválido, detener la ejecución
            if (!isValid) {
                return;
            }

            // Convertir el nombre del cargo a mayúsculas antes de enviarlo
            nombreCargo = nombreCargo.toUpperCase();

            // Envío del formulario mediante AJAX
            $.ajax({
                type: 'POST',
                url: '{% url "crear_cargo" %}',  // Asegúrate de que esta URL esté definida en tus URLs de Django
                data: {
                    'nombre': nombreCargo,
                    'grado': grado,
                    'id_area': idArea,
                    'creado_por': creadoPor,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function (response) {
                    if (response.status === 'success') {
                        // Cerrar el modal
                        $('#modalCrearCargo').modal('hide');

                        // Añadir el nuevo cargo al select con el ID del cargo recién creado
                        const newOption = new Option(nombreCargo, response.id, true, true);
                        $('#cargos-empresa').prepend(newOption);
                        $('#cargos-empresa').val(response.id).trigger('change'); // Seleccionar la nueva opción
                        // Limpiar el formulario del modal
                        $('#nuevo-cargo').val('');
                        $('#nuevo_nombre_grado').val('');
                    } else if (response.error && response.error.includes('El cargo ya existe para esta área')) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Cargo duplicado',
                            text: 'El cargo ya existe para esta área. Intente con otro nombre.',
                            confirmButtonText: 'Aceptar'
                        });
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error inesperado',
                            text: 'Hubo un problema al crear el cargo. Intente nuevamente.',
                            confirmButtonText: 'Aceptar'
                        });
                    }
                },
                error: function (response) {
                    // Identifica si el error es un 400 (mala solicitud)
                    if (response.status === 400 && response.responseJSON && response.responseJSON.error.includes('El cargo ya existe para esta área')) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Cargo duplicado',
                            text: 'El cargo ya existe para esta área. Intente con otro nombre.',
                            confirmButtonText: 'Aceptar'
                        });
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error inesperado',
                            text: 'No se pudo crear el cargo. Revise su conexión e intente de nuevo.',
                            confirmButtonText: 'Aceptar'
                        });
                        console.error('Error al crear el cargo:', response);
                    }
                }
            });
        });

        $('#formCrearArea').off('submit').on('submit', function (event) {
            event.preventDefault();

            let subGrupo = $('#nuevo-area').val().trim();
            let fkGrupo = $('#departamento-empresa').val();
            const creadoPor = '{{userName}}';
            let isValid = true;

            if (!fkGrupo) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Selección de Departamento Obligatoria',
                    text: 'Es obligatorio seleccionar un departamento antes de crear un área.',
                    confirmButtonText: 'Aceptar'
                });
                isValid = false;
            }

            if (!subGrupo) {
                Swal.fire({
                    icon: 'error',
                    title: 'Campo requerido',
                    text: 'El campo "Nombre del Área" es obligatorio.',
                    confirmButtonText: 'Aceptar'
                });
                isValid = false;
            }

            if (!creadoPor) {
                Swal.fire({
                    icon: 'error',
                    title: 'Sesión caducada',
                    text: 'Su sesión ha caducado. Por favor, vuelva a iniciar sesión.',
                    confirmButtonText: 'Aceptar'
                });
                isValid = false;
            }

            if (!isValid) {
                return;
            }

            subGrupo = subGrupo.toUpperCase();

            $.ajax({
                type: 'POST',
                url: '{% url "crear_area" %}',
                data: {
                    'nombre_area': subGrupo,
                    'departamento_empresa': fkGrupo,
                    'creado_por': creadoPor,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function (response) {
                    console.log(response);  // Imprimir la respuesta para ver qué llega del backend
                    if (response.status === 'success') {
                        $('#modalCrearArea').modal('hide');
                        const newOption = new Option(subGrupo, response.id);
                        $('#areas-empresa').prepend(newOption);
                        $('#areas-empresa').val(response.id).trigger('change');

                        $('#nuevo-area').val('');
                        Swal.fire({
                            icon: 'success',
                            title: 'Área creada',
                            text: 'El área ha sido creada exitosamente.',
                            confirmButtonText: 'Aceptar'
                        });
                    }
                },
                error: function (xhr, status, error) {
                    console.log(xhr.responseText);  // Imprimir el error
                    if (xhr.status === 400) {
                        let response = JSON.parse(xhr.responseText);
                        Swal.fire({
                            icon: 'error',
                            title: 'Área duplicada',
                            text: response.error,
                            confirmButtonText: 'Aceptar'
                        });
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error de conexión',
                            text: 'No se pudo crear el área. Revise su conexión e intente de nuevo.',
                            confirmButtonText: 'Aceptar'
                        });
                        console.error('Error al crear el área:', error);
                    }
                }
            });
        });


        $('#formCrearCiudad').on('submit', function (event) {
            event.preventDefault();

            // Obtener los valores del formulario
            let nombreCiudad = $('#nombre-ciudad').val();
            const creadoPor = '{{userName}}';
            const idMunicipio = $('#nuevo-nombre-municipio-ciudad').val();

            // Convertir el nombre de la ciudad a mayúsculas 
            nombreCiudad = nombreCiudad.toUpperCase();

            $.ajax({
                type: 'POST',
                url: '{% url "crear_ciudad" %}',  // Asegúrate de que esta URL esté definida en tus URLs de Django
                data: {
                    'nombre_ciudad': nombreCiudad,
                    'id_municipio': idMunicipio,
                    'ingresado_por': creadoPor,
                    'modificado_por': creadoPor,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function (response) {
                    if (response.status === 'success') {
                        // Cerrar el modal
                        $('#modalCrearCiudad').modal('hide');
                        // Añadir la nueva área al select como la primera opción 
                        const newOption = new Option(nombreCiudad, nombreCiudad);
                        $('#nueva-ciudad-municipio').prepend(newOption);
                        $('#nueva-ciudad-municipio').val(nombreCiudad); // Seleccionar la nueva opción 

                        // Limpiar el formulario del modal
                        $('#nombre-ciudad').val('');
                        $('#nuevo-nombre-municipio-ciudad').val('');
                    } else {
                        console.error('Error en la respuesta del servidor:', response.message);
                    }
                },
                error: function (response) {
                    console.error('Error al crear la ciudad', response);
                }
            });
        });

        $(document).ready(function () {
            $('#formCrearProfesion').on('submit', function (event) {
                event.preventDefault(); // Evita el envío normal del formulario

                // Obtener los valores del formulario
                let nombreProfesion = $('#nombre-profesion').val().trim();
                let descripcionProfesion = $('#descripcion-profesion').val().trim();
                const creadoPor = '{{userName}}';

                // Convertir el nombre de la profesión a mayúsculas si no está vacío
                nombreProfesion = nombreProfesion.toUpperCase();

                // Validación simple
                let errorMessage = '';

                // Validar si se ha ingresado el nombre de la profesión
                if (!nombreProfesion) {
                    errorMessage += 'El campo "Nombre de la Profesión" es obligatorio.\n';
                }

                // Validar si se ha ingresado el usuario creador
                if (!creadoPor) {
                    errorMessage += 'Su sesión ha expirado. Por favor, inicie sesión nuevamente.\n';
                }

                // Si hay errores, mostrar el mensaje de error y detener la ejecución
                if (errorMessage) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Campos Obligatorios',
                        text: errorMessage.replace(/\n/g, ' '),  // Mostrar los errores en una sola línea
                        confirmButtonText: 'Aceptar'
                    });
                    return;  // Detener la ejecución si hay errores
                }

                // Si no hay errores, proceder con la solicitud AJAX
                $.ajax({
                    type: 'POST',
                    url: '{% url "crear_profesion_oficio" %}',  // Asegúrate de que esta URL esté definida en tus URLs de Django
                    data: {
                        'nombre_profesion_oficio': nombreProfesion,
                        'descripcion': descripcionProfesion,
                        'creado_por': creadoPor,
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function (response) {
                        console.log('Respuesta del servidor:', response);
                        if (response.status === 'success' && response.id) {
                            // Mostrar un alert con el ID creado


                            // Cerrar el modal
                            $('#modalCrearProfesionOficio').modal('hide');

                            // Añadir la nueva profesión/oficio al select como la primera opción
                            const newOption = new Option(nombreProfesion, response.id, true, true);
                            $('#profesion-empleado').prepend(newOption);
                            $('#profesion-empleado').val(response.id).trigger('change'); // Seleccionar la nueva opción 

                            // Limpiar el formulario del modal
                            $('#nombre-profesion').val('');
                            $('#descripcion-profesion').val('');
                        } else {
                            Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: response.message || 'Ocurrió un error al crear la profesión. Inténtelo nuevamente.',
                                confirmButtonText: 'Aceptar'
                            });
                            console.error('Error en la respuesta del servidor:', response.error);
                        }
                    },
                    error: function (response) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Ocurrió un error al crear la profesión. Inténtelo nuevamente.',
                            confirmButtonText: 'Aceptar'
                        });
                        console.error('Error al crear la profesión/oficio', response);
                    }
                });
            });


        });

        $(document).ready(function () {
            $('#formCrearCentroEducativo').on('submit', function (event) {
                event.preventDefault(); // Evita el envío normal del formulario

                // Obtener los valores del formulario
                let nombreCentro = $('#nombre-centro').val().trim();
                let direccionCentro = $('#direccion-centro').val().trim();
                const creadoPor = '{{userName}}';

                // Convertir el nombre del centro a mayúsculas si no está vacío
                nombreCentro = nombreCentro.toUpperCase();

                // Validación simple
                let errorMessage = '';

                // Validar si se ha ingresado el nombre del centro
                if (!nombreCentro) {
                    errorMessage += 'El campo "Nombre del Centro Educativo" es obligatorio.\n';
                }

                // Validar si se ha ingresado el usuario creador
                if (!creadoPor) {
                    errorMessage += 'Su sesión ha expirado. Por favor, inicie sesión nuevamente.\n';
                }

                // Si hay errores, mostrar el mensaje de error y detener la ejecución
                if (errorMessage) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Campos Obligatorios',
                        text: errorMessage.replace(/\n/g, ' '),  // Mostrar los errores en una sola línea
                        confirmButtonText: 'Aceptar'
                    });
                    return;  // Detener la ejecución si hay errores
                }

                // Si no hay errores, proceder con la solicitud AJAX
                $.ajax({
                    type: 'POST',
                    url: '{% url "crear_centro_educativo" %}',  // Asegúrate de que esta URL esté definida en tus URLs de Django
                    data: {
                        'nombre_centro': nombreCentro,
                        'direccion': direccionCentro,
                        'creado_por': creadoPor,
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function (response) {
                        if (response.status === 'success' && response.id) {
                            // Mostrar un alert con el ID creado


                            // Cerrar el modal
                            $('#modalCrearCentroEducativo').modal('hide');

                            // Añadir el nuevo centro al select como la primera opción 
                            const newOption = new Option(nombreCentro, response.id, true, true);
                            $('#nuevo-campo-estudio').prepend(newOption);
                            $('#nuevo-campo-estudio').val(response.id).trigger('change'); // Seleccionar la nueva opción 

                            // Limpiar el formulario del modal
                            $('#nombre-centro').val('');
                            $('#direccion-centro').val('');
                        } else {
                            Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: response.message || 'Ocurrió un error al crear el centro educativo. Inténtelo nuevamente.',
                                confirmButtonText: 'Aceptar'
                            });
                            console.error('Error en la respuesta del servidor:', response.error);
                        }
                    },
                    error: function (response) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Ocurrió un error al crear el centro educativo. Inténtelo nuevamente.',
                            confirmButtonText: 'Aceptar'
                        });
                        console.error('Error al crear el centro educativo', response);
                    }
                });
            });


        });



        $('#formCrearPais').on('submit', function (event) {
            event.preventDefault();

            let paisName = $('#nombre-pais').val();
            const creadoPor = $('#creado_por').val();
            const nacionalidad = $('#nacionalidad_pais').val().toUpperCase();

            console.log('Nombre del país antes de convertir a mayúsculas:', paisName);
            console.log('Creado por:', creadoPor);
            console.log('Nacionalidad:', nacionalidad);

            // Convertir el nombre del país a mayúsculas
            paisName = paisName.toUpperCase();

            $.ajax({
                type: 'POST',
                url: '{% url "crear_pais" %}',
                data: {
                    'nombre_pais': paisName,
                    'creado_por': creadoPor,
                    'nacionalidad': nacionalidad,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function (response) {
                    console.log('Respuesta del servidor:', response);

                    if (response.status === 'success') {
                        // Capturar el last_id devuelto por el servidor
                        const lastId = response.last_id;

                        // Cerrar el modal
                        $('#modalCrearPais').modal('hide');

                        // Añadir el nuevo país a los selects
                        const newOption = new Option(paisName, lastId);
                        $('#residencia').prepend(newOption);
                        $('#residencia').val(lastId);

                        const newOptionPaisNacimiento = new Option(paisName, lastId);
                        $('#nuevo-pais-nac').prepend(newOptionPaisNacimiento);
                        $('#nuevo-pais-nac').val(lastId);

                        // Añadir la nueva nacionalidad al select de "Nacionalidad"
                        const newOptionNacionalidad = new Option(nacionalidad, nacionalidad);
                        $('#nacionalidad').prepend(newOptionNacionalidad);
                        $('#nacionalidad').val(nacionalidad);

                        // Limpiar el formulario del modal
                        $('#nombre-pais').val('');
                        $('#nacionalidad_pais').val('');

                        console.log('Nuevo país y nacionalidad añadidos correctamente.');
                    } else {
                        console.error('Error en la respuesta del servidor:', response.error);
                    }
                },
                error: function (response) {
                    console.error('Error al crear el país', response);
                }
            });
        });

        let ajaxRequest = null;

        /*  $('#nuevo-pais-nac').on('change', function () {
             let paisId = $(this).val();
             let manualNacionalidad = $('#nacionalidad').val(); // Guardar la nacionalidad manualmente agregada
 
             // Cancelar la solicitud AJAX anterior si existe
             if (ajaxRequest && ajaxRequest.readyState != 4) {
                 ajaxRequest.abort();
             }
 
             if (paisId) {
                 ajaxRequest = $.ajax({
                     type: 'GET',
                     url: '{% url "obtener_nacionalidades_por_pais" %}',
                     data: { 'pais_id': paisId },
                     cache: false,
                     success: function (response) {
                         let nacionalidadSelect = $('#nacionalidad');
                         nacionalidadSelect.empty();
                         nacionalidadSelect.append('<option value="">Seleccione una opción</option>');
 
                         if (response.nacionalidades && response.nacionalidades.length > 0) {
                             $.each(response.nacionalidades, function (index, nacionalidad) {
                                 nacionalidadSelect.append(
                                     '<option value="' + nacionalidad.id + '">' + nacionalidad.nombre + '</option>'
                                 );
                             });
 
                             if (manualNacionalidad) {
                                 // Re-agregar la nacionalidad manualmente si fue agregada
                                 nacionalidadSelect.prepend(new Option(manualNacionalidad, manualNacionalidad));
                                 nacionalidadSelect.val(manualNacionalidad);
                             }
 
                             if (response.nacionalidades.length === 1) {
                                 nacionalidadSelect.val(response.nacionalidades[0].id);
                             }
                         } else {
                             nacionalidadSelect.append('<option value="">No hay nacionalidades disponibles</option>');
                         }
                     },
                     error: function (response) {
                         console.error('Error al cargar las nacionalidades:', response);
                     },
                     complete: function () {
                         $('#nacionalidad').prop('disabled', false);
                     }
                 });
             } else {
                 $('#nacionalidad').empty();
                 $('#nacionalidad').append('<option value="">Seleccione una opción</option>');
             }
         });
  */
        /* $('#departamento_pais').on('change', function () {
            let departamentoId = $(this).val();  // Obtener el ID del departamento seleccionado
            let municipiosSelect = $('#nuevo-municipio-departamento');  // Select donde se mostrarán los municipios
 
            // Limpiar el select de municipios antes de agregar nuevas opciones
            municipiosSelect.empty();
            municipiosSelect.append('<option value="">Seleccione un municipio</option>');
            municipiosSelect.append('<option value="new-municipio-departamento">Crear un nuevo municipio</option>');
 
            if (departamentoId) {
                $.ajax({
                    type: 'POST',
                    url: '{% url "obtener_municipios_por_departamento" %}',  // Asegúrate de que esta URL coincida con la definida en urls.py
                    data: JSON.stringify({ 'id_departamento': departamentoId }),
                    contentType: 'application/json',
                    headers: {
                        'X-CSRFToken': $('input[name="csrfmiddlewaretoken"]').val()
                    },
                    success: function (response) {
                        console.log('Datos recibidos:', response);
 
                        if (response.status === 'success') {
                            $.each(response.municipios, function (index, municipio) {
                                municipiosSelect.append(
                                    $('<option>', {
                                        value: municipio.id_municipio,
                                        text: municipio.nombre_municipio
                                    })
                                );
                            });
                        } else {
                            console.error('Error en la respuesta del servidor:', response.error);
                            municipiosSelect.append('<option value="">No hay municipios disponibles</option>');
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error('Error al cargar los municipios:', xhr.status, status, error);
                    },
                    complete: function () {
                        console.log('Solicitud AJAX completada.');
                    }
                });
            } else {
                municipiosSelect.append('<option value="">Seleccione un municipio</option>');
            }
        });
 
 */

        $(document).ready(function () {
            $('#formCrearMunicipioDepartamento').on('submit', function (event) {
                event.preventDefault();

                // Obtener los valores del formulario
                let nombreMunicipio = $('#nombre-municipio-departamento').val();
                const creadoPor = $('#creado_por').val();
                const nombreDepartamento = $('#departamento_pais').val();

                // Convertir el nombre del municipio a mayúsculas 
                nombreMunicipio = nombreMunicipio.toUpperCase();

                $.ajax({
                    type: 'POST',
                    url: '{% url "crear_municipio" %}',
                    data: {
                        'nombre_municipio': nombreMunicipio,
                        'id_departamento': nombreDepartamento,
                        'ingresado_por': creadoPor,
                        'modificado_por': creadoPor,
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function (response) {
                        if (response.status === 'success') {
                            // Capturar el last_id devuelto por el servidor
                            const lastId = response.last_id;

                            // Cerrar el modal
                            $('#modalCrearMunicipioDepartamento').modal('hide');

                            // Añadir la nueva opción al select #nuevo-municipio-departamento
                            const newOption = new Option(nombreMunicipio, lastId);
                            $('#nuevo-municipio-departamento').prepend(newOption);
                            $('#nuevo-municipio-departamento').val(lastId); // Seleccionar la nueva opción usando el ID

                            // Añadir la nueva opción al select #nuevo-nombre-municipio-ciudad
                            $('#nuevo-nombre-municipio-ciudad').prepend(newOption.cloneNode(true));
                            $('#nuevo-nombre-municipio-ciudad').val(lastId); // Seleccionar la nueva opción usando el ID

                            // Limpiar el formulario del modal
                            $('#nombre-municipio-departamento').val('');
                            $('#nombre_departamento_municipio').val('');
                        } else {
                            console.error('Error en la respuesta del servidor:', response.message);
                        }
                    },
                    error: function (response) {
                        console.error('Error al crear el municipio', response);
                    }
                });
            });


        });

        $('#formCrearDepartamento').on('submit', function (event) {
            event.preventDefault();

            // Obtener los valores del formulario
            let nombre = $('#nuevoDepartamento').val().trim();
            let descripcion = $('#descripcionDepartamento').val() || '';
            let isValid = true;

            // Validar que el nombre no esté vacío
            if (!nombre) {
                Swal.fire({
                    icon: 'error',
                    title: 'Campo requerido',
                    text: 'El campo "Nombre del Departamento" es obligatorio.',
                    confirmButtonText: 'Aceptar'
                });
                isValid = false;
            }

            // Detener la ejecución si algún campo no es válido
            if (!isValid) {
                return;
            }

            // Convertir el nombre del departamento a mayúsculas 
            nombre = nombre.toUpperCase();

            // Proceder con la solicitud AJAX si todo es válido
            $.ajax({
                type: 'POST',
                url: '{% url "crear_departamento" %}',  // Asegúrate de que esta URL esté definida en tus URLs de Django
                data: {
                    'nombre': nombre,
                    'descripcion': descripcion,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function (response) {
                    if (response.status === 'success') {
                        // Cerrar el modal
                        $('#modalCrearDepartamento').modal('hide');

                        // Añadir el nuevo departamento al select usando el ID retornado
                        const newOption = new Option(nombre, response.id);
                        $('#departamento-empresa').prepend(newOption);
                        $('#departamento-empresa').val(response.id).trigger('change'); // Seleccionar la nueva opción 

                        // Limpiar el formulario del modal
                        $('#nuevoDepartamento').val('');
                        $('#descripcionDepartamento').val('');

                        // Mostrar mensaje de éxito

                    }
                },
                error: function (xhr, status, error) {
                    // Si el error es 400 (error de validación), mostrar el mensaje correcto
                    if (xhr.status === 400) {
                        let response = JSON.parse(xhr.responseText);
                        Swal.fire({
                            icon: 'error',
                            title: 'Nombre repetido',
                            text: response.error,  // Mensaje de error devuelto por el servidor
                            confirmButtonText: 'Aceptar'
                        });
                    } else {
                        // Para otros errores
                        Swal.fire({
                            icon: 'error',
                            title: 'Error de conexión',
                            text: 'No se pudo crear el departamento. Revise su conexión e intente de nuevo.',
                            confirmButtonText: 'Aceptar'
                        });
                        console.error('Error al crear el departamento', error);
                    }
                }
            });
        });



        $(document).ready(function () {
            $('#formCrearDepartamentoPais').on('submit', function (event) {
                event.preventDefault();

                const nombreDepartamento = $('#nombre-departamento-pais').val().trim();
                const idPais = $('#residencia').val();
                const creadoPor = '{{userName}}';
                const nombreDepartamentoMayus = nombreDepartamento.toUpperCase();

                // Validación simple
                let errorMessage = '';

                // Validar si se ha seleccionado un país
                if (!idPais) {
                    errorMessage += 'Debe seleccionar un país de residencia.\n';
                }

                // Validar si el nombre del departamento está vacío
                if (!nombreDepartamentoMayus) {
                    errorMessage += 'El campo "Nombre del Departamento" es obligatorio.\n';
                }

                // Si hay errores, mostrar mensaje de error y detener el envío del formulario
                if (errorMessage) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: errorMessage.replace(/\n/g, ' '),
                    });
                    return;
                }

                // Si todos los campos son válidos, procede con la solicitud AJAX
                $.ajax({
                    type: 'POST',
                    url: '{% url "crear_departamento_pais" %}',
                    data: {
                        'nombre_departamento': nombreDepartamentoMayus,
                        'id_pais': idPais,
                        'ingresado_por': creadoPor,
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function (response) {
                        if (response.status === 'success') {
                            // Cerrar el modal
                            $('#modalCrearDepartamentoPais').modal('hide');

                            // Crear una nueva opción para el departamento con el ID devuelto
                            const newOption = new Option(nombreDepartamentoMayus, response.last_id);

                            // Añadir la nueva opción al select #departamento_pais y seleccionarla
                            $('#departamento_pais').prepend(newOption);
                            $('#departamento_pais').val(response.last_id);

                            // Limpiar el formulario del modal
                            $('#nombre_pais_departamento').val('');
                            $('#nombre-departamento-pais').val('');
                        } else {
                            Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: 'Ocurrió un error al crear el departamento.',
                                confirmButtonText: 'OK'
                            });
                            console.error('Error en la respuesta del servidor:', response.error);
                        }
                    },
                    error: function (response) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'No se pudo crear el departamento. Por favor, intente nuevamente.',
                            confirmButtonText: 'OK'
                        });
                        console.error('Error al crear el departamento', response);
                    }
                });
            });


        });

        $('#modalCrearBeneficioLaboral').on('hidden.bs.modal', function () {
            // Al cerrar el modal actual, abrir el modal 'modalCrearBeneficioLaboralEmpleado'
            $('#modalCrearBeneficioLaboralEmpleado').modal('show');
        });


        $('#formCrearBeneficioLaboral').on('submit', function (event) {
            event.preventDefault(); // Evitar el envío normal del formulario

            // Obtener los valores de los campos del formulario
            let nombreBeneficioLaboral = $('#nombre-beneficio-laboral').val().trim(); // Eliminar espacios y obtener el valor
            let descripcionBeneficioLaboral = $('#descripcion-beneficio-laboral').val().trim(); // Eliminar espacios y obtener el valor
            const creadoPor = '{{userName}}';

            // Validación de campos vacíos
            let errorMessage = '';

            if (!nombreBeneficioLaboral) {
                errorMessage += 'El campo "Nombre del Beneficio Laboral" es obligatorio.\n';
            }
            if (!descripcionBeneficioLaboral) {
                errorMessage += 'El campo "Descripción del Beneficio Laboral" es obligatorio.\n';
            }
            if (!creadoPor) {
                errorMessage += 'Su sesión ha sido cerrada. Inicie sesión nuevamente para continuar.\n';
            }

            // Si hay errores, mostrar el mensaje y detener el envío
            if (errorMessage) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: errorMessage.replace(/\n/g, ' '),  // Mostrar los errores en una sola línea
                });
                return;  // Detener el envío del formulario
            }

            // Convertir el nombre del beneficio laboral a mayúsculas
            nombreBeneficioLaboral = nombreBeneficioLaboral.toUpperCase();

            // Si no hay errores, proceder con la solicitud AJAX
            $.ajax({
                type: 'POST',
                url: '{% url "crear_nuevo_beneficio_laboral" %}', // URL de la vista Django que maneja la solicitud
                data: {
                    'beneficio_laboral': nombreBeneficioLaboral,
                    'descripcion': descripcionBeneficioLaboral,
                    'creado_por': creadoPor,
                    'csrfmiddlewaretoken': '{{ csrf_token }}' // Token CSRF para seguridad
                },
                success: function (response) {
                    if (response.status === 'success') {
                        // Cerrar el modal si la respuesta es exitosa
                        $('#modalCrearBeneficioLaboral').modal('hide');
                        $('#modalCrearBeneficioLaboralEmpleado').modal('show');

                        // Añadir el nuevo beneficio laboral al select como la primera opción
                        const newOption = new Option(nombreBeneficioLaboral, response.id, true, true); // Mostrar el nombre, pero usar el ID como valor
                        $('#nuevo-beneficios-laborales').prepend(newOption);
                        $('#nuevo-beneficios-laborales').val(response.id).trigger('change'); // Seleccionar la nueva opción

                        // Verificación adicional para asegurarse de que el ID es numérico
                        console.log('ID que se está enviando:', $('#nuevo-beneficios-laborales').val());

                        // Limpiar el formulario
                        $('#nombre-beneficio-laboral').val('');
                        $('#descripcion-beneficio-laboral').val('');

                    } else {
                        console.error('Error en la respuesta del servidor:', response.error);
                        alert('Error al crear el beneficio laboral. Por favor, inténtelo nuevamente.');
                    }
                },
                error: function (response) {
                    console.error('Error al enviar la solicitud:', response); // Verificar el error
                    alert('Error al enviar la solicitud. Por favor, inténtelo nuevamente.');
                }
            });
        });

        $(document).ready(function () {
            $('#btnCerrarCrearTipoCurriculum').on('click', function () {
                // Cerrar el modal actual
                $('#modalCrearTipoCurriculum').modal('hide');

                // Abrir el modal "Curriculum Empleados"
                $('#modalNuevoCurriculo').modal('show');
            });
            $('#formCrearTipoCurriculum').on('submit', function (event) {
                event.preventDefault(); // Evitar el envío normal del formulario

                // Obtener los valores de los campos del formulario
                let tipoCurriculum = $('#nuevo_tipo_curriculum').val().trim();
                const creadoPor = '{{userName}}'; // Asegúrate de tener este valor correctamente

                // Convertir el nombre del tipo de currículum a mayúsculas si no está vacío
                tipoCurriculum = tipoCurriculum.toUpperCase();

                // Validación simple
                let errorMessage = '';

                // Validar si se ha ingresado el tipo de currículum
                if (!tipoCurriculum) {
                    errorMessage += 'El campo "Tipo de Currículum" es obligatorio.\n';
                }

                // Validar si se ha ingresado el usuario creador
                if (!creadoPor) {
                    errorMessage += 'Su sesión ha expirado. Por favor, inicie sesión nuevamente.\n';
                }

                // Si hay errores, mostrar el mensaje de error y detener la ejecución
                if (errorMessage) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Campos Obligatorios',
                        text: errorMessage.replace(/\n/g, ' '),  // Mostrar los errores en una sola línea
                        confirmButtonText: 'Aceptar'
                    });
                    return;  // Detener la ejecución si hay errores
                }

                // Si no hay errores, proceder con la solicitud AJAX
                $.ajax({
                    type: 'POST',
                    url: '{% url "crear_nuevo_tipo_curriculum" %}', // URL de la vista Django que maneja la solicitud
                    data: {
                        'nuevo_tipo_curriculum': tipoCurriculum,
                        'creado_por': creadoPor,
                        'csrfmiddlewaretoken': '{{ csrf_token }}' // Token CSRF para seguridad
                    },
                    success: function (response) {
                        if (response.status === 'success') {
                            // Cerrar el modal si la respuesta es exitosa
                            $('#modalCrearTipoCurriculum').modal('hide');
                            $('#modalNuevoCurriculo').modal('show'); // Mostrar el modal

                            // Añadir el nuevo tipo de currículum al select como la primera opción
                            const newOption = new Option(tipoCurriculum, response.id, true, true); // Mostrar el nombre, pero usar el ID como valor
                            $('#nuevo-tipo-curriculum').prepend(newOption);
                            $('#nuevo-tipo-curriculum').val(response.id).trigger('change'); // Seleccionar la nueva opción

                            // Limpiar el formulario
                            $('#nuevo_tipo_curriculum').val('');

                        } else {
                            Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: 'Ocurrió un error al crear el tipo de currículum. Inténtelo nuevamente.',
                                confirmButtonText: 'Aceptar'
                            });
                            console.error('Error en la respuesta del servidor:', response.error);
                        }
                    },
                    error: function (response) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Error al enviar la solicitud. Por favor, inténtelo nuevamente.',
                            confirmButtonText: 'Aceptar'
                        });
                        console.error('Error al enviar la solicitud:', response); // Verificar el error
                    }
                });
            });
        });


        $(document).ready(function () {
            $('#formCrearCatalogoEquipo').on('submit', function (event) {
                event.preventDefault(); // Evitar el envío normal del formulario

                // Obtener los valores del formulario
                let nombreEquipo = $('#nuevo-nombre-equipo').val().trim().toUpperCase(); // Convertir el nombre a mayúsculas
                let creadoPor = '{{userName}}'; // Obtener el valor del campo creado_por

                // Validación simple
                let errorMessage = '';

                // Validar si se ha ingresado el nombre del equipo
                if (!nombreEquipo) {
                    errorMessage += 'El campo "Nombre del Equipo" es obligatorio.\n';
                }

                // Validar si se ha ingresado el usuario creador
                if (!creadoPor) {
                    errorMessage += 'Su sesión ha expirado. Por favor, inicie sesión nuevamente.\n';
                }

                // Si hay errores, mostrar el mensaje de error y detener la ejecución
                if (errorMessage) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Campos Obligatorios',
                        text: errorMessage.replace(/\n/g, ' '),  // Mostrar los errores en una sola línea
                        confirmButtonText: 'Aceptar'
                    });
                    return;  // Detener la ejecución si hay errores
                }

                // Si no hay errores, proceder con la solicitud AJAX
                $.ajax({
                    url: '{% url "crear_cat_equipo" %}', // URL de la vista Django que maneja la solicitud
                    type: 'POST',
                    data: {
                        nombre_equipo_asignado: nombreEquipo,
                        creado_por: creadoPor,
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function (response) {
                        if (response.status === 'success') {
                            // Cerrar el modal si la respuesta es exitosa
                            $('#modalCrearCatalogoEquipo').modal('hide');
                            $('#modalEquipo').modal('show');

                            // Añadir el nuevo equipo al select con el ID como valor
                            const newOption = new Option(nombreEquipo, response.id, true, true); // Mostrar el nombre, usar el ID como valor
                            $('#descripcion-nombre_equipos').prepend(newOption);
                            $('#descripcion-nombre_equipos').val(response.id).trigger('change'); // Seleccionar la nueva opción

                            // Limpiar el formulario
                            $('#nuevo-nombre-equipo').val('');
                        } else {
                            Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: 'No se pudo crear el equipo. Inténtalo nuevamente.',
                            });
                            console.error('Error en la respuesta del servidor:', response.error);
                        }
                    },
                    error: function (response) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error en la solicitud',
                            text: 'Ocurrió un error al crear el equipo. Por favor, inténtelo nuevamente.',
                        });
                        console.error('Error al enviar la solicitud:', response);
                    }
                });
            });
        });

        $(document).ready(function () {
            $('#formCrearBanco').on('submit', function (event) {
                event.preventDefault(); // Evitar el envío normal del formulario

                // Obtener el valor del campo de nombre del banco
                let nombreBanco = $('#nombre-banco').val().trim();
                const creadoPor = '{{userName}}';

                // Convertir el nombre del banco a mayúsculas si no está vacío
                nombreBanco = nombreBanco.toUpperCase();

                // Validación simple
                let errorMessage = '';

                // Validar si se ha ingresado el nombre del banco
                if (!nombreBanco) {
                    errorMessage += 'El campo "Nombre del Banco" es obligatorio.\n';
                }

                // Validar si se ha ingresado el usuario creador
                if (!creadoPor) {
                    errorMessage += 'Su sesión ha expirado. Por favor, inicie sesión nuevamente.\n';
                }

                // Si hay errores, mostrar el mensaje de error y detener la ejecución
                if (errorMessage) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Campos Obligatorios',
                        text: errorMessage.replace(/\n/g, ' '),  // Mostrar los errores en una sola línea
                        confirmButtonText: 'Aceptar'
                    });
                    return;  // Detener la ejecución si hay errores
                }

                // Si no hay errores, proceder con la solicitud AJAX
                $.ajax({
                    type: 'POST',
                    url: '{% url "crear_nuevo_banco" %}', // URL de la vista Django que maneja la solicitud
                    data: {
                        'nombre_banco': nombreBanco,
                        'creado_por': creadoPor,
                        'csrfmiddlewaretoken': '{{ csrf_token }}' // Token CSRF para seguridad
                    },
                    success: function (response) {
                        if (response.status === 'success') {
                            // Cerrar el modal si la respuesta es exitosa
                            $('#modalCrearBanco').modal('hide');

                            // Añadir el nuevo banco al select como la primera opción
                            const newOption = new Option(nombreBanco, nombreBanco);
                            $('#nuevo-banco').prepend(newOption);
                            $('#nuevo-banco').val(nombreBanco); // Seleccionar la nueva opción

                            // Limpiar el formulario
                            $('#nombre-banco').val('');
                        } else {
                            Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: 'Ocurrió un error al crear el banco. Inténtelo nuevamente.',
                                confirmButtonText: 'Aceptar'
                            });
                            console.error('Error en la respuesta del servidor:', response.error);
                        }
                    },
                    error: function (response) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Error al enviar la solicitud. Por favor, inténtelo nuevamente.',
                            confirmButtonText: 'Aceptar'
                        });
                        console.error('Error al enviar la solicitud:', response); // Verificar el error
                    }
                });
            });
        });

        $('#modalCrearBeneficioAdicional').on('hidden.bs.modal', function () {
            // Abrir el modalCrearBeneficioAdicionalEmpleado cuando el primero se cierra
            $('#modalCrearBeneficioAdicionalEmpleado').modal('show');
        });

        $('#formCrearBeneficioAdicional').on('submit', function (event) {
            event.preventDefault(); // Evitar el envío normal del formulario

            // Obtener los valores de los campos del formulario
            let nombreBeneficio = $('#nombre-beneficio').val().trim();
            let descripcionBeneficio = $('#descripcion-beneficio').val().trim();
            const creadoPor = '{{userName}}';

            // Validaciones antes de enviar
            if (nombreBeneficio === '') {
                Swal.fire({
                    icon: 'warning',
                    title: 'Campo obligatorio',
                    text: 'El nombre del beneficio es obligatorio.',
                    confirmButtonText: 'Aceptar'
                });
                return; // Evitar enviar la solicitud si el campo está vacío
            }

            if (descripcionBeneficio === '') {
                Swal.fire({
                    icon: 'warning',
                    title: 'Campo obligatorio',
                    text: 'La descripción del beneficio es obligatoria.',
                    confirmButtonText: 'Aceptar'
                });
                return; // Evitar enviar la solicitud si el campo está vacío
            }

            // Convertir el nombre del beneficio a mayúsculas
            nombreBeneficio = nombreBeneficio.toUpperCase();

            $.ajax({
                type: 'POST',
                url: '{% url "crear_nuevo_beneficio_adicional" %}', // URL de la vista Django que maneja la solicitud
                data: {
                    'beneficio': nombreBeneficio,
                    'descripcion': descripcionBeneficio,
                    'creado_por': creadoPor,
                    'csrfmiddlewaretoken': '{{ csrf_token }}' // Token CSRF para seguridad
                },
                success: function (response) {
                    if (response.status === 'success') {


                        // Cerrar el modal si la respuesta es exitosa
                        $('#modalCrearBeneficioAdicional').modal('hide');
                        $('#modalCrearBeneficioAdicionalEmpleado').modal('show');

                        // Añadir el nuevo beneficio adicional al select con el ID como valor
                        const newOption = new Option(nombreBeneficio, response.id, true, true); // Mostrar el nombre, usar el ID como valor
                        $('#nuevo-beneficio-adicional').prepend(newOption);
                        $('#nuevo-beneficio-adicional').val(response.id).trigger('change'); // Seleccionar la nueva opción

                        // Limpiar el formulario
                        $('#nombre-beneficio').val('');
                        $('#descripcion-beneficio').val('');
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Error al crear el beneficio adicional. Por favor, inténtelo nuevamente.',
                            confirmButtonText: 'Aceptar'
                        });
                    }
                },
                error: function (response) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error en la solicitud',
                        text: 'Error al enviar la solicitud. Por favor, inténtelo nuevamente.',
                        confirmButtonText: 'Aceptar'
                    });
                    console.error('Error al enviar la solicitud:', response); // Verificar el error
                }
            });
        });

        $('#formCrearHabilidad').on('submit', function (event) {
            event.preventDefault();
            let habilidadName = $('#nueva-habilidad-input').val();
            let descripcionHabilidad = $('#descripcion-habilidad-input').val().toUpperCase();
            const creadoPor = $('#creado-por').val();

            // Convertir el nombre de la habilidad a mayúsculas 
            habilidadName = habilidadName.toUpperCase();

            $.ajax({
                type: 'POST',
                url: '{% url "crear_habilidad" %}',
                data: JSON.stringify({
                    'nueva-habilidad-input': habilidadName,
                    'descripcion-habilidad-input': descripcionHabilidad,
                    'creado_por': creadoPor
                }),
                contentType: 'application/json',
                success: function (response) {
                    if (response.status === 'success') {
                        Swal.fire({
                            icon: 'success',
                            title: 'Habilidad guardada',
                            text: 'Habilidad guardada exitosamente.',
                            showConfirmButton: false,
                            timer: 1500
                        });
                        let nuevaFila = `
            <tr data-id="${response.habilidad.id_habilidad}">
                <td>${response.habilidad.habilidad}</td>
                <td>${response.habilidad.descripcion}</td>
                <td class="text-right">
                    <button type="button" class="btn btn-sm btn-success btn-add-habilidad"
                        style="font-size: 16px; margin-right: 5px;"><i class="material-icons"
                            style="font-size: 16px;">add</i></button>
                    <button type="button" class="btn btn-sm btn-warning btn-edit-habilidad"
                        style="font-size: 16px; margin-left: 5px;"><i class="material-icons"
                            style="font-size: 16px;">edit</i></button>
                </td>
            </tr>
            `;
                        $('#modal-habilidades-table tbody').append(nuevaFila);

                        $('#nueva-habilidad-input').val('');
                        $('#descripcion-habilidad-input').val('');
                    } else {
                        console.error('Error en la respuesta del servidor:', response.message);
                    }
                },
                error: function (response) {
                    console.error('Error al crear habilidad', response);
                }
            });
        });

        /* $('#usuario').on('select2:select', function (e) {
            var selectedValue = $(this).val();
            if (selectedValue === 'new-usuario') {
                $('#modalCrearUsuario').modal('show'); // Mostrar el modal
                $('#usuario').val(null).trigger('change'); // Restablecer el valor del select
            }
        }); */

        //abrir modal estado empleado
        $('#estado-empleado').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-estado-empleado') {
                $('#modalCrearEstadoEmpleado').modal('show'); // Mostrar el modal
                $('#estado-empleado').val(null).trigger('change'); // Restablecer el valor del select
            }
        });

        //crear estado empleado 
        $('#formCrearEstadoEmpleado').on('submit', function (event) {
            event.preventDefault(); // Prevenir el envío del formulario

            let estadoEmpleado = $('#nuevo-estado-empleado').val().trim().toUpperCase(); // Convertir a mayúsculas y limpiar espacios
            let creadoPor = '{{userName}}';
            let csrfToken = $('input[name="csrfmiddlewaretoken"]').val();

            // Validar que el campo de estado no esté vacío
            if (!estadoEmpleado) {
                Swal.fire({
                    icon: 'error',
                    title: 'Campo requerido',
                    text: 'El campo "Estado del Empleado" es obligatorio.',
                    confirmButtonText: 'Aceptar'
                });
                return; // Detener el envío si está vacío
            }

            // Enviar la solicitud AJAX si todo está correcto
            $.ajax({
                url: "{% url 'crear_estado_empleado' %}",
                type: 'POST',
                data: {
                    estado_empleado: estadoEmpleado,
                    creado_por: creadoPor,
                    csrfmiddlewaretoken: csrfToken
                },
                success: function (response) {
                    if (response.status === 'success') {
                        $('#modalCrearEstadoEmpleado').modal('hide'); // Cerrar el modal

                        // Limpiar el select antes de agregar la nueva opción
                        $('#estado-empleado').empty();

                        // Añadir la opción de "Crear nuevo estado de empleado" nuevamente
                        const createNewOption = new Option("Crear nuevo estado de empleado", "new-estado-empleado", false, false);
                        $('#estado-empleado').append(createNewOption);

                        // Añadir el nuevo estado al select y seleccionarlo automáticamente
                        const newOption = new Option(estadoEmpleado, response.id_estado, false, true); // Crear una nueva opción y seleccionarla
                        $('#estado-empleado').append(newOption).trigger('change'); // Añadir al select y seleccionar automáticamente

                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Error al crear el estado: ' + response.error,
                        });
                    }
                },
                error: function (xhr, status, error) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error en la solicitud',
                        text: 'No se pudo crear el estado del empleado. Revise su conexión e intente de nuevo.',
                        confirmButtonText: 'Aceptar'
                    });
                    console.error('Error en la solicitud AJAX:', error);
                }
            });
        });

        function obtenerEstadosEmpleados(nuevoEstadoEmpleadoSeleccionado) {
            $.ajax({
                url: "{% url 'obtener_estados_empleados' %}",
                type: 'GET',
                success: function (response) {
                    if (response.status === 'success') {
                        var select = $('#estado-empleado');
                        select.empty();
                        select.append('<option value="">Seleccione un estado</option>');
                        select.append('<option value="new-estado-empleado">Crear nuevo estado</option>');
                        response.estados.forEach(function (estado) {
                            select.append('<option value="' + estado.id + '">' + estado.nombre + '</option>');
                        });

                        // Seleccionar el nuevo estado si se especificó
                        if (nuevoEstadoEmpleadoSeleccionado) {
                            select.val(response.estados.find(est => est.nombre === nuevoEstadoEmpleadoSeleccionado).id);
                        }
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Error al obtener la lista de estados: ' + response.error,
                        });
                    }
                },
                error: function (xhr, status, error) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Error en la solicitud: ' + error,
                    });
                }
            });
        }


        $('#forma-pago').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-forma-pago') {
                $('#modalCrearFormaPago').modal('show'); // Mostrar el modal
                $('#forma-pago').val(null).trigger('change'); // Restablecer el valor del select
            }
        });


        $('#tipo-cuenta').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-tipo-cuenta') {
                $('#modalCrearTipoCuenta').modal('show'); // Mostrar el modal
                $('#tipo-cuenta').val(null).trigger('change'); // Restablecer el valor del select
            }
        });

        $('#centro-costo').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-centro-costos') {
                $('#modalCrearCentroCostos').modal('show'); // Mostrar el modal
                $('#centro-costo').val(null).trigger('change'); // Restablecer el valor del select
            }
        });

        $('#nivel-certificado').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-nivel-certificado') {
                $('#modalCrearNivelCertificado').modal('show'); // Mostrar el modal
                $('#nivel-certificado').val(null).trigger('change'); // Restablecer el valor del select
            }
        });

        $('#rol-empleado').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            console.log("Valor seleccionado:", selectedValue); // Agrega un console.log para depuración
            if (selectedValue === 'new-rol-empleado') {
                console.log("Abrir modal para crear nuevo rol"); // Agrega otro console.log para verificar
                $('#modalCrearRol').modal('show'); // Mostrar el modal
                $('#rol-empleado').val(null).trigger('change'); // Restablecer el valor del select
            }
        });




        $('#enfermedad-base').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-enfermedad-base') {
                $('#modalCrearEnfermedadesBase').modal('hide'); // Mostrar el modal
                $('#modalCrearCatalogoEnfermedadesBase').modal('show'); // Mostrar el modal
                $('#enfermedad-base').val(null).trigger('change'); // Restablecer el valor del select
            }
        });

        $('#poliza').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-poliza') {
                $('#nuevoSeguroModal').modal('hide'); // Mostrar el modal
                $('#modalCrearPolizaSeguro').modal('show'); // Mostrar el modal
                $('#poliza').val(null).trigger('change'); // Restablecer el valor del select
            }
        });



        $('#nombre-seguro').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-nombre-seguro') {
                $('#nuevoSeguroModal').modal('hide'); // Mostrar el modal
                $('#modalCrearEmpresaSeguro').modal('show'); // Mostrar el modal
                $('#nombre-seguro').val(null).trigger('change'); // Restablecer el valor del select
            }
        });

        $('#nuevo-nombre-empresa-poliza').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-nombre-empresa-poliza') {
                $('#modalCrearPolizaSeguro').modal('hide'); // Mostrar el modal
                $('#modalCrearEmpresaSeguro').modal('show'); // Mostrar el modal
                $('#nuevo-nombre-empresa-poliza').val(null).trigger('change'); // Restablecer el valor del select
            }
        });



        $('#nuevo-pais-nac').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-pais-nac') {
                $('#modalCrearPais').modal('show'); // Mostrar el modal
                $('#nuevo-pais-nac').val(null).trigger('change'); // Restablecer el valor del select
            }
        });



        $('#residencia').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-residencia') {
                $('#modalCrearPais').modal('show'); // Mostrar el modal
                $('#residencia').val(null).trigger('change'); // Restablecer el valor del select
            }
        });


        $('#nuevo-nombre-ciudad-barrio').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-nombre-ciudad-barrio') {
                $('#modalCrearCiudad').modal('show'); // Mostrar el modal
                $('#nuevo-nombre-ciudad-barrio').val(null).trigger('change'); // Restablecer el valor del select
            }
        });



        $('#nuevo-nombre-municipio-ciudad').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-nombre-municipio-ciudad') {
                $('#modalCrearMunicipioDepartamento').modal('show'); // Mostrar el modal
                $('#nuevo-nombre-municipio-ciudad').val(null).trigger('change'); // Restablecer el valor del select
            }
        });

        $('#nombre-departamentos-municipios').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-nombre-departamentos-municipios') {
                $('#modalCrearDepartamentoPais').modal('show'); // Mostrar el modal
                $('#nombre-departamentos-municipios').val(null).trigger('change'); // Restablecer el valor del select
            }
        });

        $('#nuevo-municipio-departamento').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-municipio-departamento') {
                $('#modalCrearMunicipioDepartamento').modal('show'); // Mostrar el modal
                $('#nuevo-municipio-departamento').val(null).trigger('change'); // Restablecer el valor del select
            }
        });

        $('#nombre_pais_departamento').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-pais-departamentos') {
                $('#modalCrearPaisDepartamento').modal('show'); // Mostrar el modal
                $('#nombre_pais_departamento').val(null).trigger('change'); // Restablecer el valor del select
            }
        });

        $('#descripcion-nombre_equipos').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-descripcion-nombre_equipos') {
                $('#modalEquipo').modal('hide');
                $('#modalCrearCatalogoEquipo').modal('show');
                $('#descripcion-nombre_equipos').val(null).trigger('change'); // Restablecer el valor del select
            }
        });

        /*  $('#nuevo-estado-curriculum').on('select2:select', function (e) {
             var selectedValue = e.params.data.id;
             if (selectedValue === 'new-estado-curriculum') {
                 $('#modalCrearEstadoCurriculum').modal('show'); // Mostrar el modal
                 $('#nuevo-estado-curriculum').val(null).trigger('change'); // Restablecer el valor del select
             }
         }); */

        $('#nuevo-tipo-curriculum').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-tipo-curriculum') {
                $('#modalNuevoCurriculo').modal('hide'); // Mostrar el modal
                $('#modalCrearTipoCurriculum').modal('show'); // Mostrar el modal
                $('#nuevo-tipo-curriculum').val(null).trigger('change'); // Restablecer el valor del select
            }
        });

        $('#nuevo-descripcion-asociacion').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-descripcion-asociacion') {

                $('#modalAsociaciones').modal('hide'); // ocultar el modal
                $('#modalCrearAsociacion').modal('show'); // Mostrar el modal
                $('#nuevo-descripcion-asociacion').val(null).trigger('change'); // Restablecer el valor del select
            }
        });

        $('#nuevo-parentesco-familiar').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-parentesco-familiar') {
                $('#modalFamiliares').modal('hide'); // Mostrar el modal
                $('#modalCrearPrentesco').modal('show'); // Mostrar el modal
                $('#nuevo-parentesco-familiar').val(null).trigger('change'); // Restablecer el valor del select
            }
        });

        $('#nuevo_parentesco_contacto').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-parentesco-emergencia') {
                $('#contactosEmergenciasModal').modal('hide'); // Mostrar el modal
                $('#modalCrearPrentesco').modal('show'); // Mostrar el modal
                $('#nuevo_parentesco_contacto').val(null).trigger('change'); // Restablecer el valor del select
            }
        });



        $('#nuevo-campo-estudio').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-campo-estudio') {
                $('#modalCrearCentroEducativo').modal('show'); // Mostrar el modal
                $('#nuevo-campo-estudio').val(null).trigger('change'); // Restablecer el valor del select
            }
        });

        $('#nuevo-parentesco-contacto').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-parentesco-contacto') {
                $('#contactosEmergenciasModal').modal('hide'); // Show the modal
                $('#modalCrearPrentesco').modal('show'); // Show the modal
                $('#nuevo-parentesco-contacto').val(null).trigger('change'); // Reset the select value
            }
        });


        $('#nuevo-banco').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-banco') {
                $('#modalCrearBanco').modal('show'); // Mostrar el modal
                $('#nuevo-banco').val(null).trigger('change'); // Restablecer el valor del select
            }
        });



        $('#nuevo-beneficios-laborales').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-beneficios-laborales') {
                $('#modalCrearBeneficioLaboralEmpleado').modal('hide'); // Mostrar el modal
                $('#modalCrearBeneficioLaboral').modal('show'); // Mostrar el modal
                $('#nuevo-beneficios-laborales').val(null).trigger('change'); // Restablecer el valor del select
            }
        });


        $('#nuevo-beneficio-adicional').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-beneficio-adicional') {
                $('#modalCrearBeneficioAdicionalEmpleado').modal('hide');
                $('#modalCrearBeneficioAdicional').modal('show'); // Mostrar el modal
                $('#nuevo-beneficio-adicional').val(null).trigger('change'); // Restablecer el valor del select
            }
        });


        $('#nuevo-motivo-retiro').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-motivo-retiro') {
                $('#modalCrearMotivoRetiro').modal('show'); // Mostrar el modal
                $('#nuevo-motivo-retiro').val(null).trigger('change'); // Restablecer el valor del select
            }
        });

        $('#nuevo-categoria-retiros').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-categoria-retiros') {
                $('#modalCrearCatRetiro').modal('show'); // Mostrar el modal
                $('#nuevo-categoria-retiros').val(null).trigger('change'); // Restablecer el valor del select
            }
        });



        $('#profesion-empleado').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-profesion-empleado') {
                $('#modalCrearProfesionOficio').modal('show'); // Mostrar el modal
                $('#profesion-empleado').val(null).trigger('change'); // Restablecer el valor del select
            }
        });


        $('#nuevo-centro-estudio').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-centro-estudio') {
                $('#modalCrearNivelCertificado').modal('show'); // Mostrar el modal
                $('#nuevo-centro-estudio').val(null).trigger('change'); // Restablecer el valor del select
            }
        });



        $('#nuevo-barrio-ciudad').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-barrio-ciudad') {
                $('#modalCrearBarrio').modal('show'); // Mostrar el modal
                $('#nuevo-barrio-ciudad').val(null).trigger('change'); // Restablecer el valor del select
            }
        });

        $('#nueva-ciudad-municipio').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-ciudad-municipio') {
                $('#modalCrearCiudad').modal('show'); // Mostrar el modal
                $('#nueva-ciudad-municipio').val(null).trigger('change'); // Restablecer el valor del select
            }
        });


        $('#departamento-empresa').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-departamento-empresa') {
                $('#modalCrearDepartamento').modal('show'); // Mostrar el modal
                $('#departamento-empresa').val(null).trigger('change'); // Restablecer el valor del select
            }
        });

        $('#cargos-empresa').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-cargos-empresa') {
                $('#modalCrearCargo').modal('show'); // Mostrar el modal
                $('#cargos-empresa').val(null).trigger('change'); // Restablecer el valor del select
            }
        });

        $('#puesto-empresa').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-puesto-empresa') {
                $('#modalCrearPosicion').modal('show'); // Mostrar el modal
                $('#puesto-empresa').val(null).trigger('change'); // Restablecer el valor del select
            }
        });

        $('#areas-empresa').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-areas-empresa') {
                $('#modalCrearArea').modal('show'); // Mostrar el modal
                $('#areas-empresa').val(null).trigger('change'); // Restablecer el valor del select
            }
        });




        $('#tipo-contrato').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-tipo-contrato') {
                $('#modalCrearTipoContrato').modal('show'); // Mostrar el modal
                $('#tipo-contrato').val(null).trigger('change'); // Restablecer el valor del select
            }
        });

        $('#tipo-pago').on('select2:select', function (e) {
            var selectedValue = e.params.data.id;
            if (selectedValue === 'new-tipo-pago') {
                $('#modalCrearTipoPago').modal('show'); // Mostrar el modal
                $('#tipo-pago').val(null).trigger('change'); // Restablecer el valor del select
            }
        });



        //crear posicion
        $('#formCrearPosicion').on('submit', function (event) {
            event.preventDefault(); // Prevenir el envío del formulario

            var nombrePosicion = $('#nuevo-posicion').val().toUpperCase(); // Convertir a mayúsculas
            var creadoPor = $('#creado-por').val();
            var csrfToken = $('input[name="csrfmiddlewaretoken"]').val();

            $.ajax({
                url: "{% url 'crear_posicion' %}",
                type: 'POST',
                data: {
                    nombre_posicion: nombrePosicion,
                    creado_por: creadoPor,
                    csrfmiddlewaretoken: csrfToken
                },
                success: function (response) {
                    if (response.status === 'success') {
                        $('#modalCrearPosicion').modal('hide');
                        // Llamar a obtenerPosiciones y luego seleccionar la nueva posición
                        obtenerPosiciones(nombrePosicion);
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Error al crear la posición: ' + response.error,
                        });
                    }
                },
                error: function (xhr, status, error) {
                    alert('Error en la solicitud: ' + error);
                }
            });
        });

        //obtener posiciones
        function obtenerPosiciones(nuevaPosicionSeleccionada) {
            $.ajax({
                url: "{% url 'obtener_posiciones' %}",
                type: 'GET',
                success: function (response) {
                    if (response.status === 'success') {
                        var select = $('#puesto-empresa');
                        select.empty();
                        select.append('<option value="">Seleccione una posición</option>');
                        select.append('<option value="new-posicion">Crear nueva posición</option>');
                        response.posiciones.forEach(function (posicion) {
                            select.append('<option value="' + posicion.id + '">' + posicion.nombre + '</option>');
                        });

                        // Seleccionar la nueva posición si se especificó
                        if (nuevaPosicionSeleccionada) {
                            select.val(response.posiciones.find(pos => pos.nombre === nuevaPosicionSeleccionada).id);
                        }
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Error al obtener la lista de posiciones: ' + response.error,
                        });
                    }
                },
                error: function (xhr, status, error) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Error en la solicitud: ' + error,
                    });
                }
            });
        }
    });


    $(document).ready(function () {

        $('#forma-pago').select2({
            placeholder: "Seleccione forma de pago",
            allowClear: true
        });


        $('#estado-empleado').select2({
            placeholder: "Seleccione estado",
            allowClear: true
        });

        $('.select2').select2();
        $('#departamento_pais').select2({
            placeholder: "Seleccione departamento",
            allowClear: true
        });


        $('#residencia').select2({
            placeholder: "Seleccione pais de residencia",
            allowClear: true
        });

        $('#ccurriculo').select2({
            placeholder: "Seleccione curriculo",
            allowClear: true
        });

        $('#tipo-contrato').select2({
            placeholder: "Seleccione tipo de contrato",
            allowClear: true
        });

        $('#forma-pago').select2({
            placeholder: "Seleccione forma de pago",
            allowClear: true
        });

        $('#tipo-cuenta').select2({
            placeholder: "Seleccione tipo de cuenta",
            allowClear: true
        });

        $('#centro-costo').select2({
            placeholder: "Seleccione centro de costos",
            allowClear: true
        });

        $('#cuenta-contable').select2({
            placeholder: "Seleccione cuenta contable",
            allowClear: true
        });


        $('#estado-civil').select2({
            placeholder: "Seleccione estado civil",
            allowClear: true
        });

        $('#nivel-certificado').select2({
            placeholder: "Seleccione nivel de certificado",
            allowClear: true
        });

        $('#gerente').select2({
            placeholder: "Seleccione un gerente",
            allowClear: true
        });

        $('#jefe-inmediato').select2({
            placeholder: "Seleccione un jefe",
            allowClear: true
        });

        $('#jefe-superior').select2({
            placeholder: "Seleccione nivel una opción",
            allowClear: true
        });

        $('#tipo-vehiculo').select2({
            placeholder: "Seleccione una opción",
            allowClear: true
        });

        $('#tipo-sangre').select2({
            placeholder: "Seleccione una opción",
            allowClear: true
        });

        $('#rol-empleado').select2({
            placeholder: "Seleccione rol del empleado",
            allowClear: true
        });


        $('#enfermedad-base').select2({
            placeholder: "Seleccione enfermedades",
            allowClear: true
        });


        $('#poliza').select2({
            placeholder: "Seleccione poliza de seguros",
            allowClear: true
        });


        $('#nombre-seguro').select2({
            placeholder: "Seleccione una empresa de seguros",
            allowClear: true
        });

        $('#nuevo-nombre-empresa-poliza').select2({
            placeholder: "Seleccione una empresa de seguros",
            allowClear: true
        });





        $('#centro').select2({
            placeholder: "Seleccione una empresa",
            allowClear: true
        });

        $('#sucursal').select2({
            placeholder: "Seleccione una sucursal",
            allowClear: true
        });


        $('#sexo').select2({
            placeholder: "Seleccione el sexo",
            allowClear: true
        });

        $('#nacionalidad').select2({
            placeholder: "Seleccione nacionalidad",
            allowClear: true
        });



        $('#nuevo-pais-nac').select2({
            placeholder: "Seleccione pais de nacimiento",
            allowClear: true
        });



        $('#nuevo-nombre-ciudad-barrio').select2({
            placeholder: "Seleccione municipio",
            allowClear: true
        });




        $('#nuevo-nombre-municipio-ciudad').select2({
            placeholder: "Seleccione municipio",
            allowClear: true
        });



        $('#nombre-departamentos-municipios').select2({
            placeholder: "Seleccione departamento",
            allowClear: true
        });



        $('#nuevo-municipio-departamento').select2({
            placeholder: "Seleccione municipio",
            allowClear: true
        });




        $('#nombre_pais_departamento').select2({
            placeholder: "Seleccione pais",
            allowClear: true
        });



        $('#descripcion-nombre_equipos').select2({
            placeholder: "Seleccione equipos",
            allowClear: true
        });

        $('#nuevo-estado-curriculum').select2({
            placeholder: "Seleccione su estado",
            allowClear: true
        });

        $('#nuevo-tipo-curriculum').select2({
            placeholder: "Seleccione tipo de curriculum",
            allowClear: true
        });



        $('#nuevo-descripcion-asociacion').select2({
            placeholder: "Seleccione una asociacion",
            allowClear: true
        });




        $('#nuevo-parentesco-contacto').select2({
            placeholder: "Seleccione parentesco",
            allowClear: true
        });

        $('#nuevo-parentesco-familiar').select2({
            placeholder: "Seleccione parentesco",
            allowClear: true
        });




        $('#nuevo-campo-estudio').select2({
            placeholder: "Seleccione centro educativo",
            allowClear: true
        });

        $('#nuevo-banco').select2({
            placeholder: "Seleccione banco",
            allowClear: true
        });


        $('#nuevo-beneficios-laborales').select2({
            placeholder: "Seleccione beneficios laborales",
            allowClear: true
        });

        $('#nuevo-beneficio-adicional').select2({
            placeholder: "Seleccione beneficio adicionales",
            allowClear: true
        });

        $('#nuevo-motivo-retiro').select2({
            placeholder: "Seleccione motivo de retiro",
            allowClear: true
        });

        $('#nuevo-categoria-retiros').select2({
            placeholder: "Seleccione categoria de retiro",
            allowClear: true
        });



        $('#profesion-empleado').select2({
            placeholder: "Seleccione profesión",
            allowClear: true
        });

        $('#nuevo-barrio-ciudad').select2({
            placeholder: "Seleccione barrio",
            allowClear: true
        });

        $('#nueva-ciudad-municipio').select2({
            placeholder: "Seleccione ciudad",
            allowClear: true
        });

        $('#departamento-empresa').select2({
            placeholder: "Seleccione departamento",
            allowClear: true
        });

        $('#cargos-empresa').select2({
            placeholder: "Seleccione cargo",
            allowClear: true
        });

        $('#puesto-empresa').select2({
            placeholder: "Seleccione puesto",
            allowClear: true
        });

        $('#areas-empresa').select2({
            placeholder: "Seleccione área",
            allowClear: true
        });


        $('#usuario').select2({
            placeholder: "Seleccione usuario",
            allowClear: true
        });

        $('#usuario_biometrico').select2({
            placeholder: "Seleccione usuario",
            allowClear: true
        });

        $('#estado_curriculum').select2({
            placeholder: "Seleccione estado",
            allowClear: true
        });



        $('#estado_curriculum').on('change', function () {
            // Aquí está el nuevo console.log
            if ($(this).val() === 'new-estado-curriculo') {
                $('#modalCrearEstadoCurriculum').modal('show');
            }
        });



    });


    function guardarTipoContrato() {
        var nuevoTipoContrato = $('#nuevo-tipo-contrato').val();

        if (nuevoTipoContrato.trim() === "") {
            toastr.error('El nombre del tipo de contrato no puede estar vacío.');
            return;
        }

        var select = $('#tipo-contrato');
        var newOption = new Option(nuevoTipoContrato, nuevoTipoContrato, false, false);
        select.append(newOption).trigger('change');

        $('#modalCrearTipoContrato').modal('hide');
        toastr.success('Tipo de contrato guardado exitosamente.');
    }


    function guardarFormaPago() {
        var nuevaFormaPago = $('#nueva-forma-pago').val();

        if (nuevaFormaPago.trim() === "") {
            toastr.error('El nombre de la forma de pago no puede estar vacío.');
            return;
        }

        var select = $('#forma-pago');
        var newOption = new Option(nuevaFormaPago, nuevaFormaPago, false, false);
        select.append(newOption).trigger('change');

        $('#modalCrearFormaPago').modal('hide');
        toastr.success('Forma de pago guardada exitosamente.');
    }




    $(document).ready(function () {

        // Evento para capturar los cambios en el formulario
        /*  $('#empleado-form input, #empleado-form select, #form-informacion-personal input, #form-informacion-personal select').on('change', function () {
             let nombreEmpleado = $('#nombre-empleado').val();
             let apellidoEmpleado = $('#apellido-empleado').val();
             let estadoEmpleado1 = $('#estado-empleado').val();
             let rolEmpleado = $('#rol-empleado').val();
             let direccionPersonal = $('#direccion-contacto').val();
             let puntoReferencia = $('#punto-referencia').val();
             let correoPersonal = $('#correo-contacto').val();
             let telefonoPersonal = $('#telefono-personal').val();
             let vehiculoPersonal = $('#tipo-vehiculo').val();
             let placaVehiculo = $('#placa-vehiculo').val();
             let residencia = $('#residencia').val();
             let departamento_pais = $('#departamento_pais').val();
             let municipioDepartamento = $('#nuevo-municipio-departamento').val();
             let barrioMuicipio = $('#nuevo-barrio-ciudad').val();
             let distancia = $('#distancia-km').val();
             let paisNacimiento = $('#nuevo-pais-nac').val();
             let nacionalidad = $('#nacionalidad').val();
             let pasaporte = $('#pasaporte').val();
             let ciudadNac = $('#ciudad-nac').val();
             let fechaNac = $('#fecha-nac').val();
             let estadoCivil = $('#estado-civil').val();
             let hijos = $('#numero-hijos').val();
             let tipoSangre = $('#tipo-sangre').val();
             let sexo = $('#sexo').val();
             let nivelCertificado = $('#nivel-certificado').val();
             let campoEstudio = $('#nuevo-campo-estudio').val();
             let profesion = $('#profesion-empleado').val();
             let idEmpleado = $('#id-empleado').val() || $('#edit-id-empleado').val();
 
 
             if (idEmpleado
             ) {
                 $.ajax({
                     type: 'POST',
                     url: "{% url 'actualizar_empleado' %}",
                     data: {
                         'nombre_empleado': nombreEmpleado,
                         'apellido_empleado': apellidoEmpleado,
                         'estado_empleado': estadoEmpleado1,
                         'rol_empleado': rolEmpleado,
                         'direccion_contacto': direccionPersonal,
                         'punto_referencia': puntoReferencia,
                         'correo_contacto': correoPersonal,
                         'telefono_personal': telefonoPersonal,
                         'tipo_vehiculo': vehiculoPersonal,
                         'placa_vehiculo': placaVehiculo,
                         'residencia': residencia,
                         'departamento_pais': departamento_pais,
                         'nuevo_municipio_departamento': municipioDepartamento,
                         'nuevo_barrio_ciudad': barrioMuicipio,
                         'distancia_km': distancia,
                         'nuevo_pais_nac': paisNacimiento,
                         'nacionalidad': nacionalidad,
                         'pasaporte': pasaporte,
                         'ciudad_nac': ciudadNac,
                         'fecha_nac': fechaNac,
                         'estado_civil': estadoCivil,
                         'numero_hijos': hijos,
                         'tipo_sangre': tipoSangre,
                         'sexo': sexo,
                         'nivel_certificado': nivelCertificado,
                         'nuevo_campo_estudio': campoEstudio,
                         'profesion_empleado': profesion,
                         'id_empleado': idEmpleado,
                         'creado_por': '{{userName}}',
                         'csrfmiddlewaretoken': '{{ csrf_token }}'
                     },
                     success: function (response) {
                         if (response.status === 'success') {
                             console.log('Empleado actualizado correctamente.');
                         } else {
                             console.log('Error al actualizar el empleado: ' + response.error);
                         }
                     },
                     error: function (xhr, status, error) {
                         console.log('Error en la solicitud AJAX:', error);
                     }
                 });
             } else {
                 console.log('Por favor, asegúrese de que todos los campos estén completos.');
             }
         });
         $('#empleado-form input, #empleado-form select, #ficha-empleado-form input, #ficha-empleado-form textarea,  #ficha-empleado-form select').on('change', function () {
             let telefonoEmpresa = $('#telefono-empresa').val();
             let correoEmpresa = $('#email-trabajo').val();
             let fechaIngresoEmpresa = $('#fecha-ingreso').val();
             let empresa = $('#centro').val();
             let depatamentoEmpresa = $('#departamento-empresa').val();
             let sucursalEmpresa = $('#sucursal').val();
             let areaEmpresa = $('#areas-empresa').val();
             let cargoEmpresa = $('#cargos-empresa').val();
             let direccionLaboral = $('#direccion-laboral').val();
             let gerente = $('#gerente').val();
             let jefe = $('#jefe-inmediato').val();
             let observaciones = $('#observaciones-generales').val();
             console.log('observaciones' + observaciones);
             let salario = $('#salario').val();
             console.log("Salario de empleado: " + salario);
             let formaPago = $('#forma-pago').val();
             let banco = $('#nuevo-banco').val();
             let cuentaBancaria = $('#cuenta_bancaria').val();
             let tipoCuenta = $('#tipo-cuenta').val();
             let centroCosto = $('#centro-costo').val();
             let cuentaContable = $('#cuenta-contable').val();
             let categoriaRetiro = $('#nuevo-categoria-retiros').val();
             let motivoRetiro = $('#nuevo-motivo-retiro').val();
             let fechaRetiro = $('#fecha-retiro').val();
             let observacionesRetiro = $('#observaciones-retiro').val();
             let idEmpleado = $('#id-empleado').val() || $('#edit-id-empleado').val();
 
 
             if (idEmpleado) {
                 $.ajax({
                     type: 'POST',
                     url: "{% url 'guardar_ficha_empleado' %}",
                     data: {
                         'telefono_empresa': telefonoEmpresa,
                         'email_trabajo': correoEmpresa,
                         'fecha_ingreso': fechaIngresoEmpresa,
                         'centro': empresa,
                         'departamento_empresa': depatamentoEmpresa,
                         'sucursal': sucursalEmpresa,
                         'id_area': areaEmpresa,
                         'id_cargo': cargoEmpresa,
                         'direccion_laboral': direccionLaboral,
                         'gerente': gerente,
                         'jefe_inmediato': jefe,
                         'observaciones_generales': observaciones,
                         'salario': salario,
                         'forma_pago': formaPago,
                         'nuevo_banco': banco,
                         'cuenta_bancaria': cuentaBancaria,
                         'tipo_cuenta': tipoCuenta,
                         'centro_costo': centroCosto,
                         'cuenta_contable': cuentaContable,
                         'nuevo_categoria_retiros': categoriaRetiro,
                         'nuevo_motivo_retiro': motivoRetiro,
                         'fecha_retiro': fechaRetiro,
                         'observaciones_retiro': observacionesRetiro,
                         'id_empleado': idEmpleado,
                         'creado_por': '{{userName}}',
                         'csrfmiddlewaretoken': '{{ csrf_token }}'
                     },
                     success: function (response) {
                         if (response.status === 'success') {
                             console.log('Empleado actualizado correctamente.');
                         } else {
                             console.log('Error al actualizar la ficha del empleado: ' + response.error);
                         }
                     },
                     error: function (xhr, status, error) {
                         console.log('Error en la solicitud AJAX:', error);
                     }
                 });
             } else {
                 console.log('Por favor, asegúrese de que todos los campos estén completos.');
             }
         });
  */




        // Evento de clic para el botón principal
        $('#guardarEmpleadoBtn').click(function () {
            guardarDatosEmpleado();
        });

        $('#guardarBtn').click(function (event) {
            event.preventDefault(); // Prevenir el comportamiento predeterminado del botón
            guardarDatosEmpleado();

        });


        function validarContratoEmpleado() {
            var idEmpleado = $('#id-empleado').val() || $('#edit-id-empleado').val();


            return $.ajax({
                url: "{% url 'validar_contrato' %}",  // URL de la vista en Django
                type: 'POST',
                data: {
                    'empleado_id': idEmpleado,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                }
            });
        }

        function guardarDatosEmpleado() {
            // Obtener los valores de departamento, áreas y cargos
            var dep = $('#departamento-empresa').val();
            var ar = $('#areas-empresa').val();
            var car = $('#cargos-empresa').val();

            // Validar campo de puesto de trabajo
            if (!$('#puesto-trabajo').val()) {
                Swal.fire({
                    icon: 'error',
                    title: 'Campo Requerido',
                    text: 'El campo Identidad es obligatorio.',
                    confirmButtonText: 'Entendido',
                    customClass: {
                        confirmButton: 'btn btn-primary'
                    },
                    buttonsStyling: false,
                    didClose: () => {
                        // Enfocar en el campo después de cerrar la alerta
                        $('#puesto-trabajo').focus();
                    }
                });
                return;
            }

            // Validar código de empleado
            if (!$('#cod-empleado').val()) {
                Swal.fire({
                    icon: 'error',
                    title: 'Campo Requerido',
                    text: 'El campo Código del Empleado es obligatorio.',
                    confirmButtonText: 'Entendido',
                    customClass: {
                        confirmButton: 'btn btn-primary'
                    },
                    buttonsStyling: false,
                    didClose: () => {
                        // Enfocar en el campo después de cerrar la alerta
                        $('#cod-empleado').focus();
                    }
                });
                return;
            }


            // Validar nombre del empleado
            if (!$('#nombre-empleado').val()) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Campo Requerido',
                    text: 'El nombre del Empleado es obligatorio.',
                    confirmButtonText: 'Entendido',
                    customClass: {
                        confirmButton: 'btn btn-primary'
                    },
                    buttonsStyling: false,
                    didClose: () => {
                        // Enfocar en el campo después de cerrar la alerta
                        $('#nombre-empleado').focus();
                    }
                });
                return;
            }

            // Validar apellido del empleado
            if (!$('#apellido-empleado').val()) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Campo Requerido',
                    text: 'El apellido del Empleado es obligatorio.',
                    confirmButtonText: 'Entendido',
                    customClass: {
                        confirmButton: 'btn btn-primary'
                    },
                    buttonsStyling: false,
                    didClose: () => {
                        $('#apellido-empleado').focus(); // Enfocar en el campo de apellido
                    }
                });

                return;
            }


            // Validar fecha de ingreso
            if (!$('#fecha-ingreso').val()) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Campo Requerido',
                    text: 'El campo Fecha Ingreso es obligatorio.',
                    confirmButtonText: 'Entendido',
                    customClass: {
                        confirmButton: 'btn btn-primary'
                    },
                    buttonsStyling: false,
                    didClose: () => {
                        $('#fecha-ingreso').focus(); // Enfocar en el campo de fecha de ingreso
                    }
                });

                return;
            }

            // Validar empresa
            if (!$('#centro').val()) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Campo Requerido',
                    text: 'El campo Empresa es obligatorio.',
                    confirmButtonText: 'Entendido',
                    customClass: {
                        confirmButton: 'btn btn-primary'
                    },
                    buttonsStyling: false,
                    didClose: () => {
                        $('#centro').focus(); // Enfocar en el campo de empresa
                    }
                });

                return;
            }

            // Validar departamento
            if (!$('#departamento-empresa').val()) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Campo Requerido',
                    text: 'El campo Departamento es obligatorio.',
                    confirmButtonText: 'Entendido',
                    customClass: {
                        confirmButton: 'btn btn-primary'
                    },
                    buttonsStyling: false,
                    didClose: () => {
                        $('#departamento-empresa').focus(); // Enfocar en el campo de departamento
                    }
                });

                return;
            }

            // Validar sucursal
            if (!$('#sucursal').val()) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Campo Requerido',
                    text: 'El campo Sucursal es obligatorio.',
                    confirmButtonText: 'Entendido',
                    customClass: {
                        confirmButton: 'btn btn-primary'
                    },
                    buttonsStyling: false,
                    didClose: () => {
                        $('#sucursal').focus(); // Enfocar en el campo de sucursal
                    }
                });

                return;
            }

            // Validar área
            if (!$('#areas-empresa').val()) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Campo Requerido',
                    text: 'El campo Área es obligatorio.',
                    confirmButtonText: 'Entendido',
                    customClass: {
                        confirmButton: 'btn btn-primary'
                    },
                    buttonsStyling: false,
                    didClose: () => {
                        $('#areas-empresa').focus(); // Enfocar en el campo de área
                    }
                });

                return; // Detener la ejecución si está vacío
            }

            // Validar cargo
            if (!$('#cargos-empresa').val()) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Campo Requerido',
                    text: 'El campo Cargo es obligatorio.',
                    confirmButtonText: 'Entendido',
                    customClass: {
                        confirmButton: 'btn btn-primary'
                    },
                    buttonsStyling: false,
                    didClose: () => {
                        $('#cargos-empresa').focus(); // Enfocar en el campo de cargo
                    }
                });

                return;
            }

            // Validar rol
            if (!$('#rol-empleado').val()) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Campo Requerido',
                    text: 'El campo Rol es obligatorio.',
                    confirmButtonText: 'Entendido',
                    customClass: {
                        confirmButton: 'btn btn-primary'
                    },
                    buttonsStyling: false,
                    didClose: () => {
                        $('#rol-empleado').focus(); // Enfocar en el campo de rol
                    }
                });

                return;
            }

            // Validar estado
            if (!$('#estado-empleado').val()) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Campo Requerido',
                    text: 'El campo Estado es obligatorio.',
                    confirmButtonText: 'Entendido',
                    customClass: {
                        confirmButton: 'btn btn-primary'
                    },
                    buttonsStyling: false,
                    didClose: () => {
                        $('#estado-empleado').focus(); // Enfocar en el campo de estado
                    }
                });

                return;
            }

            // Llamadas para guardar los datos del empleado
            var guardarEmpleadoGeneral = guardarEmpleado("{% url 'actualizar_empleado' %}");
            var guardarFichaEmpleado = guardarEmpleado("{% url 'guardar_ficha_empleado' %}");

            // Esperar a que ambas funciones terminen
            $.when(guardarEmpleadoGeneral, guardarFichaEmpleado).done(function (responseGeneral, responseFicha) {
                // Manejar errores de sesión
                if (responseGeneral[0].status === 401 || responseFicha[0].status === 401) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Sesión caducada',
                        text: 'Su sesión ha sido cerrada. Por favor, inicie sesión nuevamente.',
                        confirmButtonText: 'Iniciar sesión'
                    }).then(() => {
                        window.location.href = 'http://3.230.160.184:81/CWS/';
                    });
                }
                // Manejar el éxito de ambas solicitudes
                else if (responseGeneral[0].status === 'success' && responseFicha[0].status === 'success') {
                    Swal.fire({
                        icon: 'success',
                        title: 'Empleado actualizado',
                        text: 'Empleado actualizado exitosamente.',
                        showConfirmButton: false,
                        timer: 1500
                    }).then(() => {
                        var idEmpleado = $('#id-empleado').val();
                        if (!idEmpleado) {
                            // Si es un nuevo empleado, limpiar los formularios
                            $('#formEmpleado')[0].reset();
                            $('#formFicha')[0].reset();
                        } else {
                            // Redirigir a la página anterior si se trata de una edición
                            //window.history.back();
                        }
                    });
                }
                // Manejar otros errores
                else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Error al guardar los datos del empleado.',
                    });
                }
            }).fail(function () {
                // Manejar errores en la llamada AJAX
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Ocurrió un error al procesar la solicitud.',
                });
            });
        }

        function guardarEmpleado(urlDestino) {
            var formData = new FormData();


            // Obtener el id del empleado
            var idEmpleado = $('#id-empleado').val();
            var editIdEmpleado = $('#edit-id-empleado').val();
            if (!idEmpleado && editIdEmpleado) {
                idEmpleado = editIdEmpleado;
                $('#id-empleado').val(editIdEmpleado);
            }
            if (idEmpleado) {
                formData.append('id_empleado', idEmpleado);
            }

            // Agregar los campos del formulario principal
            $('#empleado-form, #ficha-empleado-form, #ajuste-empleado-form').find(':input').each(function () {
                if ($(this).attr('name')) {
                    formData.append($(this).attr('name'), $(this).val());
                }
            });
            console.log("DEBUG: Tipo de vehículo en formData:", formData.get('tipo_vehiculo'));

            // Agregar campos específicos adicionales
            var fields = [
                'direccion-contacto', 'correo-contacto', 'placa-vehiculo', 'tipo-vehiculo', 'nacionalidad', 'pasaporte',
                'sexo', 'fecha-nac', 'nuevo-pais-nac', 'numero-hijos', 'nuevo-banco', 'cuenta_bancaria',
                'nivel-certificado', 'nuevo-campo-estudio', 'municipio', 'ciudad-nac', 'profesion-empleado',
                'puesto-trabajo', 'rtn', 'telefono-personal', 'nombre-empleado', 'apellido-empleado', 'departamento-empresa',
                'email-trabajo', 'gerente', 'jefe-inmediato', 'jefe-superior', 'estado-empleado', 'puesto-empresa', 'cargos-empresa',
                'areas-empresa', 'distancia-km', 'estado-civil', 'residencia', 'departamento_pais',
                'nuevo-municipio-departamento', 'nueva-ciudad-municipio', 'nuevo-barrio-ciudad', 'creado-por',
                'tipo-sangre', 'rol-empleado', 'punto-referencia', 'direccion-laboral', 'centro', 'telefono-empresa',
                'fecha-ingreso', 'tipo-contrato', 'observaciones-generales', 'nuevo-categoria-retiros',
                'nuevo-motivo-retiro', 'fecha-retiro', 'observaciones-retiro', 'forma-pago', 'seguros',
                'salario', 'competencias-puesto', 'historico-acciones', 'constancias', 'evaluaciones',
                'inicio-contrato', 'fin-contrato', 'tipo-cuenta', 'centro-costo', 'cuenta-contable', 'sucursal', 'usuario', 'usuario_biometrico'
            ];

            fields.forEach(function (field) {
                var input = $('#' + field);
                if (input.length > 0) {
                    formData.append(field.replace('-', '_'), input.val());
                }
            });

            // Manejar el archivo de la foto
            var fotoInput = $('#foto-input')[0];
            if (fotoInput && fotoInput.files.length > 0) {
                formData.append('foto', fotoInput.files[0]);
                console.log("DEBUG: Se ha seleccionado una nueva imagen.");
            } else {
                var fotoActual = $('#foto-actual').val();
                if (fotoActual) {
                    formData.append('foto_actual', fotoActual);
                    console.log("DEBUG: Se está enviando la imagen actual: " + fotoActual);
                } else {
                    console.log("DEBUG: No se ha seleccionado nueva imagen ni hay imagen actual.");
                }
            }

            // Realizar la solicitud AJAX
            return $.ajax({
                url: urlDestino,  // La URL se pasa como parámetro
                type: 'POST',
                data: formData,
                contentType: false,
                processData: false,
                success: function (response) {
                    console.log("DEBUG: Respuesta del servidor:", response);

                    // Aquí llamas a la función para actualizar la tabla de bitácora
                    if (idEmpleado) {
                        obtenerBitacoraEmpleado(idEmpleado);  // Actualizar la tabla con la bitácora del empleado
                    }
                },
                error: function (response) {
                    console.log("DEBUG: Error al enviar los datos:", response);
                }
            });
        }

        function obtenerBitacoraEmpleado(idEmpleado) {
            var buttons = "Bfrtlip";

            // Si ya existe una tabla DataTable en el mismo selector, destruirla antes de volver a inicializarla
            if ($.fn.DataTable.isDataTable('#bitacora-table')) {
                $('#bitacora-table').DataTable().clear().destroy();  // Limpiar y destruir el DataTable existente
            }

            // Inicializar DataTable con la opción para mostrar solo 50 registros por página
            var empleadosTable = $('#bitacora-table').DataTable({
                dom: 'Bfrtip',
                buttons: [
                    {
                        extend: 'excel',
                        text: '<i class="fas fa-file-excel"></i>',
                        titleAttr: 'Excel',
                        className: 'btn btn-success',
                    },
                    {
                        extend: 'pdf',
                        text: '<i class="fas fa-file-pdf"></i>',
                        titleAttr: 'PDF',
                        className: 'btn btn-danger',
                    },
                    {
                        extend: 'print',
                        text: '<i class="fas fa-print"></i>',
                        titleAttr: 'Imprimir',
                        className: 'btn btn-null',
                    }
                ],
                pageLength: 50,  // Mostrar solo 50 registros por página
                language: {
                    "processing": "Procesando...",
                    "lengthMenu": "Mostrar _MENU_ registros",
                    "zeroRecords": "No se encontraron resultados",
                    "emptyTable": "Ningún dato disponible en esta tabla",
                    "info": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                    "infoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                    "infoFiltered": "(filtrado de un total de _MAX_ registros)",
                    "search": "Buscar:",
                    "infoThousands": ",",
                    "loadingRecords": "Cargando...",
                    "paginate": {
                        "first": "Primero",
                        "last": "Último",
                        "next": "Siguiente",
                        "previous": "Anterior"
                    },
                    "aria": {
                        "sortAscending": ": Activar para ordenar la columna de manera ascendente",
                        "sortDescending": ": Activar para ordenar la columna de manera descendente"
                    },
                    "buttons": {
                        "copy": "Copiar",
                        "colvis": "Visibilidad"
                    }
                }
            });

            // Realizar la solicitud AJAX para obtener la bitácora
            $.ajax({
                url: "{% url 'obtener_datos_X_bitacora_empleado' 1 %}".replace('1', idEmpleado),  // Pasar dinámicamente el idEmpleado en la URL
                method: 'GET',
                dataType: 'json',
                success: function (response) {
                    if (response.status === 'success') {
                        // Limpiar la tabla antes de cargar los nuevos datos
                        empleadosTable.clear().draw();  // Limpiar la tabla utilizando DataTable

                        // Verificar si hay datos
                        if (response.data.length === 0) {
                            let filaVacia = ['No se encontraron registros'].concat(Array(13).fill(''));  // Rellenar con columnas vacías
                            empleadosTable.row.add(filaVacia).draw();
                            return;
                        }


                        // Iterar sobre los datos y agregarlos a la tabla
                        response.data.forEach(function (item, index) {
                            let fila = [
                                index + 1,
                                item['Fecha de Cambio'],
                                item['Anterior_Empresa'],
                                item['Anterior_Sucursal'],
                                item['Anterior_Departamento'],
                                item['Anterior_Area'],
                                item['Anterior_Cargo'],
                                item['Anterior_Salario'],
                                item['Actual_Empresa'],
                                item['Actual_Sucursal'],
                                item['Actual_Departamento'],
                                item['Actual_Area'],
                                item['Actual_Cargo'],
                                item['Actual_Salario']
                            ];
                            empleadosTable.row.add(fila).draw();
                        });
                    } else {
                        console.error('Error:', response.error);
                        alert('Hubo un error al obtener la bitácora.');
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error AJAX:', error);
                    alert('Hubo un error al procesar la solicitud.');
                }
            });
        }

        // Obtener dinámicamente el ID del empleado desde el campo HTML
        let idEmpleado = $('#id-empleado').val() || $('#edit-id-empleado').val();

        // Llamar a la función solo si el ID de empleado está presente
        if (idEmpleado) {
            obtenerBitacoraEmpleado(idEmpleado);
        }




        function limpiarCamposAdicionales() {
            var fields = [
                'direccion-contacto', 'correo-contacto', 'placa-vehiculo', 'tipo-vehiculo', 'nacionalidad', 'pasaporte',
                'sexo', 'fecha-nac', 'nuevo-pais-nac', 'numero-hijos', 'nuevo-banco', 'cuenta_bancaria',
                'nivel-certificado', 'nuevo-campo-estudio', 'municipio', 'ciudad-nac', 'profesion-empleado',
                'puesto-trabajo', 'rtn', 'telefono-personal', 'nombre-empleado', 'apellido-empleado',
                'email-trabajo', 'gerente', 'jefe-inmediato', 'jefe-superior', 'estado-empleado', 'puesto-empresa',
                'areas-empresa', 'distancia-km', 'estado-civil', 'residencia', 'departamento_pais',
                'nuevo-municipio-departamento', 'nueva-ciudad-municipio', 'nuevo-barrio-ciudad', 'creado-por',
                'tipo-sangre', 'rol-empleado', 'punto-referencia', 'direccion-laboral', 'centro', 'telefono-empresa',
                'fecha-ingreso', 'tipo-contrato', 'observaciones-generales', 'nuevo-categoria-retiros',
                'nuevo-motivo-retiro', 'fecha-retiro', 'observaciones-retiro', 'forma-pago', 'seguros',
                'salario', 'competencias-puesto', 'historico-acciones', 'constancias', 'evaluaciones',
                'inicio-contrato', 'fin-contrato', 'tipo-cuenta', 'centro-costo', 'cuenta-contable', 'sucursal', 'usuario', 'usuario_biometrico'
            ];

            fields.forEach(function (field) {
                $('#' + field).val('');
            });

            // Limpiar selects que utilizan Select2
            $('select').val(null).trigger('change');  // Esto limpia todos los select2

            // Limpiar el input de foto
            $('#foto-input').val('');

            // Limpiar todas las DataTables en la página
            $.fn.dataTable.tables({ visible: true, api: true }).clear().draw();
        }

        function handleIconClick() {
            var previousUrl = document.referrer; // Captura la URL de la página anterior

            if (previousUrl) {
                window.location.href = previousUrl; // Redirige a la página anterior
            } else {
                window.history.back(); // Como fallback
            }
        }
    });
    /*------------------------------------------ASIGNAR EQUIPO----------------------------------------*/



    /*----------------------------- INSERTAR CUANDO SE REALIZA UN CAMBIO DE TAB ----------------------*/


    /* -----------------------------------------------------EQUIPOCS-----------------------------------------------------------*/

    $(document).ready(function () {
        let estadoActivoId = "{{ estado_activo_id }}";
        if (estadoActivoId) {
            $('#estado-empleado').val(estadoActivoId).trigger('change');
        }
    });

    var subir = $('.back-to-top');
    var contenedor = $('.crear-container');  // Selecciona el contenedor

    // Evento al hacer clic en el botón
    subir.click(function (e) {
        e.preventDefault();
        contenedor.animate({ scrollTop: 0 }, 500); // Hacer scroll hacia arriba en el contenedor
    });

    // Ocultar el botón al principio
    subir.hide();

    // Mostrar el botón al hacer scroll en el contenedor
    contenedor.scroll(function () {
        if ($(this).scrollTop() > 200) {
            subir.fadeIn(); // Mostrar el botón con una animación
        } else {
            subir.fadeOut(); // Ocultar el botón si no hay suficiente scroll
        }
    });


</script>

{% endblock %}